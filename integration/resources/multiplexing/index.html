<!doctype html>
<html lang="en">
<head>
    <title>Single ID5 API Integration</title>
    <link rel="canonical" href="https://www.id5.io"/>
</head>
<body>
<!-- ID5 API -->
<script type="text/javascript" src="https://cdn.id5-sync.com/api/integration/id5-api.js"></script>
<script>

    const  leaderElectionCallback = function (instance) {
        return (role, leader) => {
            window.fetch('https://instances.log/on-election', {
                method: 'POST',
                headers: {
                    'Content-Type': 'text/plain'
                },
                mode: 'no-cors',
                body: JSON.stringify({
                    location: window.location.href,
                    id: instance.properties.id,
                    role: role,
                    leader: leader.id,
                    knownInstances: Array.from(instance._knownInstances.keys())
                })
            });
        };
    };
    const uidCallback = function (status) {
        const instance = status.instance;
        const uid = status.getUserId();
        window.fetch('https://instances.log/on-available', {
            method: 'POST',
            headers: {
                'Content-Type': 'text/plain'
            },
            mode: 'no-cors',
            body: JSON.stringify({
                location: window.location.href,
                id: instance.properties.id,
                role: instance.role,
                uid: uid
            })
        });
    };

    ID5.debug = true;

    let id5Status = ID5.init(
        {
            partnerId: 99,
            refreshInSeconds: 5,
            cmpApi: 'static',
            consentData: {
                getTCData: {
                    gdprApplies: true,
                    tcString: "CPBZjR9PBZjR9AKAZAENBMCsAP_AAH_AAAqIHWtf_X_fb39j-_59_9t0eY1f9_7_v-0zjhfds-8Nyf_X_L8X42M7vF36pq4KuR4Eu3LBIQFlHOHUTUmw6okVrTPsak2Mr7NKJ7LEinMbe2dYGHtfn9VTuZKYr97s___z__-__v__79f_r-3_3_vp9X---_e_V3dgdYASYal8BFmJY4Ek0aVQogQhXEh0AoAKKEYWiawgJXBTsrgI9QQMAEBqAjAiBBiCjFgEAAAAASURASAHggEQBEAgABACpAQgAIkAQWAFgYBAAKAaFgBFAEIEhBkcFRymBARItFBPJWAJRd7GGEIZRYAUCj-iowEAAAAA.cAAAAAAAAAAA",
                    purpose: {
                        consents: {
                            '1': true
                        }
                    }
                }
            },
            diagnostics: {
                publishAfterLoadInMsec: -1,
                publishingSampleRatio: 1,
                publishOnWindowUnload: true
            },
            segments: [{destination: '22', ids: ['abc']}],
            multiplexing: {
                _disabled: false
            }
        }
    ).onAvailable(uidCallback);
    const instance = id5Status.instance;
    instance.on('leader-elected', leaderElectionCallback(instance));
</script>
<iframe id="non-friendly-frame" src="https://non-friendly-stuff.com"></iframe>
<iframe id="friendly-frame" src="https://my-publisher-website.net/multiple-integrations.html"></iframe>

<!-- /ID5 API -->
</body>
</html>
