{"version":3,"sources":["webpack:///webpack/bootstrap 54fae2db9af39689fb69","webpack:///./lib/utils.js","webpack:///./lib/constants.json","webpack:///./lib/clientStore.js","webpack:///./lib/consentManagement.js","webpack:///./lib/config.js","webpack:///./src/index.js","webpack:///./lib/id5-api.js","webpack:///./lib/refererDetection.js","webpack:///./lib/id5Status.js","webpack:///./generated/version.js","webpack:///./lib/localStorage.js"],"names":["tArr","tStr","tFn","tNumb","tObject","tBoolean","toString","Object","prototype","isParamDebug","getParameterByName","toUpperCase","consoleExists","Boolean","window","console","consoleLogExists","log","consoleInfoExists","info","consoleWarnExists","warn","consoleErrorExists","error","isDebug","replaceTokenInString","str","map","token","_each","value","key","undefined","keyString","re","RegExp","replace","logMessage","isGlobalDebug","apply","decorateLog","arguments","logInfo","logWarn","logError","args","prefix","slice","call","unshift","setGlobalDebug","name","regexS","regex","results","exec","location","search","decodeURIComponent","isA","object","_t","isFn","isStr","isArray","isNumber","isPlainObject","isBoolean","isEmpty","length","k","hasOwnProperty","fn","forEach","l","getCookie","m","document","cookie","match","setCookie","expires","encodeURIComponent","parseQS","query","split","reduce","acc","criteria","v","test","push","formatQS","keys","Array","join","parse","url","options","parsed","createElement","noDecodeWholeURL","href","qsAsString","decodeSearchAsString","protocol","hostname","port","pathname","hash","host","format","obj","XHR_DONE","ajax","callback","data","x","method","parser","callbacks","success","e","XMLHttpRequest","onreadystatechange","readyState","status","responseText","statusText","ontimeout","timeout","urlInfo","open","withCredentials","customHeaders","header","setRequestHeader","preflight","contentType","send","fireAsyncPixel","syncUrl","initCallBack","img","Image","src","complete","addEventListener","deferPixelFire","loadedCallback","cyrb53Hash","seed","imul","opA","opB","Math","result","h1","h2","i","ch","charCodeAt","ClientStore","localStorageAllowedCallback","localStorage","cacheConfig","getItemWithExpiration","removeItemWithExpiration","setItemWithExpiration","isAvailable","legacyStoredValue","CONSTANTS","LEGACY_COOKIE_NAMES","JSON","storedValue","get","STORAGE_CONFIG","ID5","clear","response","put","CONSENT_DATA","consentData","makeStoredConsentDataHash","partnerId","pdCacheConfig","pd","storedDataMatchesCurrentData","getHashedPd","makeStoredHash","Date","LAST","getTime","timestamp","cachedNb","nbCacheConfig","parseInt","nb","setNb","clearResponse","clearDateTime","clearNb","clearHashedPd","clearHashedConsentData","expired","now","toUTCString","getHashedConsentData","PD","expiresDays","userId","storedData","currentData","storedConsentData","consentString","gdprApplies","apiVersion","stringify","ConsentManagement","lookupIabConsent","lookupStaticConsentData","cmpSuccess","finalCallback","cmpVersion","staticConsentData","getConsentData","getTCData","utils","consentThis","v2CmpResponseCallback","tcfData","eventStatus","handleV1CmpResponseCallbacks","cmpResponse","afterEach","getVendorConsents","consentDataCallback","consentResponse","vendorConsentsCallback","v1CallbackHandler","findCMP","cmpFrame","cmpFunction","debugBypassConsent","cmpApi","providedConsentData","cmpCallMap","resetConsentData","storedPrivacyData","cmpConsentObject","vendorData","tcString","allowLocalStorageWithoutConsentApi","isProvisionalLocalStorageAllowed","purposeConsents","purpose","consents","privacyData","PRIVACY","id5_consent","jurisdiction","jurisdictionRequiresConsent","JURISDICTIONS","privacy","f","__tcfapi","__cmp","frames","top","parent","consentObject","checkV1Data","checkV2Data","checkFn","storeConsentData","Config","refreshInSeconds","partnerUserId","callbackOnAvailable","callbackOnUpdates","callbackTimeoutInMs","abTesting","enabled","controlGroupPct","provider","maxCascades","applyCreativeRestrictions","providedOptions","Error","updOptions","topic","configTypes","Id5Api","currentVersion","loaded","_isUsingCdn","currentScript","indexOf","_referer","getRefererInfo","versions","passedOptions","config","getOptions","LocalStorage","consentManagement","clientStore","isLocalStorageAllowed","partnerStatus","Id5Status","getId","referer","id5Status","forceFetch","startRefresh","updateOptions","storedResponse","storedDateTime","refreshInSecondsHasElapsed","pdHasChanged","cachedResponseUsed","localStorageAllowed","getResponse","getDateTime","getNb","storedPdMatchesPd","getResponseFromLegacyCookie","universal_uid","setUserId","incNb","refreshNeeded","requestConsent","consentHasChanged","storedConsentDataMatchesConsentData","putHashedConsentData","putHashedPd","signature","gdprConsentString","_version","stack","reachedTop","isLocalStorageAvailable","gdpr_consent","s","puid","ab_testing","control_group_pct","responseObj","setStoredPrivacy","putResponse","setDateTime","clearAll","removeLegacyCookies","cascade_needed","isSync","_userId","detectReferer","win","getLevels","levels","walkUpWindows","ancestors","getAncestorOrigins","ancestor","ancestorOrigins","getPubUrlStack","defUrl","frameLocation","prevFrame","prevRef","detectedRefererUrl","referrer","getCanonicalUrl","doc","element","querySelector","currentWindow","isTop","refData","canonicalUrl","refererInfo","numIframes","stackInfo","_isRefreshing","_isRefreshingWithFetch","fromCache","linkType","link_type","_isExposed","hasChanged","_linkType","_fromCache","currentThis","_availableCallback","_availableCallbackFired","_availableCallbackTimerId","clearTimeout","setTimeout","doFireOnAvailableCallBack","_refreshCallback","_refreshCallbackFired","_refreshCallbackTimerId","doFireOnRefreshCallBack","_updateCallback","doFireOnUpdateCallBack","source","ID5_EIDS_SOURCE","uids","id","getUserId","ext","getLinkType","abTestingControlGroup","exposeUserId","currentId5Status","version","EXP_SUFFIX","writingEnabled","setItem","removeItem","available","getItem","storedValueExp","isExpired","expirationInMs","expiresStr","dateValue"],"mappings":"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","file":"id5-api.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 5);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 54fae2db9af39689fb69","const tArr = 'Array';\nconst tStr = 'String';\nconst tFn = 'Function';\nconst tNumb = 'Number';\nconst tObject = 'Object';\nconst tBoolean = 'Boolean';\nconst toString = Object.prototype.toString;\nconst isParamDebug = getParameterByName('id5_debug').toUpperCase() === 'TRUE';\nconst consoleExists = Boolean(window.console);\nconst consoleLogExists = Boolean(consoleExists && window.console.log);\nconst consoleInfoExists = Boolean(consoleExists && window.console.info);\nconst consoleWarnExists = Boolean(consoleExists && window.console.warn);\nconst consoleErrorExists = Boolean(consoleExists && window.console.error);\n\nlet isDebug = false;\n\n/*\n *   Substitutes into a string from a given map using the token\n *   Usage\n *   var str = 'text %%REPLACE%% this text with %%SOMETHING%%';\n *   var map = {};\n *   map['replace'] = 'it was subbed';\n *   map['something'] = 'something else';\n *   console.log(replaceTokenInString(str, map, '%%')); => \"text it was subbed this text with something else\"\n */\nexport function replaceTokenInString(str, map, token) {\n  _each(map, function (value, key) {\n    value = (value === undefined) ? '' : value;\n\n    let keyString = token + key.toUpperCase() + token;\n    let re = new RegExp(keyString, 'g');\n\n    str = str.replace(re, value);\n  });\n\n  return str;\n}\n\n/**\n * Wrappers to console.(log | info | warn | error). Takes N arguments, the same as the native methods\n */\nexport function logMessage() {\n  if (isGlobalDebug() && consoleLogExists) {\n    console.log.apply(console, decorateLog(arguments, 'MESSAGE:'));\n  }\n}\n\nexport function logInfo() {\n  if (isGlobalDebug() && consoleInfoExists) {\n    console.info.apply(console, decorateLog(arguments, 'INFO:'));\n  }\n}\n\nexport function logWarn() {\n  if (isGlobalDebug() && consoleWarnExists) {\n    console.warn.apply(console, decorateLog(arguments, 'WARNING:'));\n  }\n}\n\nexport function logError() {\n  if (isGlobalDebug() && consoleErrorExists) {\n    console.error.apply(console, decorateLog(arguments, 'ERROR:'));\n  }\n}\n\nfunction decorateLog(args, prefix) {\n  args = [].slice.call(args);\n  prefix && args.unshift(prefix);\n  args.unshift('display: inline-block; color: #fff; background: #1c307e; padding: 1px 4px; border-radius: 3px;');\n  args.unshift('%cID5');\n  return args;\n}\n\nexport function setGlobalDebug(value) {\n  isDebug = !!value;\n}\n\nexport function isGlobalDebug() {\n  return isParamDebug || isDebug;\n}\n\n/*\n *   Check if a given parameter name exists in query string\n *   and if it does return the value\n */\nexport function getParameterByName(name) {\n  const regexS = '[\\\\?&]' + name + '=([^&#]*)';\n  const regex = new RegExp(regexS);\n  const results = regex.exec(window.location.search);\n  if (results === null) {\n    return '';\n  }\n\n  return decodeURIComponent(results[1].replace(/\\+/g, ' '));\n}\n\n/**\n * Return if the object is of the\n * given type.\n * @param {*} object to test\n * @param {String} _t type string (e.g., Array)\n * @return {Boolean} if object is of type _t\n */\nexport function isA(object, _t) {\n  return toString.call(object) === '[object ' + _t + ']';\n}\n\nexport function isFn(object) {\n  return isA(object, tFn);\n}\n\nexport function isStr(object) {\n  return isA(object, tStr);\n}\n\nexport function isArray(object) {\n  return isA(object, tArr);\n}\n\nexport function isNumber(object) {\n  return isA(object, tNumb);\n}\n\nexport function isPlainObject(object) {\n  return isA(object, tObject);\n}\n\nexport function isBoolean(object) {\n  return isA(object, tBoolean);\n}\n\n/**\n * Return if the object is \"empty\";\n * this includes falsey, no keys, or no items at indices\n * @param {*} object object to test\n * @return {Boolean} if object is empty\n */\nexport function isEmpty(object) {\n  if (!object) return true;\n  if (isArray(object) || isStr(object)) {\n    return !(object.length > 0);\n  }\n\n  for (let k in object) {\n    if (hasOwnProperty.call(object, k)) return false;\n  }\n\n  return true;\n}\n\n/**\n * Iterate object with the function\n * falls back to es5 `forEach`\n * @param {Array|Object} object\n * @param {function(value, key, object)} fn\n */\nfunction _each(object, fn) {\n  if (isEmpty(object)) return;\n  if (isFn(object.forEach)) return object.forEach(fn, this);\n\n  let k = 0;\n  let l = object.length;\n\n  if (l > 0) {\n    for (; k < l; k++) fn(object[k], k, object);\n  } else {\n    for (k in object) {\n      if (hasOwnProperty.call(object, k)) fn.call(this, object[k], k);\n    }\n  }\n}\n\nexport function getCookie(name) {\n  let m = window.document.cookie.match('(^|;)\\\\s*' + name + '\\\\s*=\\\\s*([^;]*)\\\\s*(;|$)');\n  return m ? decodeURIComponent(m[2]) : null;\n}\n\nexport function setCookie(key, value, expires) {\n  document.cookie = `${key}=${encodeURIComponent(value)}${(expires !== '') ? `; expires=${expires}` : ''}; path=/`;\n}\n\nexport function parseQS(query) {\n  return !query ? {} : query\n    .replace(/^\\?/, '')\n    .split('&')\n    .reduce((acc, criteria) => {\n      let [k, v] = criteria.split('=');\n      if (/\\[\\]$/.test(k)) {\n        k = k.replace('[]', '');\n        acc[k] = acc[k] || [];\n        acc[k].push(v);\n      } else {\n        acc[k] = v || '';\n      }\n      return acc;\n    }, {});\n}\n\nexport function formatQS(query) {\n  return Object\n    .keys(query)\n    .map(k => Array.isArray(query[k])\n      ? query[k].map(v => `${k}[]=${v}`).join('&')\n      : `${k}=${query[k]}`)\n    .join('&');\n}\n\nexport function parse(url, options) {\n  let parsed = document.createElement('a');\n  if (options && 'noDecodeWholeURL' in options && options.noDecodeWholeURL) {\n    parsed.href = url;\n  } else {\n    parsed.href = decodeURIComponent(url);\n  }\n  // in window.location 'search' is string, not object\n  let qsAsString = (options && 'decodeSearchAsString' in options && options.decodeSearchAsString);\n  return {\n    href: parsed.href,\n    protocol: (parsed.protocol || '').replace(/:$/, ''),\n    hostname: parsed.hostname,\n    port: +parsed.port,\n    pathname: parsed.pathname.replace(/^(?!\\/)/, '/'),\n    search: (qsAsString) ? parsed.search : parseQS(parsed.search || ''),\n    hash: (parsed.hash || '').replace(/^#/, ''),\n    host: parsed.host || window.location.host\n  };\n}\n\nexport function format(obj) {\n  return (obj.protocol || 'http') + '://' +\n    (obj.host ||\n        obj.hostname + (obj.port ? `:${obj.port}` : '')) +\n    (obj.pathname || '') +\n    (obj.search ? `?${formatQS(obj.search || '')}` : '') +\n    (obj.hash ? `#${obj.hash}` : '');\n}\n\nconst XHR_DONE = 4;\n\n/**\n * Simple IE9+ and cross-browser ajax request function\n * Note: x-domain requests in IE9 do not support the use of cookies\n *\n * @param url string url\n * @param callback {object | function} callback\n * @param data mixed data\n * @param options object\n */\nexport function ajax(url, callback, data, options = {}) {\n  try {\n    let x;\n    let method = options.method || (data ? 'POST' : 'GET');\n    let parser = document.createElement('a');\n    parser.href = url;\n\n    let callbacks = typeof callback === 'object' && callback !== null ? callback : {\n      success: function() {\n        logMessage('xhr success');\n      },\n      error: function(e) {\n        logError('xhr error', null, e);\n      }\n    };\n\n    if (typeof callback === 'function') {\n      callbacks.success = callback;\n    }\n\n    x = new window.XMLHttpRequest();\n\n    x.onreadystatechange = function () {\n      if (x.readyState === XHR_DONE) {\n        let status = x.status;\n        if ((status >= 200 && status < 300) || status === 304) {\n          callbacks.success(x.responseText, x);\n        } else {\n          callbacks.error(x.statusText, x);\n        }\n      }\n    };\n\n    x.ontimeout = function () {\n      logError('  xhr timeout after ', x.timeout, 'ms');\n    };\n\n    if (method === 'GET' && data) {\n      let urlInfo = parse(url, options);\n      Object.assign(urlInfo.search, data);\n      url = format(urlInfo);\n    }\n\n    x.open(method, url, true);\n\n    if (options.withCredentials) {\n      x.withCredentials = true;\n    }\n    _each(options.customHeaders, (value, header) => {\n      x.setRequestHeader(header, value);\n    });\n    if (options.preflight) {\n      x.setRequestHeader('X-Requested-With', 'XMLHttpRequest');\n    }\n    x.setRequestHeader('Content-Type', options.contentType || 'text/plain');\n\n    if (method === 'POST' && data) {\n      x.send(data);\n    } else {\n      x.send();\n    }\n  } catch (error) {\n    logError('xhr construction', error);\n  }\n}\n\n/**\n * add an Image pixel to the DOM for the given sync Url\n *\n * @param syncUrl\n * @param initCallBack Called when pixel is initiated. Always called. Optional\n * @param callback Called when pixel is loaded. May never be called. Optional\n */\nexport function fireAsyncPixel(syncUrl, initCallBack, callback) {\n  let img = new Image();\n  img.src = syncUrl;\n  if (isFn(initCallBack)) {\n    initCallBack();\n  }\n  if (isFn(callback)) {\n    if (img.complete) {\n      callback();\n    } else {\n      img.addEventListener('load', callback);\n    }\n  }\n}\n\n/**\n * wait until the page finishes loading and then fire a pixel\n *\n * @param syncUrl\n * @param initCallBack Called when pixel is initiated. Optional\n * @param loadedCallback Called when pixel is loaded (may never be called). Optional\n */\nexport function deferPixelFire(syncUrl, initCallBack, loadedCallback) {\n  if (document.readyState !== 'loading') {\n    fireAsyncPixel(syncUrl, initCallBack, loadedCallback);\n  } else {\n    document.addEventListener('DOMContentLoaded', function () {\n      fireAsyncPixel(syncUrl, initCallBack, loadedCallback);\n    });\n  }\n}\n\n/**\n * returns a hash of a string using a fast algorithm\n * source: https://stackoverflow.com/a/52171480/845390\n * @param {string} str\n * @param {number} [seed] (optional)\n * @returns {string}\n */\nexport function cyrb53Hash(str, seed = 0) {\n  // IE doesn't support imul\n  // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/imul#Polyfill\n  let imul = function(opA, opB) {\n    if (isFn(Math.imul)) {\n      return Math.imul(opA, opB);\n    } else {\n      opB |= 0; // ensure that opB is an integer. opA will automatically be coerced.\n      // floating points give us 53 bits of precision to work with plus 1 sign bit\n      // automatically handled for our convienence:\n      // 1. 0x003fffff /*opA & 0x000fffff*/ * 0x7fffffff /*opB*/ = 0x1fffff7fc00001\n      //    0x1fffff7fc00001 < Number.MAX_SAFE_INTEGER /*0x1fffffffffffff*/\n      var result = (opA & 0x003fffff) * opB;\n      // 2. We can remove an integer coersion from the statement above because:\n      //    0x1fffff7fc00001 + 0xffc00000 = 0x1fffffff800001\n      //    0x1fffffff800001 < Number.MAX_SAFE_INTEGER /*0x1fffffffffffff*/\n      if (opA & 0xffc00000) result += (opA & 0xffc00000) * opB | 0;\n      return result | 0;\n    }\n  };\n\n  let h1 = 0xdeadbeef ^ seed;\n  let h2 = 0x41c6ce57 ^ seed;\n  for (let i = 0, ch; i < str.length; i++) {\n    ch = str.charCodeAt(i);\n    h1 = imul(h1 ^ ch, 2654435761);\n    h2 = imul(h2 ^ ch, 1597334677);\n  }\n  h1 = imul(h1 ^ (h1 >>> 16), 2246822507) ^ imul(h2 ^ (h2 >>> 13), 3266489909);\n  h2 = imul(h2 ^ (h2 >>> 16), 2246822507) ^ imul(h1 ^ (h1 >>> 13), 3266489909);\n  return (4294967296 * (2097151 & h2) + (h1 >>> 0)).toString();\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/utils.js","module.exports = {\"STORAGE_CONFIG\":{\"ID5\":{\"name\":\"id5id\",\"expiresDays\":90},\"LAST\":{\"name\":\"id5id_last\",\"expiresDays\":90},\"CONSENT_DATA\":{\"name\":\"id5id_cached_consent_data\",\"expiresDays\":30},\"PD\":{\"name\":\"id5id_cached_pd\",\"expiresDays\":30},\"PRIVACY\":{\"name\":\"id5id_privacy\",\"expiresDays\":30}},\"LEGACY_COOKIE_NAMES\":[\"id5.1st\",\"id5id.1st\"],\"PRIVACY\":{\"JURISDICTIONS\":{\"gdpr\":true,\"ccpa\":false,\"lgpd\":true,\"other\":false}},\"ID5_EIDS_SOURCE\":\"id5-sync.com\"}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./lib/constants.json\n// module id = 1\n// module chunks = 0","/*\n * Module for managing storage of information in browser Local Storage and/or cookies\n */\n\nimport { logError, getCookie, setCookie, cyrb53Hash } from './utils.js';\nimport CONSTANTS from './constants.json';\n\nexport default class ClientStore {\n  /** @type {function} */\n  localStorageAllowedCallback;\n  /** @type {LocalStorage} */\n  localStorage;\n\n  /**\n   * @param {function} localStorageAllowedCallback\n   * @param {LocalStorage} localStorage the localStorage abstraction object to use\n   */\n  constructor(localStorageAllowedCallback, localStorage) {\n    this.localStorageAllowedCallback = localStorageAllowedCallback;\n    this.localStorage = localStorage;\n  }\n\n  /**\n   * Get stored data from local storage, if any, after checking if local storage is allowed\n   * @param {StoreItem} cacheConfig\n   * @returns {string|null|undefined} the stored value, null if no value or expired were stored, undefined if no consent or no access to localStorage\n   */\n  get(cacheConfig) {\n    try {\n      if (this.localStorageAllowedCallback() === true) {\n        return this.localStorage.getItemWithExpiration(cacheConfig);\n      } else {\n        logError('clientStore.get() has been called without localStorageAllowed');\n      }\n    } catch (e) {\n      logError(e);\n    }\n  }\n\n  /**\n   * clear stored data from local storage, if any\n   * @param {StoreItem} cacheConfig\n   */\n  clear(cacheConfig) {\n    try {\n      this.localStorage.removeItemWithExpiration(cacheConfig);\n    } catch (e) {\n      logError(e);\n    }\n  }\n\n  /**\n   * puts the current data into local storage, after checking for local storage access\n   * @param {StoreItem} cacheConfig\n   * @param {string} data\n   */\n  put(cacheConfig, data) {\n    try {\n      if (this.localStorageAllowedCallback() === true) {\n        this.localStorage.setItemWithExpiration(cacheConfig, data);\n      } else {\n        logError('clientStore.put() has been called without localStorageAllowed');\n      }\n    } catch (e) {\n      logError(e);\n    }\n  }\n\n  /**\n   * @returns {boolean|undefined} see {ConsentManagement.isLocalStorageAllowed()}\n   */\n  localStorageAllowed() {\n    return this.localStorageAllowedCallback();\n  }\n\n  /**\n   * @returns {boolean} true if localStorage is available\n   */\n  isLocalStorageAvailable() {\n    return this.localStorage.isAvailable();\n  }\n\n  getResponseFromLegacyCookie() {\n    let legacyStoredValue;\n    CONSTANTS.LEGACY_COOKIE_NAMES.forEach(function (cookie) {\n      if (getCookie(cookie)) {\n        legacyStoredValue = getCookie(cookie);\n      }\n    });\n    if (legacyStoredValue) {\n      return JSON.parse(legacyStoredValue);\n    } else {\n      return null;\n    }\n  }\n\n  getResponse() {\n    let storedValue = this.get(CONSTANTS.STORAGE_CONFIG.ID5);\n    if (storedValue) {\n      return JSON.parse(decodeURIComponent(storedValue));\n    } else {\n      return storedValue;\n    }\n  }\n\n  clearResponse() {\n    this.clear(CONSTANTS.STORAGE_CONFIG.ID5);\n  }\n\n  putResponse(response) {\n    this.put(CONSTANTS.STORAGE_CONFIG.ID5, encodeURIComponent(response));\n  }\n\n  getHashedConsentData() {\n    return this.get(CONSTANTS.STORAGE_CONFIG.CONSENT_DATA);\n  }\n\n  clearHashedConsentData() {\n    this.clear(CONSTANTS.STORAGE_CONFIG.CONSENT_DATA);\n  }\n\n  putHashedConsentData(consentData) {\n    this.put(CONSTANTS.STORAGE_CONFIG.CONSENT_DATA, ClientStore.makeStoredConsentDataHash(consentData));\n  }\n\n  /**\n   * Get current hash PD for this partner\n   * @param {number} partnerId\n   */\n  getHashedPd(partnerId) {\n    return this.get(ClientStore.pdCacheConfig(partnerId));\n  }\n\n  /**\n   * Check current hash PD for this partner against the one in cache\n   * @param {number} partnerId\n   * @param {string} pd\n   */\n  storedPdMatchesPd(partnerId, pd) {\n    return ClientStore.storedDataMatchesCurrentData(this.getHashedPd(partnerId), ClientStore.makeStoredHash(pd));\n  }\n\n  /**\n   * Clear the hash PD for this partner\n   * @param {number} partnerId\n   */\n  clearHashedPd(partnerId) {\n    this.clear(ClientStore.pdCacheConfig(partnerId));\n  }\n\n  /**\n   * Hash and store the PD for this partner\n   * @param {number} partnerId\n   * @param {string} [pd]\n   */\n  putHashedPd(partnerId, pd) {\n    this.put(ClientStore.pdCacheConfig(partnerId), ClientStore.makeStoredHash(pd));\n  }\n\n  /**\n   * Generate local storage config for PD of a given partner\n   * @param {number} partnerId\n   * @return {StoreItem}\n   */\n  static pdCacheConfig(partnerId) {\n    return {\n      name: `${CONSTANTS.STORAGE_CONFIG.PD.name}_${partnerId}`,\n      expiresDays: CONSTANTS.STORAGE_CONFIG.PD.expiresDays\n    };\n  }\n\n  /**\n   * creates a hash of a user identifier for storage\n   * @param {string} userId\n   * @returns {string}\n   */\n  static makeStoredHash(userId) {\n    return cyrb53Hash(typeof userId === 'string' ? userId : '');\n  }\n\n  getDateTime() {\n    return (new Date(this.get(CONSTANTS.STORAGE_CONFIG.LAST))).getTime();\n  }\n\n  clearDateTime() {\n    this.clear(CONSTANTS.STORAGE_CONFIG.LAST);\n  }\n\n  setDateTime(timestamp) {\n    this.put(CONSTANTS.STORAGE_CONFIG.LAST, timestamp);\n  }\n\n  static nbCacheConfig(partnerId) {\n    return {\n      name: `${CONSTANTS.STORAGE_CONFIG.ID5.name}_${partnerId}_nb`,\n      expiresDays: CONSTANTS.STORAGE_CONFIG.ID5.expiresDays\n    };\n  }\n\n  getNb(partnerId) {\n    const cachedNb = this.get(ClientStore.nbCacheConfig(partnerId));\n    return (cachedNb) ? parseInt(cachedNb) : 0;\n  }\n\n  clearNb(partnerId) {\n    this.clear(ClientStore.nbCacheConfig(partnerId));\n  }\n\n  setNb(partnerId, nb) {\n    this.put(ClientStore.nbCacheConfig(partnerId), nb);\n  }\n\n  incNb(partnerId, nb) {\n    nb++;\n    this.setNb(partnerId, nb);\n    return nb;\n  }\n\n  clearAll(partnerId) {\n    this.clearResponse();\n    this.clearDateTime();\n    this.clearNb(partnerId);\n    this.clearHashedPd(partnerId);\n    this.clearHashedConsentData();\n  }\n\n  removeLegacyCookies(partnerId) {\n    const expired = (new Date(Date.now() - 1000)).toUTCString();\n    CONSTANTS.LEGACY_COOKIE_NAMES.forEach(function (cookie) {\n      setCookie(`${cookie}`, '', expired);\n      setCookie(`${cookie}_nb`, '', expired);\n      setCookie(`${cookie}_${partnerId}_nb`, '', expired);\n      setCookie(`${cookie}_last`, '', expired);\n      setCookie(`${cookie}.cached_pd`, '', expired);\n      setCookie(`${cookie}.cached_consent_data`, '', expired);\n    });\n  }\n\n  /**\n   * test if the data stored locally matches the current data.\n   * if there is nothing in storage, return true and we'll do an actual comparison next time.\n   * this way, we don't force a refresh for every user when this code rolls out\n   * @param storedData\n   * @param currentData\n   * @returns {boolean}\n   */\n  static storedDataMatchesCurrentData(storedData, currentData) {\n    return (\n      typeof storedData === 'undefined' ||\n      storedData === null ||\n      storedData === currentData\n    );\n  }\n\n  storedConsentDataMatchesConsentData(consentData) {\n    return ClientStore.storedDataMatchesCurrentData(this.getHashedConsentData(), ClientStore.makeStoredConsentDataHash(consentData));\n  }\n\n  /**\n   * makes an object that can be stored with only the keys we need to check.\n   * excluding the vendorConsents object since the consentString is enough to know\n   * if consent has changed without needing to have all the details in an object\n   * @param consentData\n   * @returns string\n   */\n  static makeStoredConsentDataHash(consentData) {\n    const storedConsentData = {\n      consentString: '',\n      gdprApplies: false,\n      apiVersion: 0\n    };\n\n    if (consentData) {\n      storedConsentData.consentString = consentData.consentString;\n      storedConsentData.gdprApplies = consentData.gdprApplies;\n      storedConsentData.apiVersion = consentData.apiVersion;\n    }\n\n    return cyrb53Hash(JSON.stringify(storedConsentData));\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/clientStore.js","import * as utils from './utils.js';\nimport CONSTANTS from './constants.json';\n\nexport default class ConsentManagement {\n  consentData;\n  staticConsentData;\n  storedPrivacyData;\n  cmpVersion = 0;\n  /** @type {LocalStorage} */\n  localStorage;\n\n  cmpCallMap = {\n    'iab': this.lookupIabConsent,\n    'static': this.lookupStaticConsentData\n  };\n\n  /**\n   * @param {LocalStorage} localStorage the localStorage object to use\n   */\n  constructor(localStorage) {\n    this.localStorage = localStorage;\n  }\n\n  /**\n   * This function reads the consent string from the config to obtain the consent information of the user.\n   * @param {function(ConsentManagement, string, function(object))} cmpSuccess acts as a success callback when the value is read from config; pass along consentObject (string) from CMP\n   * @param {function(object)} finalCallback acts as an error callback while interacting with the config string; pass along an error message (string)\n   */\n  lookupStaticConsentData(cmpSuccess, finalCallback) {\n    this.cmpVersion = (this.staticConsentData.getConsentData) ? 1 : (this.staticConsentData.getTCData) ? 2 : 0;\n    utils.logInfo(`Using static consent data from config for TCF v${this.cmpVersion}`, this.staticConsentData);\n\n    if (this.cmpVersion === 2) {\n      // remove extra layer in static v2 data object so it matches normal v2 CMP object for processing step\n      cmpSuccess(this, this.staticConsentData.getTCData, finalCallback);\n    } else {\n      cmpSuccess(this, this.staticConsentData, finalCallback);\n    }\n  }\n\n  /**\n   * @typedef {Object} CMPDetails\n   * @property {number} cmpVersion - Version of CMP Found, 0 if not found\n   * @property {function} [cmpFrame] -\n   * @property {function} [cmpFunction] -\n   *\n   * This function tries to find the CMP in page.\n   * @return {CMPDetails}\n   */\n  static findCMP() {\n    let cmpVersion = 0;\n    let f = window;\n    let cmpFrame;\n    let cmpFunction;\n    while (!cmpFrame) {\n      try {\n        if (typeof f.__tcfapi === 'function' || typeof f.__cmp === 'function') {\n          if (typeof f.__tcfapi === 'function') {\n            cmpVersion = 2;\n            cmpFunction = f.__tcfapi;\n          } else {\n            cmpVersion = 1;\n            cmpFunction = f.__cmp;\n          }\n          cmpFrame = f;\n          break;\n        }\n      } catch (e) { }\n\n      // need separate try/catch blocks due to the exception errors thrown when trying to check for a frame that doesn't exist in 3rd party env\n      try {\n        if (f.frames['__tcfapiLocator']) {\n          cmpVersion = 2;\n          cmpFrame = f;\n          break;\n        }\n      } catch (e) { }\n\n      try {\n        if (f.frames['__cmpLocator']) {\n          cmpVersion = 1;\n          cmpFrame = f;\n          break;\n        }\n      } catch (e) { }\n\n      if (f === window.top) break;\n      f = f.parent;\n    }\n    return {\n      cmpVersion,\n      cmpFrame,\n      cmpFunction\n    };\n  }\n  /**\n   * This function handles async interacting with an IAB compliant CMP to obtain the consent information of the user.\n   * @param {function(ConsentManagement, string, function(object))} cmpSuccess acts as a success callback when CMP returns a value; pass along consentObject (string) from CMP\n   * @param {function(object)} finalCallback required;\n   */\n  lookupIabConsent(cmpSuccess, finalCallback) {\n    const consentThis = this;\n    function v2CmpResponseCallback(tcfData, success) {\n      utils.logInfo('Received a response from CMP', tcfData);\n      if (success) {\n        if (tcfData.gdprApplies === false || tcfData.eventStatus === 'tcloaded' || tcfData.eventStatus === 'useractioncomplete') {\n          cmpSuccess(consentThis, tcfData, finalCallback);\n        }\n      } else {\n        utils.logError(`CMP unable to register callback function.  Please check CMP setup.`);\n        cmpSuccess(consentThis, undefined, finalCallback);\n        // TODO cmpError('CMP unable to register callback function.  Please check CMP setup.', hookConfig);\n      }\n    }\n\n    function handleV1CmpResponseCallbacks() {\n      const cmpResponse = {};\n\n      function afterEach() {\n        if (cmpResponse.getConsentData && cmpResponse.getVendorConsents) {\n          cmpSuccess(consentThis, cmpResponse, finalCallback);\n        }\n      }\n\n      return {\n        consentDataCallback: function (consentResponse) {\n          utils.logInfo(`cmpApi: consentDataCallback`);\n          cmpResponse.getConsentData = consentResponse;\n          afterEach();\n        },\n        vendorConsentsCallback: function (consentResponse) {\n          utils.logInfo(`cmpApi: vendorConsentsCallback`);\n          cmpResponse.getVendorConsents = consentResponse;\n          afterEach();\n        }\n      };\n    }\n\n    let v1CallbackHandler = handleV1CmpResponseCallbacks();\n    let {cmpVersion, cmpFrame, cmpFunction} = ConsentManagement.findCMP();\n    this.cmpVersion = cmpVersion;\n\n    if (!cmpFrame) {\n      // TODO implement cmpError\n      // return cmpError('CMP not found.', hookConfig);\n      utils.logError(`CMP not found`);\n      cmpSuccess(consentThis, undefined, finalCallback);\n      return;\n    }\n\n    if (utils.isFn(cmpFunction)) {\n      utils.logInfo(`cmpApi: calling getConsentData & getVendorConsents`);\n      if (cmpVersion === 1) {\n        cmpFunction('getConsentData', null, v1CallbackHandler.consentDataCallback);\n        cmpFunction('getVendorConsents', null, v1CallbackHandler.vendorConsentsCallback);\n      } else if (cmpVersion === 2) {\n        cmpFunction('addEventListener', cmpVersion, v2CmpResponseCallback);\n      }\n    } else {\n      cmpSuccess(consentThis, undefined, finalCallback);\n    }\n  }\n\n  /**\n   * Try to fetch consent from CMP\n   * @param {boolean} debugBypassConsent\n   * @param {string} cmpApi - CMP Api to use\n   * @param {object} [providedConsentData] - static consent data provided to ID5 API\n   * @param {function(object)} finalCallback required; final callback\n   */\n  requestConsent(debugBypassConsent, cmpApi, providedConsentData, finalCallback) {\n    if (debugBypassConsent) {\n      utils.logWarn('ID5 is operating in forced consent mode and will not retrieve any consent signals from the CMP');\n      finalCallback(this.consentData);\n    } else if (!this.cmpCallMap[cmpApi]) {\n      utils.logError(`Unknown consent API: ${cmpApi}`);\n      this.resetConsentData();\n      finalCallback(this.consentData);\n    } else if (!this.consentData) {\n      if (cmpApi === 'static') {\n        if (utils.isPlainObject(providedConsentData)) {\n          this.staticConsentData = providedConsentData;\n        } else {\n          utils.logError(`cmpApi: 'static' did not specify consent data.`);\n        }\n      }\n      this.cmpCallMap[cmpApi].call(this, ConsentManagement.cmpSuccess, finalCallback);\n    } else {\n      finalCallback(this.consentData);\n    }\n  }\n\n  /**\n   * This function checks the consent data provided by CMP to ensure it's in an expected state.\n   * @param {ConsentManagement} consentThis\n   * @param {object} consentObject required; object returned by CMP that contains user's consent choices\n   * @param {function(object)} finalCallback required; final callback receiving the consent\n   */\n  static cmpSuccess(consentThis, consentObject, finalCallback) {\n    function checkV1Data(consentObject) {\n      let gdprApplies = consentObject && consentObject.getConsentData && consentObject.getConsentData.gdprApplies;\n      return !!(\n        (typeof gdprApplies !== 'boolean') ||\n        (gdprApplies === true &&\n          !(utils.isStr(consentObject.getConsentData.consentData) &&\n            utils.isPlainObject(consentObject.getVendorConsents) &&\n            Object.keys(consentObject.getVendorConsents).length > 1\n          )\n        )\n      );\n    }\n\n    function checkV2Data() {\n      let gdprApplies = consentObject && typeof consentObject.gdprApplies === 'boolean' ? consentObject.gdprApplies : undefined;\n      let tcString = consentObject && consentObject.tcString;\n      return !!(\n        (typeof gdprApplies !== 'boolean') ||\n        (gdprApplies === true && !utils.isStr(tcString))\n      );\n    }\n\n    // determine which set of checks to run based on cmpVersion\n    let checkFn = (consentThis.cmpVersion === 1) ? checkV1Data : (consentThis.cmpVersion === 2) ? checkV2Data : null;\n    utils.logInfo('CMP Success callback for version', consentThis.cmpVersion, checkFn);\n    if (utils.isFn(checkFn)) {\n      if (checkFn(consentObject)) {\n        consentThis.resetConsentData();\n        utils.logError(`CMP returned unexpected value during lookup process.`, consentObject);\n      } else {\n        consentThis.storeConsentData(consentObject);\n      }\n    } else {\n      // TODO: Log unhandled CMP version\n    }\n\n    finalCallback(consentThis.consentData);\n  }\n\n  /**\n   * Simply resets the module's consentData variable back to undefined, mainly for testing purposes\n   */\n  resetConsentData() {\n    this.consentData = undefined;\n    this.storedPrivacyData = undefined;\n  }\n\n  /**\n   * Stores CMP data locally in module\n   * @param {object} cmpConsentObject required; an object representing user's consent choices (can be undefined in certain use-cases for this function only)\n   */\n  storeConsentData(cmpConsentObject) {\n    if (this.cmpVersion === 1) {\n      this.consentData = {\n        consentString: (cmpConsentObject) ? cmpConsentObject.getConsentData.consentData : undefined,\n        vendorData: (cmpConsentObject) ? cmpConsentObject.getVendorConsents : undefined,\n        gdprApplies: (cmpConsentObject) ? cmpConsentObject.getConsentData.gdprApplies : undefined,\n        apiVersion: 1\n      };\n    } else if (this.cmpVersion === 2) {\n      this.consentData = {\n        consentString: (cmpConsentObject) ? cmpConsentObject.tcString : undefined,\n        vendorData: (cmpConsentObject) || undefined,\n        gdprApplies: cmpConsentObject && typeof cmpConsentObject.gdprApplies === 'boolean' ? cmpConsentObject.gdprApplies : undefined,\n        apiVersion: 2\n      };\n    } else {\n      this.consentData = {\n        apiVersion: 0\n      };\n    }\n  }\n\n  /**\n   * test if consent module is present, applies, and is valid for local storage or cookies (purpose 1)\n   * @param {boolean} allowLocalStorageWithoutConsentApi\n   * @param {boolean} debugBypassConsent\n   * @returns {boolean|undefined} undefined in case no consent data and no stored privacy info is available\n   */\n  isLocalStorageAllowed(allowLocalStorageWithoutConsentApi, debugBypassConsent) {\n    if (allowLocalStorageWithoutConsentApi === true || debugBypassConsent === true) {\n      utils.logWarn('Local storage access granted by configuration override, consent will not be checked');\n      return true;\n    } else if (!this.consentData) {\n      // no cmp on page, so check if provisional access is allowed\n      return this.isProvisionalLocalStorageAllowed();\n    } else if (typeof this.consentData.gdprApplies === 'boolean' && this.consentData.gdprApplies) {\n      // gdpr applies\n      if (!this.consentData.consentString || this.consentData.apiVersion === 0) {\n        return false;\n      } else if (this.consentData.apiVersion === 1 && this.consentData.vendorData &&\n        this.consentData.vendorData.purposeConsents &&\n        this.consentData.vendorData.purposeConsents['1'] === false) {\n        return false;\n      } else if (this.consentData.apiVersion === 2 && this.consentData.vendorData &&\n        this.consentData.vendorData.purpose && this.consentData.vendorData.purpose.consents &&\n        this.consentData.vendorData.purpose.consents['1'] === false) {\n        return false;\n      } else {\n        return true;\n      }\n    } else {\n      // we have consent data and it tells us gdpr doesn't apply\n      return true;\n    }\n  }\n\n  /**\n   * if there is no CMP on page, consentData will be undefined, so we will check if we had stored\n   * privacy data from a previous request to determine if we are allowed to access local storage.\n   * if so, we use the previous authorization as a legal basis before calling our servers to confirm.\n   * if we do not have any stored privacy data, we will need to call our servers to know if we\n   * are in a jurisdiction that requires consent or not before accessing local storage.\n   *\n   * if there is no stored privacy data or jurisdiction wasn't set, will return undefined so the\n   * caller can decide what to do with in that case\n   *\n   * @return {boolean|undefined}\n   */\n  isProvisionalLocalStorageAllowed() {\n    if (!utils.isPlainObject(this.storedPrivacyData)) {\n      const privacyData = this.localStorage.getItemWithExpiration(CONSTANTS.STORAGE_CONFIG.PRIVACY);\n      this.storedPrivacyData = privacyData && JSON.parse(privacyData);\n    }\n\n    if (this.storedPrivacyData && this.storedPrivacyData.id5_consent === true) {\n      return true;\n    } else if (!this.storedPrivacyData || typeof this.storedPrivacyData.jurisdiction === 'undefined') {\n      return undefined;\n    } else {\n      const jurisdictionRequiresConsent = (typeof CONSTANTS.PRIVACY.JURISDICTIONS[this.storedPrivacyData.jurisdiction] !== 'undefined') ? CONSTANTS.PRIVACY.JURISDICTIONS[this.storedPrivacyData.jurisdiction] : false;\n      return (jurisdictionRequiresConsent === false || this.storedPrivacyData.id5_consent === true);\n    }\n  }\n\n  setStoredPrivacy(privacy) {\n    try {\n      if (utils.isPlainObject(privacy)) {\n        this.storedPrivacyData = privacy;\n        this.localStorage.setItemWithExpiration(CONSTANTS.STORAGE_CONFIG.PRIVACY,\n          JSON.stringify(privacy));\n      } else {\n        utils.logInfo('Cannot store privacy if it is not an object: ', privacy);\n      }\n    } catch (e) {\n      utils.logError(e);\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/consentManagement.js","/*\n * Module for getting and setting ID5 API configuration.\n */\nimport { logError, isA } from './utils';\n\n/**\n * @typedef {Object} Id5Options\n * @property {number} [partnerId] - ID5 Publisher ID, mandatory\n * @property {boolean|false} [debugBypassConsent] - Bypass consent API et local storage consent for testing purpose only\n * @property {boolean|false} [allowLocalStorageWithoutConsentApi] - Tell ID5 that consent has been given to read local storage\n * @property {number} [refreshInSeconds] - Refresh period of first-party cookie (defaulting to 7200s)\n * @property {string} [partnerUserId] - User ID for the platform deploying the API, to be stored by ID5 for further cookie matching if provided\n * @property {string} [cmpApi] - API to use CMP. As of today, either 'iab' or 'static'\n * @property {object} [consentData] - Consent data if cmpApi is 'static'\n * @property {function} [callbackOnAvailable] - Function to call back when User ID is available. if callbackTimeoutInMs is not provided, will be fired only if a User ID is available.\n * @property {function} [callbackOnUpdates] - Function to call back on further updates of User ID by changes in the page (consent, pd, refresh). Cannot be provided if `callbackOnAvailable` is not provided\n * @property {number} [callbackTimeoutInMs] - Delay in ms after which the callbackOnAvailable is guaranteed to be fired. A User ID may not yet be available at this time.\n * @property {string} [pd] - Partner Data that can be passed to help with cross-domain reconciliation of the ID5 ID, more details here: https://support.id5.io/portal/en/kb/articles/passing-partner-data-to-id5\n * @property {AbTestConfig} [abTesting] - An object defining if and how A/B testing should be enabled\n * @property {string} [provider] - Defines who is deploying the API on behalf of the partner. A hard-coded value that will be provided by ID5 when applicable\n * @property {number} [maxCascades] - Defines the maximum number of cookie syncs that can occur when usersyncing for the user is required. A value of -1 will disable cookie syncing altogether. Defaults to 8\n * @property {boolean} [applyCreativeRestrictions] - When true some restrictions are applied, for example avoid writing to localStorage and avoid cookie syncing.\n */\n\n/**\n * @typedef {Object} AbTestConfig\n * @property {boolean|false} [enabled] - Enable control group\n * @property {number} [controlGroupPct] - Ratio of users in control group [0,1]\n */\n\nexport default class Config {\n  /** @type {Id5Options} */\n  options;\n\n  /** @type {Id5Options} */\n  providedOptions;\n\n  static configTypes = {\n    debugBypassConsent: 'Boolean',\n    allowLocalStorageWithoutConsentApi: 'Boolean',\n    cmpApi: 'String',\n    consentData: 'Object',\n    refreshInSeconds: 'Number',\n    partnerId: 'Number',\n    partnerUserId: 'String',\n    callbackOnAvailable: 'Function',\n    callbackOnUpdates: 'Function',\n    callbackTimeoutInMs: 'Number',\n    pd: 'String',\n    abTesting: 'Object',\n    provider: 'String',\n    maxCascades: 'Number',\n    applyCreativeRestrictions: 'Boolean'\n  };\n\n  /**\n   * Create configuration instance from an object containing key-value pairs\n   * @param {Id5Options} options\n   */\n  constructor(options) {\n    this.options = {\n      debugBypassConsent: false,\n      allowLocalStorageWithoutConsentApi: false,\n      cmpApi: 'iab',\n      consentData: {\n        getConsentData: {\n          consentData: undefined,\n          gdprApplies: undefined\n        },\n        getVendorConsents: {}\n      },\n      refreshInSeconds: 7200,\n      partnerId: undefined,\n      partnerUserId: undefined,\n      callbackOnAvailable: undefined,\n      callbackOnUpdates: undefined,\n      callbackTimeoutInMs: undefined,\n      pd: undefined,\n      abTesting: {\n        enabled: false,\n        controlGroupPct: 0\n      },\n      provider: undefined,\n      maxCascades: 8,\n      applyCreativeRestrictions: false\n    };\n    this.providedOptions = {};\n\n    if (!options.partnerId || typeof options.partnerId !== 'number') {\n      throw new Error('partnerId is required and must be a number');\n    }\n\n    this.updOptions(options);\n  }\n\n  /**\n   * Return current configuration\n   * @returns {Id5Options} options\n   */\n  getOptions() {\n    return this.options;\n  }\n\n  /**\n   * Return configuration set by user\n   * @returns {Id5Options} options\n   */\n  getProvidedOptions() {\n    return this.providedOptions;\n  }\n\n  /**\n   * Override the configuration with an object containing key-value pairs\n   * @param {Id5Options} options\n   */\n  updOptions(options) {\n    if (typeof options !== 'object') {\n      logError('Config options must be an object');\n      return;\n    }\n\n    if (typeof this.options.partnerId === 'number' && // Might be undefined\n      typeof options.partnerId === 'number' &&\n      options.partnerId !== this.options.partnerId) {\n      throw new Error('Cannot update config with a different partnerId');\n    }\n\n    Object.keys(options).forEach(topic => {\n      if (isA(options[topic], Config.configTypes[topic])) {\n        this.options[topic] = options[topic];\n        this.providedOptions[topic] = options[topic];\n      } else {\n        logError(`updOptions options ${topic} must be of type ${Config.configTypes[topic]} but was ${toString.call(options[topic])}`);\n      }\n    });\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/config.js","import ID5 from '../lib/id5-api';\n\nif (!window.ID5) {\n  window.ID5 = ID5;\n} else {\n  // TODO: Check for different versions in the same page at init\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","/** @module id5-api */\n\nimport {\n  setGlobalDebug,\n  isGlobalDebug,\n  logInfo,\n  logError,\n  isBoolean,\n  ajax,\n  isStr,\n  deferPixelFire } from './utils';\nimport { getRefererInfo } from './refererDetection';\nimport ClientStore from './clientStore';\nimport ConsentManagement from './consentManagement';\nimport Id5Status from './id5Status';\nimport { version as currentVersion } from '../generated/version.js';\nimport LocalStorage from './localStorage.js';\nimport Config from './config';\n\n/**\n * Singleton which represents the entry point of the API.\n * In the ID5's id5-api.js bundle this is installed under window.ID5.\n */\nclass Id5Api {\n  /** @type {boolean} */\n  loaded = false;\n  /** @type {boolean} */\n  set debug(isDebug) {\n    setGlobalDebug(isDebug);\n  }\n  get debug() {\n    return isGlobalDebug();\n  }\n  /** @type {boolean} */\n  _isUsingCdn = false;\n\n  /** @type {object} */\n  _referer = false;\n  /** @type {string} */\n  _version = currentVersion;\n  /** @type {object} */\n  versions = {};\n\n  constructor() {\n    this.loaded = true;\n    this._isUsingCdn = !!(\n      document &&\n      document.currentScript &&\n      document.currentScript.src &&\n      document.currentScript.src.indexOf('https://cdn.id5-sync.com') === 0\n    );\n    this._referer = getRefererInfo();\n    this.versions[currentVersion] = true;\n  }\n\n  /**\n   * This function will initialize ID5, wait for consent then try to fetch or refresh ID5 user id if required\n   * @param {Id5Options} passedOptions\n   * @return {Id5Status} Status of the ID5 API for this caller, for further interactions\n   */\n  init(passedOptions) {\n    try {\n      logInfo('Invoking Id5Api.init', arguments);\n\n      const config = new Config(passedOptions);\n      const options = config.getOptions();\n\n      // By using window.top we say we want to use storage only if we're in a first-party context\n      const localStorage = new LocalStorage(window.top, !options.applyCreativeRestrictions);\n\n      const consentManagement = new ConsentManagement(localStorage);\n      const clientStore = new ClientStore(() => consentManagement.isLocalStorageAllowed(options.allowLocalStorageWithoutConsentApi, options.debugBypassConsent),\n        localStorage);\n\n      const partnerStatus = new Id5Status(config, clientStore, consentManagement);\n      this.getId(partnerStatus, false);\n      logInfo(`ID5 initialized for partner ${options.partnerId} with referer ${this._referer.referer} and options`, passedOptions);\n      return partnerStatus;\n    } catch (e) {\n      logError('Exception caught from Id5Api.init', e);\n    }\n  };\n\n  /**\n   * @param {Id5Status} id5Status - Initializes id5Status returned by `init()`\n   * @param {boolean} forceFetch\n   * @param {Id5Options} [options] - Options to update\n   * @return {Id5Status} provided id5Status for chaining\n   */\n  refreshId(id5Status, forceFetch = false, options = {}) {\n    if (!isBoolean(forceFetch)) {\n      throw new Error('Invalid signature for Id5Api.refreshId: second parameter must be a boolean');\n    }\n\n    try {\n      logInfo('Invoking Id5Api.refreshId', arguments);\n      id5Status.startRefresh(forceFetch);\n      id5Status.updateOptions(options);\n      id5Status.consentManagement.resetConsentData();\n      this.getId(id5Status, forceFetch);\n    } catch (e) {\n      logError('Exception caught from Id5Api.refreshId', e);\n    }\n    return id5Status;\n  };\n\n  /**\n   * This function get the user ID for the given config\n   * @param {Id5Status} id5Status\n   * @param {boolean} forceFetch - Force a call to server\n   */\n  getId(id5Status, forceFetch = false) {\n    const options = id5Status.getOptions();\n    let storedResponse;\n    let storedDateTime;\n    let nb = 0;\n    let refreshInSecondsHasElapsed = false;\n    let pdHasChanged = false;\n    let cachedResponseUsed = false;\n\n    if (id5Status.localStorageAllowed()) {\n      storedResponse = id5Status.clientStore.getResponse();\n      storedDateTime = id5Status.clientStore.getDateTime();\n\n      refreshInSecondsHasElapsed = storedDateTime <= 0 || ((Date.now() - storedDateTime) > (options.refreshInSeconds * 1000));\n      nb = id5Status.clientStore.getNb(options.partnerId);\n      pdHasChanged = !id5Status.clientStore.storedPdMatchesPd(options.partnerId, options.pd);\n    }\n\n    if (!storedResponse) {\n      storedResponse = id5Status.clientStore.getResponseFromLegacyCookie();\n      refreshInSecondsHasElapsed = true; // Force a refresh if we have legacy cookie\n    }\n\n    if (storedResponse && storedResponse.universal_uid && !pdHasChanged) {\n      // we have a valid stored response and pd is not different, so\n      // use the stored response to make the ID available right away\n\n      id5Status.setUserId(storedResponse, true);\n      nb = id5Status.clientStore.incNb(options.partnerId, nb);\n      cachedResponseUsed = true;\n\n      logInfo('ID5 User ID available from cache:', {\n        storedResponse,\n        storedDateTime,\n        refreshNeeded: refreshInSecondsHasElapsed\n      });\n    } else if (storedResponse && storedResponse.universal_uid && pdHasChanged) {\n      logInfo('PD value has changed, so ignoring User ID from cache');\n    } else if (storedResponse && !storedResponse.universal_uid) {\n      logError('Invalid stored response: ', storedResponse);\n    } else {\n      logInfo('No ID5 User ID available from cache');\n    }\n\n    id5Status.consentManagement.requestConsent(options.debugBypassConsent, options.cmpApi, options.consentData, (consentData) => {\n      if (id5Status.localStorageAllowed() !== false) {\n        logInfo('Consent to access local storage is: ' + id5Status.localStorageAllowed());\n\n        storedResponse = id5Status.clientStore.getResponse() || id5Status.clientStore.getResponseFromLegacyCookie();\n\n        // store hashed consent data and pd for future page loads\n        const consentHasChanged = !id5Status.clientStore.storedConsentDataMatchesConsentData(consentData);\n        id5Status.clientStore.putHashedConsentData(consentData);\n        id5Status.clientStore.putHashedPd(options.partnerId, options.pd);\n\n        // make a call to fetch a new ID5 ID if:\n        // - there is no valid universal_uid or no signature in cache\n        // - the last refresh was longer than refreshInSeconds ago\n        // - consent has changed since the last ID was fetched\n        // - pd has changed since the last ID was fetched\n        // - fetch is being forced (e.g. by refreshId())\n        if (\n          !storedResponse || !storedResponse.universal_uid || !storedResponse.signature ||\n          refreshInSecondsHasElapsed ||\n          consentHasChanged ||\n          pdHasChanged ||\n          forceFetch\n        ) {\n          const url = `https://id5-sync.com/g/v2/${options.partnerId}.json`;\n          const gdprApplies = (consentData && consentData.gdprApplies) ? 1 : 0;\n          const gdprConsentString = (consentData && consentData.gdprApplies) ? consentData.consentString : undefined;\n          const signature = (storedResponse && storedResponse.signature) ? storedResponse.signature : undefined;\n          const data = {\n            'partner': options.partnerId,\n            'v': this._version,\n            'o': 'api',\n            'gdpr': gdprApplies,\n            'rf': this._referer.referer,\n            'u': this._referer.stack[0] || window.location.href,\n            'top': this._referer.reachedTop ? 1 : 0,\n            'localStorage': id5Status.clientStore.isLocalStorageAvailable() ? 1 : 0,\n            'nbPage': nb,\n            'id5cdn': this._isUsingCdn\n          };\n\n          // pass in optional data, but only if populated\n          if (typeof gdprConsentString !== 'undefined') {\n            data.gdpr_consent = gdprConsentString;\n          }\n          if (typeof signature !== 'undefined') {\n            data.s = signature;\n          }\n          if (typeof options.pd !== 'undefined') {\n            data.pd = options.pd;\n          }\n          if (typeof options.partnerUserId !== 'undefined') {\n            data.puid = options.partnerUserId;\n          }\n          if (typeof options.provider !== 'undefined') {\n            data.provider = options.provider;\n          }\n\n          // pass in A/B Testing configuration, if applicable\n          if (options.abTesting.enabled === true) {\n            data.ab_testing = {\n              enabled: true,\n              control_group_pct: id5Status.getOptions().abTesting.controlGroupPct\n            };\n          }\n\n          logInfo('Fetching ID5 user ID from:', url, data);\n          if (forceFetch) {\n            logInfo('...with Force Fetch');\n          }\n          ajax(url, {\n            success: response => {\n              logInfo('Response from ID5 received:', response);\n              let responseObj;\n              if (response) {\n                try {\n                  responseObj = JSON.parse(response);\n                  logInfo('Valid json response from ID5 received:', responseObj);\n                  if (isStr(responseObj.universal_uid)) {\n                    id5Status.setUserId(responseObj, false);\n\n                    // privacy has to be stored first so we can use it when storing other values\n                    id5Status.consentManagement.setStoredPrivacy(responseObj.privacy);\n\n                    // @TODO: typeof responseObj.privacy === 'undefined' is only needed until fetch endpoint is updated and always returns a privacy object\n                    // once it does, I don't see a reason to keep that part of the if clause\n                    if (id5Status.localStorageAllowed() === true || typeof responseObj.privacy === 'undefined') {\n                      id5Status.clientStore.putResponse(response);\n                      id5Status.clientStore.setDateTime(new Date().toUTCString());\n                      id5Status.clientStore.setNb(options.partnerId, (cachedResponseUsed ? 0 : 1));\n                    } else {\n                      id5Status.clientStore.clearAll(options.partnerId);\n                    }\n                    // TEMPORARY until all clients have upgraded past v1.0.0\n                    // remove cookies that were previously set\n                    id5Status.clientStore.removeLegacyCookies(options.partnerId);\n\n                    if (responseObj.cascade_needed === true && id5Status.localStorageAllowed() === true && options.maxCascades >= 0 && !options.applyCreativeRestrictions) {\n                      const isSync = options.partnerUserId && options.partnerUserId.length > 0;\n                      const syncUrl = `https://id5-sync.com/${isSync ? 's' : 'i'}/${options.partnerId}/${options.maxCascades}.gif?id5id=${id5Status._userId}&o=api&${isSync ? 'puid=' + options.partnerUserId + '&' : ''}gdpr_consent=${gdprConsentString}&gdpr=${gdprApplies}`;\n                      logInfo('Opportunities to cascade available:', syncUrl);\n                      deferPixelFire(syncUrl);\n                    }\n                  } else {\n                    logError('Invalid response from ID5 servers:', response);\n                  }\n                } catch (error) {\n                  logError(error);\n                }\n              } else {\n                logError('Empty response from ID5 servers:', response);\n              }\n            },\n            error: error => {\n              logError(error);\n            }\n          }, JSON.stringify(data), {method: 'POST', withCredentials: true});\n        }\n      } else {\n        logInfo('No legal basis to use ID5', consentData);\n      }\n    });\n  }\n}\n\nconst ID5 = new Id5Api();\nexport default ID5;\n\n\n\n// WEBPACK FOOTER //\n// ./lib/id5-api.js","/**\n * The referer detection module attempts to gather referer information from the current page that id5-api.js resides in.\n * The information that it tries to collect includes:\n * The detected top url in the nav bar,\n * Whether it was able to reach the top most window (if for example it was embedded in several iframes),\n * The number of iframes it was embedded in if applicable,\n * A list of the domains of each embedded window if applicable.\n * Canonical URL which refers to an HTML link element, with the attribute of rel=\"canonical\", found in the <head> element of your webpage\n */\n\nexport function detectReferer(win) {\n  /**\n   * Returns number of frames to reach top from current frame\n   * @returns {Array} levels\n   */\n  function getLevels() {\n    let levels = walkUpWindows();\n    let ancestors = getAncestorOrigins();\n\n    if (ancestors) {\n      for (let i = 0, l = ancestors.length; i < l; i++) {\n        levels[i].ancestor = ancestors[i];\n      }\n    }\n    return levels;\n  }\n\n  /**\n   * This function would return a read-only array of hostnames for all the parent frames.\n   * win.location.ancestorOrigins is only supported in webkit browsers. For non-webkit browsers it will return undefined.\n   * @returns {(undefined|Array)} Ancestor origins or undefined\n   */\n  function getAncestorOrigins() {\n    try {\n      if (!win.location.ancestorOrigins) {\n        return;\n      }\n      return win.location.ancestorOrigins;\n    } catch (e) {\n      // Ignore error\n    }\n  }\n\n  /**\n   * This function would try to get referer and urls for all parent frames in case of win.location.ancestorOrigins undefined.\n   * @param {Array} levels\n   * @returns {Object} urls for all parent frames and top most detected referer url\n   */\n  function getPubUrlStack(levels) {\n    let stack = [];\n    let defUrl = null;\n    let frameLocation = null;\n    let prevFrame = null;\n    let prevRef = null;\n    let ancestor = null;\n    let detectedRefererUrl = null;\n\n    let i;\n    for (i = levels.length - 1; i >= 0; i--) {\n      try {\n        frameLocation = levels[i].location;\n      } catch (e) {\n        // Ignore error\n      }\n\n      if (frameLocation) {\n        stack.push(frameLocation);\n        if (!detectedRefererUrl) {\n          detectedRefererUrl = frameLocation;\n        }\n      } else if (i !== 0) {\n        prevFrame = levels[i - 1];\n        try {\n          prevRef = prevFrame.referrer;\n          ancestor = prevFrame.ancestor;\n        } catch (e) {\n          // Ignore error\n        }\n\n        if (prevRef) {\n          stack.push(prevRef);\n          if (!detectedRefererUrl) {\n            detectedRefererUrl = prevRef;\n          }\n        } else if (ancestor) {\n          stack.push(ancestor);\n          if (!detectedRefererUrl) {\n            detectedRefererUrl = ancestor;\n          }\n        } else {\n          stack.push(defUrl);\n        }\n      } else {\n        stack.push(defUrl);\n      }\n    }\n    return {\n      stack,\n      detectedRefererUrl\n    };\n  }\n\n  /**\n   * This function returns canonical URL which refers to an HTML link element, with the attribute of rel=\"canonical\", found in the <head> element of your webpage\n   * @param {Object} doc document\n   */\n  function getCanonicalUrl(doc) {\n    try {\n      let element = doc.querySelector(\"link[rel='canonical']\");\n      if (element !== null) {\n        return element.href;\n      }\n    } catch (e) {\n    }\n    return null;\n  }\n\n  /**\n   * Walk up to the top of the window to detect origin, number of iframes, ancestor origins and canonical url\n   */\n  function walkUpWindows() {\n    let acc = [];\n    let currentWindow;\n    do {\n      try {\n        currentWindow = currentWindow ? currentWindow.parent : win;\n        try {\n          let isTop = (currentWindow === win.top);\n          let refData = {\n            referrer: currentWindow.document.referrer || null,\n            location: currentWindow.location.href || null,\n            isTop\n          };\n          if (isTop) {\n            refData = Object.assign(refData, {\n              canonicalUrl: getCanonicalUrl(currentWindow.document)\n            });\n          }\n          acc.push(refData);\n        } catch (e) {\n          acc.push({\n            referrer: null,\n            location: null,\n            isTop: (currentWindow === win.top)\n          });\n        }\n      } catch (e) {\n        acc.push({\n          referrer: null,\n          location: null,\n          isTop: false\n        });\n        return acc;\n      }\n    } while (currentWindow !== win.top);\n    return acc;\n  }\n\n  /**\n   * Referer info\n   * @typedef {Object} refererInfo\n   * @property {string} referer - detected top url\n   * @property {boolean} reachedTop - whether it was possible to walk upto top window or not\n   * @property {number} numIframes - number of iframes\n   * @property {string} stack - comma separated urls of all origins\n   * @property {string} canonicalUrl - canonical URL refers to an HTML link element, with the attribute of rel=\"canonical\", found in the <head> element of your webpage\n   */\n\n  /**\n   * Get referer info\n   * @returns {refererInfo}\n   */\n  function refererInfo() {\n    try {\n      let levels = getLevels();\n      let numIframes = levels.length - 1;\n      let reachedTop = (levels[numIframes].location !== null ||\n        (numIframes > 0 && levels[numIframes - 1].referrer !== null));\n      let stackInfo = getPubUrlStack(levels);\n      let canonicalUrl;\n      if (levels[levels.length - 1].canonicalUrl) {\n        canonicalUrl = levels[levels.length - 1].canonicalUrl;\n      }\n\n      return {\n        referer: stackInfo.detectedRefererUrl,\n        reachedTop,\n        numIframes,\n        stack: stackInfo.stack,\n        canonicalUrl\n      };\n    } catch (e) {\n      // Ignore error\n    }\n  }\n\n  return refererInfo;\n}\n\nexport const getRefererInfo = detectReferer(window);\n\n\n\n// WEBPACK FOOTER //\n// ./lib/refererDetection.js","/*\n * Class containing the status of the API for a partner\n */\nimport CONSTANTS from './constants.json';\n\nimport * as utils from './utils';\n\n/* eslint-disable no-unused-vars */\nimport Config from './config';\nimport ClientStore from './clientStore.js';\nimport ConsentManagement from './consentManagement.js';\n/* eslint-enable no-unused-vars */\n\nexport default class Id5Status {\n  /** timerId of the onAvailable watchdog */\n  _availableCallbackTimerId;\n  /** @type {boolean} */\n  _availableCallbackFired = false;\n  /** @type {function} */\n  _availableCallback;\n  /** @type {function} */\n  _updateCallback;\n  /** timerId of the onRefresh watchdog */\n  _refreshCallbackTimerId;\n  /** @type {boolean} */\n  _refreshCallbackFired = false;\n  /** @type {function} */\n  _refreshCallback;\n  /** @type {boolean} */\n  _isExposed;\n  /** @type {boolean} */\n  _fromCache;\n  /** @type {boolean} */\n  _isRefreshing = false;\n  /** @type {boolean} */\n  _isRefreshingWithFetch = false;\n  /** @type {string} */\n  _userId;\n  /** @type {number} */\n  _linkType;\n  /** @type {Config} */\n  config;\n  /** @type {ClientStore} */\n  clientStore;\n  /** @type {ConsentManagement} */\n  consentManagement;\n\n  /**\n   * @param {Config} config\n   * @param {ClientStore} clientStore\n   * @param {ConsentManagement} consentManagement\n   */\n  constructor(config, clientStore, consentManagement) {\n    this.config = config;\n    this.clientStore = clientStore;\n    this.consentManagement = consentManagement;\n  }\n\n  /** @returns {Id5Options} options - Current options for this partner */\n  getOptions() {\n    return this.config.getOptions();\n  }\n\n  /** @param {Id5Options} options */\n  updateOptions(options) {\n    return this.config.updOptions(options);\n  }\n\n  /**\n   * Notify status that a refresh is in progress\n   * @param {boolean} forceFetch – server response required\n   */\n  startRefresh(forceFetch) {\n    this._isRefreshing = true;\n    this._isRefreshingWithFetch = forceFetch;\n  }\n\n  /**\n   * Set the user Id for this Id5Status\n   * @param {Object} response\n\n   * @param {boolean} fromCache\n   */\n  setUserId(response, fromCache) {\n    const userId = response.universal_uid;\n    const linkType = response.link_type || 0;\n\n    this._isExposed = true;\n    if (utils.isPlainObject(response.ab_testing)) {\n      switch (response.ab_testing.result) {\n        case 'normal':\n          // nothing to do\n          break;\n        default: // falls through\n        case 'error':\n          utils.logError('There was an error with A/B Testing. Make sure controlGroupRatio is a number >= 0 and <= 1');\n          break;\n        case 'control':\n          this._isExposed = false;\n          break;\n      }\n    }\n\n    if (userId) {\n      const hasChanged = this._userId !== userId || this._linkType !== linkType;\n      this._userId = userId;\n      this._linkType = linkType;\n      this._fromCache = fromCache;\n      utils.logInfo(`Id5Status.setUserId: user id updated, hasChanged: ${hasChanged}`);\n\n      // Fire callback if not in control group\n      if (this._isExposed) {\n        const currentThis = this; // Preserve this within callback\n\n        // Fire onAvailable if not yet fired\n        if (utils.isFn(this._availableCallback) && this._availableCallbackFired === false) {\n          // Cancel pending watchdog\n          if (this._availableCallbackTimerId) {\n            utils.logInfo(`Cancelling pending onAvailableCallback watchdog`);\n            clearTimeout(this._availableCallbackTimerId);\n            this._availableCallbackTimerId = undefined;\n          }\n          this._availableCallbackTimerId = setTimeout(() => Id5Status.doFireOnAvailableCallBack(currentThis), 0);\n        }\n\n        // Fire onRefresh if not yet fired and not from cache\n        if (this._isRefreshing && utils.isFn(this._refreshCallback) && this._refreshCallbackFired === false) {\n          if (fromCache === false || this._isRefreshingWithFetch === false) {\n            // Cancel pending watchdog\n            if (this._refreshCallbackTimerId) {\n              utils.logInfo(`Cancelling pending onRefreshCallback watchdog`);\n              clearTimeout(this._refreshCallbackTimerId);\n              this._refreshCallbackTimerId = undefined;\n            }\n            this._refreshCallbackTimerId = setTimeout(() => Id5Status.doFireOnRefreshCallBack(currentThis), 0);\n          }\n        }\n\n        // Always fire onUpdate if any change\n        if (hasChanged && utils.isFn(this._updateCallback)) {\n          setTimeout(() => Id5Status.doFireOnUpdateCallBack(currentThis), 0);\n        }\n      }\n    } else {\n      this._userId = undefined;\n      this._linkType = undefined;\n      this._fromCache = undefined;\n      this._isExposed = undefined;\n    }\n  }\n\n  /**\n   * Return the current userId if available and not in control group\n   * @return {string} userId\n   */\n  getUserId() {\n    return this._isExposed === false ? '0' : this._userId;\n  }\n\n  /**\n   * Return the current linkType if available and not in control group\n   * @return {number} linkType\n   */\n  getLinkType() {\n    return this._isExposed === false ? 0 : this._linkType;\n  }\n\n  /**\n   * Return true if the userId provided is from cache\n   * @return {boolean}\n   */\n  isFromCache() {\n    return this._fromCache;\n  }\n\n  /**\n   * Return true if we should expose this user Id within AB Test\n   * @return {boolean}\n   */\n  exposeUserId() {\n    return this._isExposed;\n  }\n\n  /**\n   * Return the current userId in an object that can be added to the\n   * eids array of an OpenRTB bid request\n   * @return {object}\n   */\n  getUserIdAsEid() {\n    return {\n      source: CONSTANTS.ID5_EIDS_SOURCE,\n      uids: [{\n        id: this.getUserId(),\n        ext: {\n          linkType: this.getLinkType(),\n          abTestingControlGroup: !this.exposeUserId()\n        }\n      }]\n    };\n  }\n\n  /**\n   * Fire the provided callback when (and exactly once) a user id is available\n   * if a timeout is provided, fire the callback at timeout even if user id is not yet available\n   * @param {function(Id5Status)} fn - callback function, receiving the current Id5Status as first param\n   * @param {number} [timeout] - watchdog timeout in ms\n   * @return {Id5Status} the current Id5Status for chaining\n   */\n  onAvailable(fn, timeout) {\n    if (!utils.isFn(fn)) {\n      throw new Error('onAvailable expect a function');\n    }\n    if (utils.isFn(this._availableCallback)) {\n      utils.logInfo('onAvailable was already called, ignoring');\n    } else {\n      this._availableCallback = fn;\n      const currentThis = this; // Preserve this within callback\n\n      if (this.getUserId()) {\n        utils.logInfo('Id5Status.onAvailable: User id already available firing callback immediately');\n        this._availableCallbackTimerId = setTimeout(() => Id5Status.doFireOnAvailableCallBack(currentThis), 0);\n      } else if (timeout > 0) {\n        this._availableCallbackTimerId = setTimeout(() => Id5Status.doFireOnAvailableCallBack(currentThis), timeout);\n      }\n    }\n    return this;\n  }\n\n  /**\n   * Fire the provided callback each time a user id is available or updated. Will be fired after onAvailable or onRefresh if both are provided\n   * @param {function(Id5Status)} fn - callback function, receiving the current Id5Status as first param\n   * @return {Id5Status} the current Id5Status for chaining\n   */\n  onUpdate(fn) {\n    if (!utils.isFn(fn)) {\n      throw new Error('onUpdate expect a function');\n    }\n    this._updateCallback = fn;\n    const currentThis = this; // Preserve this within callback\n    if (this.getUserId()) {\n      setTimeout(() => Id5Status.doFireOnUpdateCallBack(currentThis), 0);\n    }\n    return this;\n  }\n\n  /**\n   * Fire the provided callback when (and exactly once) a user id is returned by refreshId()\n   * if a timeout is provided, fire the callback at timeout even refersh is not done\n   * @param {function(Id5Status)} fn - callback function, receiving the current Id5Status as first param\n   * @param {number} [timeout] - watchdog timeout in ms\n   * @return {Id5Status} the current Id5Status for chaining\n   */\n  onRefresh(fn, timeout) {\n    if (!utils.isFn(fn)) {\n      throw new Error('onRefresh expect a function');\n    }\n    // We have a pending onRefresh, cancel it.\n    if (this._refreshCallbackTimerId) {\n      clearTimeout(this._refreshCallbackTimerId);\n      this._refreshCallbackTimerId = undefined;\n    }\n    this._refreshCallback = fn;\n    const currentThis = this; // Preserve this within callback\n    // If we are already after a non-forced refreshId and we already have a user id, then callback immediately\n    if (this._isRefreshing === true && this._isRefreshingWithFetch === false && this.getUserId()) {\n      this._refreshCallbackTimerId = setTimeout(() => Id5Status.doFireOnRefreshCallBack(currentThis), 0);\n    } else if (timeout > 0) {\n      this._refreshCallbackTimerId = setTimeout(() => Id5Status.doFireOnRefreshCallBack(currentThis), timeout);\n    }\n    return this;\n  }\n\n  /**\n   * @return {boolean|undefined} see {ClientStore.isLocalStorageAllowed}\n   */\n  localStorageAllowed() {\n    return this.clientStore.localStorageAllowed();\n  }\n\n  /**\n   * This function fire the onAvailable callback of the passed Id5Status\n   * @param {Id5Status} currentId5Status\n   */\n  static doFireOnAvailableCallBack(currentId5Status) {\n    utils.logInfo(`Id5Status.doFireOnAvailableCallBack`);\n    currentId5Status._availableCallbackFired = true;\n    currentId5Status._availableCallbackTimerId = undefined;\n    currentId5Status._availableCallback(currentId5Status);\n  }\n\n  /**\n   * This function fire the onUpdate callback of the passed Id5Status\n   * @param {Id5Status} currentId5Status\n   */\n  static doFireOnUpdateCallBack(currentId5Status) {\n    utils.logInfo(`Id5Status.doFireOnUpdateCallBack`);\n    currentId5Status._updateCallback(currentId5Status);\n  }\n\n  /**\n   * This function fire the onRefresh callback of the passed Id5Status\n   * @param {Id5Status} currentId5Status\n   */\n  static doFireOnRefreshCallBack(currentId5Status) {\n    utils.logInfo(`Id5Status.doFireOnRefreshCallBack`);\n    currentId5Status._refreshCallbackFired = true;\n    currentId5Status._refreshCallbackTimerId = undefined;\n    currentId5Status._isRefreshing = false;\n    currentId5Status._isRefreshingWithFetch = false;\n    currentId5Status._refreshCallback(currentId5Status);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/id5Status.js","// generated by genversion\nexport const version = '1.0.6'\n\n\n\n// WEBPACK FOOTER //\n// ./generated/version.js","/**\n * This class deals with the mechanics of accessing the local storage\n * on a certain window object\n */\n\nconst EXP_SUFFIX = '_exp';\nexport default class LocalStorage {\n  /** @type {boolean} */\n  available = false;\n  /** @type {Object} */\n  win;\n  /** @type {boolean} */\n  writingEnabled;\n\n  /**\n   * Builds a new abstraction of the localStorage associated with\n   * the passed window object\n   * @param {Object} win the window object to use\n   */\n  constructor(win, writingEnabled = true) {\n    this.win = win;\n    this.writingEnabled = writingEnabled;\n\n    // Test for availability\n    const test = '__id5test';\n    try {\n      if (this.writingEnabled) {\n        this.win.localStorage.setItem(test, test);\n      }\n      this.win.localStorage.removeItem(test);\n      this.available = true;\n    } catch (e) {\n      // do nothing\n    }\n  }\n\n  /**\n   * @returns {boolean} true if the localStorage is available\n   */\n  isAvailable() {\n    return this.available;\n  }\n\n  /**\n   * Gets a stored string from local storage\n   *\n   * @param {string} key\n   * @returns {string|null|undefined} the stored value, null if no value or expired were stored, undefined if no localStorage\n   */\n  getItem(key) {\n    if (this.available) {\n      return this.win.localStorage.getItem(key);\n    }\n  }\n\n  /**\n   * Puts a string in local storage\n   *\n   * @param {string} key the key of the item\n   * @param {string} value the vaule to store\n   * @returns {undefined}\n   */\n  setItem(key, value) {\n    if (this.available && this.writingEnabled) {\n      this.win.localStorage.setItem(key, value);\n    }\n  }\n\n  /**\n   * Removes a string from local storage\n   * @param {string} key the key of the item\n   */\n  removeItem(key) {\n    if (this.available) {\n      this.win.localStorage.removeItem(key);\n    }\n  }\n\n  /**\n   * Gets a stored item from local storage dealing with expiration policy.\n   * @param {Object} config The item configuration\n   * @param {string} config.name The item name\n   * @returns {string|null} the stored value, null if no value, expired or no localStorage\n   */\n  getItemWithExpiration({ name }) {\n    const storedValueExp = this.getItem(name + EXP_SUFFIX);\n    if (storedValueExp && !isExpired(storedValueExp)) {\n      return this.getItem(name);\n    } else {\n      this.removeItemWithExpiration({ name });\n      return null;\n    }\n  }\n\n  /**\n   * Stores an item in local storage dealing with expiration policy.\n   * @param {Object} config The item configuration\n   * @param {string} config.name The item name\n   * @param {number} config.expiresDays The expiration in days\n   * @returns {undefined}\n   */\n  setItemWithExpiration({name, expiresDays}, value) {\n    const expirationInMs = Date.now() + (expiresDays * (60 * 60 * 24 * 1000));\n    const expiresStr = (new Date(expirationInMs)).toUTCString();\n    this.setItem(name + EXP_SUFFIX, expiresStr);\n    this.setItem(name, value);\n  }\n\n  /**\n   * Removes an item from local storage dealing with expiration policy.\n   */\n  removeItemWithExpiration({ name }) {\n    this.removeItem(name);\n    this.removeItem(name + EXP_SUFFIX);\n  }\n}\n\n/**\n * Tells whether a stored expiration date has passed\n * @param {string} dateValue the .toUTCString() representation of the expiration date\n */\nfunction isExpired(dateValue) {\n  return (new Date(dateValue)).getTime() - Date.now() <= 0;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/localStorage.js"],"sourceRoot":""}