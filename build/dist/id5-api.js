/**
 * @id5io/id5-api.js
 * @version v1.0.5
 * @link https://id5.io/
 * @license Apache-2.0
 */
!function(n){var a={};function o(e){if(a[e])return a[e].exports;var t=a[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,o),t.l=!0,t.exports}o.m=n,o.c=a,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=2)}([function(e,t,n){"use strict";function c(){return(c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,a=arguments[t];for(n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}t.m=function(){k()&&v&&console.info.apply(console,C(arguments,"INFO:"))},t.n=function(){k()&&b&&console.warn.apply(console,C(arguments,"WARNING:"))},t.l=y,t.p=function(e){m=!!e},t.h=k,t.e=I,t.g=O,t.k=S,t.i=function(e){return I(e,i)},t.j=function(e){return I(e,s)},t.f=function(e){return I(e,d)},t.d=function(e){e=window.document.cookie.match("(^|;)\\s*"+e+"\\s*=\\s*([^;]*)\\s*(;|$)");return e?decodeURIComponent(e[2]):null},t.o=function(e,t,n){document.cookie="".concat(e,"=").concat(encodeURIComponent(t)).concat(""!==n?"; expires=".concat(n):"","; path=/")},t.a=function(e,t,n){var a,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};try{var r=o.method||(n?"POST":"GET");document.createElement("a").href=e;var i,s="object"===l(t)&&null!==t?t:{success:function(){!function(){k()&&f&&console.log.apply(console,C(arguments,"MESSAGE:"))}("xhr success")},error:function(e){y("xhr error",null,e)}};"function"==typeof t&&(s.success=t),(a=new window.XMLHttpRequest).onreadystatechange=function(){var e;a.readyState===_&&(200<=(e=a.status)&&e<300||304===e?s.success(a.responseText,a):s.error(a.statusText,a))},a.ontimeout=function(){y("  xhr timeout after ",a.timeout,"ms")},"GET"===r&&n&&(c((i=function(e,t){var n=document.createElement("a");t&&"noDecodeWholeURL"in t&&t.noDecodeWholeURL?n.href=e:n.href=decodeURIComponent(e);t=t&&"decodeSearchAsString"in t&&t.decodeSearchAsString;return{href:n.href,protocol:(n.protocol||"").replace(/:$/,""),hostname:n.hostname,port:+n.port,pathname:n.pathname.replace(/^(?!\/)/,"/"),search:t?n.search:function(e){return e?e.replace(/^\?/,"").split("&").reduce(function(e,t){var n=t.split("="),n=(t=2,function(e){if(Array.isArray(e))return e}(n=n)||function(e,t){var n=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null!=n){var a,o,r=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(a=n.next()).done)&&(r.push(a.value),!t||r.length!==t);i=!0);}catch(e){s=!0,o=e}finally{try{i||null==n.return||n.return()}finally{if(s)throw o}}return r}}(n,t)||function(e,t){if(e){if("string"==typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(n="Object"===n&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(e,t):void 0}}(n,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),t=n[0],n=n[1];return/\[\]$/.test(t)?(e[t=t.replace("[]","")]=e[t]||[],e[t].push(n)):e[t]=n||"",e},{}):{}}(n.search||""),hash:(n.hash||"").replace(/^#/,""),host:n.host||window.location.host}}(e,o)).search,n),e=function(e){return(e.protocol||"http")+"://"+(e.host||e.hostname+(e.port?":".concat(e.port):""))+(e.pathname||"")+(e.search?"?".concat(function(e){return Object.keys(e).map(function(t){return Array.isArray(e[t])?e[t].map(function(e){return"".concat(t,"[]=").concat(e)}).join("&"):"".concat(t,"=").concat(e[t])}).join("&")}(e.search||"")):"")+(e.hash?"#".concat(e.hash):"")}(i)),a.open(r,e,!0),o.withCredentials&&(a.withCredentials=!0),w(o.customHeaders,function(e,t){a.setRequestHeader(t,e)}),o.preflight&&a.setRequestHeader("X-Requested-With","XMLHttpRequest"),a.setRequestHeader("Content-Type",o.contentType||"text/plain"),"POST"===r&&n?a.send(n):a.send()}catch(e){y("xhr construction",e)}},t.c=function(e,t,n){"loading"!==document.readyState?A(e,t,n):document.addEventListener("DOMContentLoaded",function(){A(e,t,n)})},t.b=function(e){for(var t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,a=function(e,t){if(O(Math.imul))return Math.imul(e,t);var n=(4194303&e)*(t|=0);return 4290772992&e&&(n+=(4290772992&e)*t|0),0|n},o=3735928559^n,r=1103547991^n,i=0;i<e.length;i++)t=e.charCodeAt(i),o=a(o^t,2654435761),r=a(r^t,1597334677);return o=a(o^o>>>16,2246822507)^a(r^r>>>13,3266489909),(4294967296*(2097151&(r=a(r^r>>>16,2246822507)^a(o^o>>>13,3266489909)))+(o>>>0)).toString()};var a="Array",o="String",r="Function",i="Number",s="Object",d="Boolean",h=Object.prototype.toString,p="TRUE"===function(e){e=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(window.location.search);return null!==e?decodeURIComponent(e[1].replace(/\+/g," ")):""}("id5_debug").toUpperCase(),t=Boolean(window.console),f=Boolean(t&&window.console.log),v=Boolean(t&&window.console.info),b=Boolean(t&&window.console.warn),g=Boolean(t&&window.console.error),m=!1;function y(){k()&&g&&console.error.apply(console,C(arguments,"ERROR:"))}function C(e,t){return e=[].slice.call(e),t&&e.unshift(t),e.unshift("display: inline-block; color: #fff; background: #1c307e; padding: 1px 4px; border-radius: 3px;"),e.unshift("%cID5"),e}function k(){return p||m}function I(e,t){return h.call(e)==="[object "+t+"]"}function O(e){return I(e,r)}function S(e){return I(e,o)}function D(e){if(!e)return 1;if(I(e,a)||S(e))return!(0<e.length);for(var t in e)if(hasOwnProperty.call(e,t))return;return 1}function w(e,t){if(!D(e)){if(O(e.forEach))return e.forEach(t,this);var n=0,a=e.length;if(0<a)for(;n<a;n++)t(e[n],n,e);else for(n in e)hasOwnProperty.call(e,n)&&t.call(this,e[n],n)}}var _=4;function A(e,t,n){var a=new Image;a.src=e,O(t)&&t(),O(n)&&(a.complete?n():a.addEventListener("load",n))}},function(e,t){e.exports={STORAGE_CONFIG:{ID5:{name:"id5id",expiresDays:90},LAST:{name:"id5id_last",expiresDays:90},CONSENT_DATA:{name:"id5id_cached_consent_data",expiresDays:30},PD:{name:"id5id_cached_pd",expiresDays:30},PRIVACY:{name:"id5id_privacy",expiresDays:30}},LEGACY_COOKIE_NAMES:["id5.1st","id5id.1st"],PRIVACY:{JURISDICTIONS:{gdpr:!0,ccpa:!1,lgpd:!0,other:!1}},ID5_EIDS_SOURCE:"id5-sync.com"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});n=n(3);window.ID5||(window.ID5=n.a)},function(e,t,n){"use strict";var v=n(0),o=n(4),r=n(5),i=n(6),s=n(7),c=n(10),l=n(11);function u(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n=new(function(){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),d(this,"loaded",!1),d(this,"debugBypassConsent",!1),d(this,"allowLocalStorageWithoutConsentApi",!1),d(this,"localStorageAllowed",!1),d(this,"isUsingCdn",!1),d(this,"referer",!1),d(this,"version",c.a),d(this,"versions",{}),d(this,"localStorage",void 0),this.loaded=!0,this.isUsingCdn=!!(document&&document.currentScript&&document.currentScript.src&&0===document.currentScript.src.indexOf("https://cdn.id5-sync.com")),this.referer=Object(o.a)();var e=this;this.versions[c.a]=!0,this.localStorage=new l.a(window.top),this.clientStore=new r.a(function(){return e.localStorageAllowed},this.localStorage)}var e,n,a;return e=t,(n=[{key:"debug",get:function(){return Object(v.h)()},set:function(e){Object(v.p)(e)}},{key:"init",value:function(e){if(void 0===this.version)throw new Error('ID5.version variable is missing! Make sure you build from source with "gulp build" from this project. Contact support@id5.io for help.');try{Object(v.m)("Invoking Id5Api.init",arguments);var t=new s.a(e);return t.getOptions().applyCreativeRestrictions&&this.localStorage.disableWriting(),this.debugBypassConsent=this.debugBypassConsent||t.getOptions().debugBypassConsent,this.allowLocalStorageWithoutConsentApi=this.allowLocalStorageWithoutConsentApi||t.getOptions().allowLocalStorageWithoutConsentApi,this.consent=new i.a(this.localStorage),this.getId(t,!1),Object(v.m)("ID5 initialized for partner ".concat(t.getOptions().partnerId," with referer ").concat(this.referer.referer," and options"),e),t}catch(e){Object(v.l)("Exception caught from Id5Api.init",e)}}},{key:"refreshId",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(void 0===this.version)throw new Error('ID5.version variable is missing! Make sure you build from source with "gulp build" from this project. Contact support@id5.io for help.');if(!Object(v.f)(t))throw new Error("Invalid signature for Id5Api.refreshId: second parameter must be a boolean");try{Object(v.m)("Invoking Id5Api.refreshId",arguments),e.startRefresh(t),e.updateOptions(n),this.consent.resetConsentData(),this.getId(e,t)}catch(e){Object(v.l)("Exception caught from Id5Api.refreshId",e)}return e}},{key:"updateLocalStorageAllowed",value:function(){this.localStorageAllowed=this.consent.isLocalStorageAllowed(this.allowLocalStorageWithoutConsentApi,this.debugBypassConsent)}},{key:"getId",value:function(i){var s,e,c=this,l=1<arguments.length&&void 0!==arguments[1]&&arguments[1],u=i.getOptions(),d=0,h=!1,p=!1,f=!1;this.updateLocalStorageAllowed(),this.localStorageAllowed&&(s=this.clientStore.getResponse(),e=this.clientStore.getDateTime(),h=e<=0||Date.now()-e>1e3*u.refreshInSeconds,d=this.clientStore.getNb(u.partnerId),p=!this.clientStore.storedPdMatchesPd(u.partnerId,u.pd)),s||(s=this.clientStore.getResponseFromLegacyCookie(),h=!0),s&&s.universal_uid&&!p?(i.setUserId(s.universal_uid,s.link_type||0,!0),d=this.clientStore.incNb(u.partnerId,d),f=!0,Object(v.m)("ID5 User ID available from cache:",{storedResponse:s,storedDateTime:e,refreshNeeded:h})):s&&s.universal_uid&&p?Object(v.m)("PD value has changed, so ignoring User ID from cache"):s&&!s.universal_uid?Object(v.l)("Invalid stored response: ",s):Object(v.m)("No ID5 User ID available from cache"),this.consent.requestConsent(this.debugBypassConsent,u.cmpApi,u.consentData,function(e){var t,o,r,n,a;c.updateLocalStorageAllowed(),!1!==c.localStorageAllowed?(Object(v.m)("Consent to access local storage is given: ",c.localStorageAllowed),s=c.clientStore.getResponse()||c.clientStore.getResponseFromLegacyCookie(),a=!c.clientStore.storedConsentDataMatchesConsentData(e),c.clientStore.putHashedConsentData(e),c.clientStore.putHashedPd(u.partnerId,u.pd),s&&s.universal_uid&&s.signature&&!h&&!a&&!p&&!l||(t="https://id5-sync.com/g/v2/".concat(u.partnerId,".json"),o=e&&e.gdprApplies?1:0,r=e&&e.gdprApplies?e.consentString:void 0,n=s&&s.signature?s.signature:void 0,a={partner:u.partnerId,v:c.version,o:"api",gdpr:o,rf:c.referer.referer,u:c.referer.stack[0]||window.location.href,top:c.referer.reachedTop?1:0,localStorage:c.localStorage.isAvailable()?1:0,nbPage:d,id5cdn:c.isUsingCdn},void 0!==r&&(a.gdpr_consent=r),void 0!==n&&(a.s=n),void 0!==u.pd&&(a.pd=u.pd),void 0!==u.partnerUserId&&(a.puid=u.partnerUserId),void 0!==u.provider&&(a.provider=u.provider),!0===i.getOptions().abTesting.enabled&&(a.features=a.features||{},a.features.ab=1),Object(v.m)("Fetching ID5 user ID from:",t,a),l&&Object(v.m)("...with Force Fetch"),Object(v.a)(t,{success:function(e){if(Object(v.m)("Response from ID5 received:",e),e)try{var t,n,a=JSON.parse(e);Object(v.m)("Valid json response from ID5 received:",a),Object(v.k)(a.universal_uid)?(i.setUserId(a.universal_uid,a.link_type||0,!1),c.consent.setStoredPrivacy(a.privacy),c.updateLocalStorageAllowed(),!0===c.localStorageAllowed||void 0===a.privacy?(c.clientStore.putResponse(e),c.clientStore.setDateTime((new Date).toUTCString()),c.clientStore.setNb(u.partnerId,f?0:1)):c.clientStore.clearAll(u.partnerId),c.clientStore.removeLegacyCookies(u.partnerId),!0===a.cascade_needed&&!0===c.localStorageAllowed&&0<=u.maxCascades&&!u.applyCreativeRestrictions&&(t=u.partnerUserId&&0<u.partnerUserId.length,n="https://id5-sync.com/".concat(t?"s":"i","/").concat(u.partnerId,"/").concat(u.maxCascades,".gif?id5id=").concat(i._userId,"&o=api&").concat(t?"puid="+u.partnerUserId+"&":"","gdpr_consent=").concat(r,"&gdpr=").concat(o),Object(v.m)("Opportunities to cascade available:",n),Object(v.c)(n))):Object(v.l)("Invalid response from ID5 servers:",e)}catch(e){Object(v.l)(e)}else Object(v.l)("Empty response from ID5 servers:",e)},error:function(e){Object(v.l)(e)}},JSON.stringify(a),{method:"POST",withCredentials:!0}))):Object(v.m)("No legal basis to use ID5",e)})}}])&&u(e.prototype,n),a&&u(e,a),t}());t.a=n},function(e,t,n){"use strict";function o(){return(o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,a=arguments[t];for(n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}n.d(t,"a",function(){return a});var r,a=(r=window,function(){try{var e,t=i(),n=t.length-1,a=null!==t[n].location||0<n&&null!==t[n-1].referrer,o=function(e){for(var t,n=[],a=null,o=null,r=null,i=null,s=null,c=e.length-1;0<=c;c--){try{o=e[c].location}catch(e){}if(o)n.push(o),s=s||o;else if(0!==c){t=e[c-1];try{r=t.referrer,i=t.ancestor}catch(e){}r?(n.push(r),s=s||r):i?(n.push(i),s=s||i):n.push(a)}else n.push(a)}return{stack:n,detectedRefererUrl:s}}(t);return t[t.length-1].canonicalUrl&&(e=t[t.length-1].canonicalUrl),{referer:o.detectedRefererUrl,reachedTop:a,numIframes:n,stack:o.stack,canonicalUrl:e}}catch(e){}});function i(){var e=function(){var t,n=[];do{try{t=t?t.parent:r;try{var e=t===r.top,a={referrer:t.document.referrer||null,location:t.location.href||null,isTop:e};e&&(a=o(a,{canonicalUrl:function(e){try{var t=e.querySelector("link[rel='canonical']");if(null!==t)return t.href}catch(e){}return null}(t.document)})),n.push(a)}catch(e){n.push({referrer:null,location:null,isTop:t===r.top})}}catch(e){return n.push({referrer:null,location:null,isTop:!1}),n}}while(t!==r.top);return n}(),t=function(){try{return r.location.ancestorOrigins?r.location.ancestorOrigins:void 0}catch(e){}}();if(t)for(var n=0,a=t.length;n<a;n++)e[n].ancestor=t[n];return e}},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),t=n(1),r=n.n(t);function i(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var a=function(){function n(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),s(this,"localStorageAllowedCallback",void 0),s(this,"driver",void 0),this.localStorageAllowedCallback=e,this.driver=t}var e,t,a;return e=n,a=[{key:"pdCacheConfig",value:function(e){return{name:"".concat(r.a.STORAGE_CONFIG.PD.name,"_").concat(e),expiresDays:r.a.STORAGE_CONFIG.PD.expiresDays}}},{key:"makeStoredHash",value:function(e){return Object(o.b)("string"==typeof e?e:"")}},{key:"nbCacheConfig",value:function(e){return{name:"".concat(r.a.STORAGE_CONFIG.ID5.name,"_").concat(e,"_nb"),expiresDays:r.a.STORAGE_CONFIG.ID5.expiresDays}}},{key:"storedDataMatchesCurrentData",value:function(e,t){return null==e||e===t}},{key:"makeStoredConsentDataHash",value:function(e){var t={consentString:"",gdprApplies:!1,apiVersion:0};return e&&(t.consentString=e.consentString,t.gdprApplies=e.gdprApplies,t.apiVersion=e.apiVersion),Object(o.b)(JSON.stringify(t))}}],(t=[{key:"get",value:function(e){try{if(!0===this.localStorageAllowedCallback())return this.driver.getItemWithExpiration(e);Object(o.l)("clientStore.get() has been called without localStorageAllowed")}catch(e){Object(o.l)(e)}}},{key:"clear",value:function(e){try{this.driver.removeItemWithExpiration(e)}catch(e){Object(o.l)(e)}}},{key:"put",value:function(e,t){try{!0===this.localStorageAllowedCallback()?this.driver.setItemWithExpiration(e,t):Object(o.l)("clientStore.put() has been called without localStorageAllowed")}catch(e){Object(o.l)(e)}}},{key:"getResponseFromLegacyCookie",value:function(){var t;return r.a.LEGACY_COOKIE_NAMES.forEach(function(e){Object(o.d)(e)&&(t=Object(o.d)(e))}),t?JSON.parse(t):null}},{key:"getResponse",value:function(){var e=this.get(r.a.STORAGE_CONFIG.ID5);return e&&JSON.parse(decodeURIComponent(e))}},{key:"clearResponse",value:function(){this.clear(r.a.STORAGE_CONFIG.ID5)}},{key:"putResponse",value:function(e){this.put(r.a.STORAGE_CONFIG.ID5,encodeURIComponent(e))}},{key:"getHashedConsentData",value:function(){return this.get(r.a.STORAGE_CONFIG.CONSENT_DATA)}},{key:"clearHashedConsentData",value:function(){this.clear(r.a.STORAGE_CONFIG.CONSENT_DATA)}},{key:"putHashedConsentData",value:function(e){this.put(r.a.STORAGE_CONFIG.CONSENT_DATA,n.makeStoredConsentDataHash(e))}},{key:"getHashedPd",value:function(e){return this.get(n.pdCacheConfig(e))}},{key:"storedPdMatchesPd",value:function(e,t){return n.storedDataMatchesCurrentData(this.getHashedPd(e),n.makeStoredHash(t))}},{key:"clearHashedPd",value:function(e){this.clear(n.pdCacheConfig(e))}},{key:"putHashedPd",value:function(e,t){this.put(n.pdCacheConfig(e),n.makeStoredHash(t))}},{key:"getDateTime",value:function(){return new Date(this.get(r.a.STORAGE_CONFIG.LAST)).getTime()}},{key:"clearDateTime",value:function(){this.clear(r.a.STORAGE_CONFIG.LAST)}},{key:"setDateTime",value:function(e){this.put(r.a.STORAGE_CONFIG.LAST,e)}},{key:"getNb",value:function(e){e=this.get(n.nbCacheConfig(e));return e?parseInt(e):0}},{key:"clearNb",value:function(e){this.clear(n.nbCacheConfig(e))}},{key:"setNb",value:function(e,t){this.put(n.nbCacheConfig(e),t)}},{key:"incNb",value:function(e,t){return this.setNb(e,++t),t}},{key:"clearAll",value:function(e){this.clearResponse(),this.clearDateTime(),this.clearNb(e),this.clearHashedPd(e),this.clearHashedConsentData()}},{key:"removeLegacyCookies",value:function(t){var n=new Date(Date.now()-1e3).toUTCString();r.a.LEGACY_COOKIE_NAMES.forEach(function(e){Object(o.o)("".concat(e),"",n),Object(o.o)("".concat(e,"_nb"),"",n),Object(o.o)("".concat(e,"_").concat(t,"_nb"),"",n),Object(o.o)("".concat(e,"_last"),"",n),Object(o.o)("".concat(e,".cached_pd"),"",n),Object(o.o)("".concat(e,".cached_consent_data"),"",n)})}},{key:"storedConsentDataMatchesConsentData",value:function(e){return n.storedDataMatchesCurrentData(this.getHashedConsentData(),n.makeStoredConsentDataHash(e))}}])&&i(e.prototype,t),a&&i(e,a),n}()},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var u=n(0),t=n(1),a=n.n(t);function o(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var i=function(){function l(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),r(this,"consentData",void 0),r(this,"staticConsentData",void 0),r(this,"storedPrivacyData",void 0),r(this,"cmpVersion",0),r(this,"localStorage",void 0),r(this,"cmpCallMap",{iab:this.lookupIabConsent,static:this.lookupStaticConsentData}),this.localStorage=e}var e,t,n;return e=l,n=[{key:"findCMP",value:function(){for(var e,t,n=0,a=window;!e;){try{if("function"==typeof a.__tcfapi||"function"==typeof a.__cmp){t="function"==typeof a.__tcfapi?(n=2,a.__tcfapi):(n=1,a.__cmp),e=a;break}}catch(e){}try{if(a.frames.__tcfapiLocator){n=2,e=a;break}}catch(e){}try{if(a.frames.__cmpLocator){n=1,e=a;break}}catch(e){}if(a===window.top)break;a=a.parent}return{cmpVersion:n,cmpFrame:e,cmpFunction:t}}},{key:"cmpSuccess",value:function(e,n,t){var a=1===e.cmpVersion?function(e){var t=e&&e.getConsentData&&e.getConsentData.gdprApplies;return!("boolean"==typeof t&&(!0!==t||u.k(e.getConsentData.consentData)&&u.j(e.getVendorConsents)&&1<Object.keys(e.getVendorConsents).length))}:2===e.cmpVersion?function(){var e=n&&"boolean"==typeof n.gdprApplies?n.gdprApplies:void 0,t=n&&n.tcString;return!("boolean"==typeof e&&(!0!==e||u.k(t)))}:null;u.m("CMP Success callback for version",e.cmpVersion,a),u.g(a)&&(a(n)?(e.resetConsentData(),u.l("CMP returned unexpected value during lookup process.",n)):e.storeConsentData(n)),t(e.consentData)}}],(t=[{key:"lookupStaticConsentData",value:function(e,t){this.cmpVersion=this.staticConsentData.getConsentData?1:this.staticConsentData.getTCData?2:0,u.m("Using static consent data from config for TCF v".concat(this.cmpVersion),this.staticConsentData),2===this.cmpVersion?e(this,this.staticConsentData.getTCData,t):e(this,this.staticConsentData,t)}},{key:"lookupIabConsent",value:function(n,a){var o=this;var t,e=(t={},{consentDataCallback:function(e){u.m("cmpApi: consentDataCallback"),t.getConsentData=e,r()},vendorConsentsCallback:function(e){u.m("cmpApi: vendorConsentsCallback"),t.getVendorConsents=e,r()}});function r(){t.getConsentData&&t.getVendorConsents&&n(o,t,a)}var i=l.findCMP(),s=i.cmpVersion,c=i.cmpFrame,i=i.cmpFunction;if(this.cmpVersion=s,!c)return u.l("CMP not found"),void n(o,void 0,a);u.g(i)?(u.m("cmpApi: calling getConsentData & getVendorConsents"),1===s?(i("getConsentData",null,e.consentDataCallback),i("getVendorConsents",null,e.vendorConsentsCallback)):2===s&&i("addEventListener",s,function(e,t){u.m("Received a response from CMP",e),t?!1!==e.gdprApplies&&"tcloaded"!==e.eventStatus&&"useractioncomplete"!==e.eventStatus||n(o,e,a):(u.l("CMP unable to register callback function.  Please check CMP setup."),n(o,void 0,a))})):n(o,void 0,a)}},{key:"requestConsent",value:function(e,t,n,a){e?(u.n("ID5 is operating in forced consent mode and will not retrieve any consent signals from the CMP"),a(this.consentData)):this.cmpCallMap[t]?this.consentData?a(this.consentData):("static"===t&&(u.j(n)?this.staticConsentData=n:u.l("cmpApi: 'static' did not specify consent data.")),this.cmpCallMap[t].call(this,l.cmpSuccess,a)):(u.l("Unknown consent API: ".concat(t)),this.resetConsentData(),a(this.consentData))}},{key:"resetConsentData",value:function(){this.consentData=void 0,this.storedPrivacyData=void 0}},{key:"storeConsentData",value:function(e){1===this.cmpVersion?this.consentData={consentString:e?e.getConsentData.consentData:void 0,vendorData:e?e.getVendorConsents:void 0,gdprApplies:e?e.getConsentData.gdprApplies:void 0,apiVersion:1}:2===this.cmpVersion?this.consentData={consentString:e?e.tcString:void 0,vendorData:e||void 0,gdprApplies:e&&"boolean"==typeof e.gdprApplies?e.gdprApplies:void 0,apiVersion:2}:this.consentData={apiVersion:0}}},{key:"isLocalStorageAllowed",value:function(e,t){return!0===e||!0===t?(u.n("Local storage access granted by configuration override, consent will not be checked"),!0):this.consentData?"boolean"!=typeof this.consentData.gdprApplies||!this.consentData.gdprApplies||!(!this.consentData.consentString||0===this.consentData.apiVersion)&&((1!==this.consentData.apiVersion||!this.consentData.vendorData||!this.consentData.vendorData.purposeConsents||!1!==this.consentData.vendorData.purposeConsents[1])&&!(2===this.consentData.apiVersion&&this.consentData.vendorData&&this.consentData.vendorData.purpose&&this.consentData.vendorData.purpose.consents&&!1===this.consentData.vendorData.purpose.consents[1])):this.isProvisionalLocalStorageAllowed()}},{key:"isProvisionalLocalStorageAllowed",value:function(){var e;return u.j(this.storedPrivacyData)||(e=this.localStorage.getItemWithExpiration(a.a.STORAGE_CONFIG.PRIVACY),this.storedPrivacyData=e&&JSON.parse(e)),!(!this.storedPrivacyData||!0!==this.storedPrivacyData.id5_consent)||(this.storedPrivacyData&&void 0!==this.storedPrivacyData.jurisdiction?!1===(void 0!==a.a.PRIVACY.JURISDICTIONS[this.storedPrivacyData.jurisdiction]&&a.a.PRIVACY.JURISDICTIONS[this.storedPrivacyData.jurisdiction])||!0===this.storedPrivacyData.id5_consent:void 0)}},{key:"setStoredPrivacy",value:function(e){try{u.j(e)?(this.storedPrivacyData=e,this.localStorage.setItemWithExpiration(a.a.STORAGE_CONFIG.PRIVACY,JSON.stringify(e))):u.m("Cannot store privacy if it is not an object: ",e)}catch(e){u.l(e)}}}])&&o(e.prototype,t),n&&o(e,n),l}()},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var a=n(8),t=n(1),o=n.n(t),i=n(9),s=n(0);function c(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var r=function(){function r(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),l(this,"_availableCallbackTimerId",void 0),l(this,"_availableCallbackFired",!1),l(this,"_availableCallback",void 0),l(this,"_updateCallback",void 0),l(this,"_refreshCallbackTimerId",void 0),l(this,"_refreshCallbackFired",!1),l(this,"_refreshCallback",void 0),l(this,"_isExposed",void 0),l(this,"_fromCache",void 0),l(this,"_isRefreshing",!1),l(this,"_isRefreshingWithFetch",!1),l(this,"_userId",void 0),l(this,"_linkType",void 0),l(this,"config",void 0),this.config=new a.a(e)}var e,t,n;return e=r,n=[{key:"doFireOnAvailableCallBack",value:function(e){s.m("Id5Status.doFireOnAvailableCallBack"),e._availableCallbackFired=!0,e._availableCallbackTimerId=void 0,e._availableCallback(e)}},{key:"doFireOnUpdateCallBack",value:function(e){s.m("Id5Status.doFireOnUpdateCallBack"),e._updateCallback(e)}},{key:"doFireOnRefreshCallBack",value:function(e){s.m("Id5Status.doFireOnRefreshCallBack"),e._refreshCallbackFired=!0,e._refreshCallbackTimerId=void 0,e._isRefreshing=!1,e._isRefreshingWithFetch=!1,e._refreshCallback(e)}}],(t=[{key:"getOptions",value:function(){return this.config.getOptions()}},{key:"updateOptions",value:function(e){return this.config.updOptions(e)}},{key:"startRefresh",value:function(e){this._isRefreshing=!0,this._isRefreshingWithFetch=e}},{key:"setUserId",value:function(e,t,n){var a,o;e?(a=this._userId!==e||this._linkType!==t,this._userId=e,this._linkType=t,this._fromCache=n,s.m("Id5Status.setUserId: user id updated, hasChanged: ".concat(a)),!0===(t=this.config.getOptions()).abTesting.enabled?this._isExposed=!i.a(e,t.abTesting.controlGroupPct):this._isExposed=!0,this._isExposed&&(s.g((o=this)._availableCallback)&&!1===this._availableCallbackFired&&(this._availableCallbackTimerId&&(s.m("Cancelling pending onAvailableCallback watchdog"),clearTimeout(this._availableCallbackTimerId),this._availableCallbackTimerId=void 0),this._availableCallbackTimerId=setTimeout(function(){return r.doFireOnAvailableCallBack(o)},0)),this._isRefreshing&&s.g(this._refreshCallback)&&!1===this._refreshCallbackFired&&(!1!==n&&!1!==this._isRefreshingWithFetch||(this._refreshCallbackTimerId&&(s.m("Cancelling pending onRefreshCallback watchdog"),clearTimeout(this._refreshCallbackTimerId),this._refreshCallbackTimerId=void 0),this._refreshCallbackTimerId=setTimeout(function(){return r.doFireOnRefreshCallBack(o)},0))),a&&s.g(this._updateCallback)&&setTimeout(function(){return r.doFireOnUpdateCallBack(o)},0))):(this._userId=void 0,this._linkType=void 0,this._fromCache=void 0,this._isExposed=void 0)}},{key:"getUserId",value:function(){return!1===this._isExposed?"0":this._userId}},{key:"getLinkType",value:function(){return!1===this._isExposed?0:this._linkType}},{key:"isFromCache",value:function(){return this._fromCache}},{key:"exposeUserId",value:function(){return this._isExposed}},{key:"getUserIdAsEid",value:function(){return{source:o.a.ID5_EIDS_SOURCE,uids:[{id:this.getUserId(),ext:{linkType:this.getLinkType(),abTestingControlGroup:!this.exposeUserId()}}]}}},{key:"onAvailable",value:function(e,t){if(!s.g(e))throw new Error("onAvailable expect a function");var n;return s.g(this._availableCallback)?s.m("onAvailable was already called, ignoring"):(this._availableCallback=e,(n=this).getUserId()?(s.m("Id5Status.onAvailable: User id already available firing callback immediately"),this._availableCallbackTimerId=setTimeout(function(){return r.doFireOnAvailableCallBack(n)},0)):0<t&&(this._availableCallbackTimerId=setTimeout(function(){return r.doFireOnAvailableCallBack(n)},t))),this}},{key:"onUpdate",value:function(e){if(!s.g(e))throw new Error("onUpdate expect a function");this._updateCallback=e;var t=this;return this.getUserId()&&setTimeout(function(){return r.doFireOnUpdateCallBack(t)},0),this}},{key:"onRefresh",value:function(e,t){if(!s.g(e))throw new Error("onRefresh expect a function");this._refreshCallbackTimerId&&(clearTimeout(this._refreshCallbackTimerId),this._refreshCallbackTimerId=void 0),this._refreshCallback=e;var n=this;return!0===this._isRefreshing&&!1===this._isRefreshingWithFetch&&this.getUserId()?this._refreshCallbackTimerId=setTimeout(function(){return r.doFireOnRefreshCallBack(n)},0):0<t&&(this._refreshCallbackTimerId=setTimeout(function(){return r.doFireOnRefreshCallBack(n)},t)),this}}])&&c(e.prototype,t),n&&c(e,n),r}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0);function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var a=function(){function a(e){if(!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),s(this,"options",void 0),s(this,"providedOptions",void 0),this.options={debugBypassConsent:!1,allowLocalStorageWithoutConsentApi:!1,cmpApi:"iab",consentData:{getConsentData:{consentData:void 0,gdprApplies:void 0},getVendorConsents:{}},refreshInSeconds:7200,partnerId:void 0,partnerUserId:void 0,callbackOnAvailable:void 0,callbackOnUpdates:void 0,callbackTimeoutInMs:void 0,pd:void 0,abTesting:{enabled:!1,controlGroupPct:0},provider:void 0,maxCascades:8,applyCreativeRestrictions:!1},this.providedOptions={},!e.partnerId||"number"!=typeof e.partnerId)throw new Error("partnerId is required and must be a number");this.updOptions(e)}var e,t,n;return e=a,(t=[{key:"getOptions",value:function(){return this.options}},{key:"getProvidedOptions",value:function(){return this.providedOptions}},{key:"updOptions",value:function(t){var n=this;if("object"===r(t)){if("number"==typeof this.options.partnerId&&"number"==typeof t.partnerId&&t.partnerId!==this.options.partnerId)throw new Error("Cannot update config with a different partnerId");Object.keys(t).forEach(function(e){Object(o.e)(t[e],a.configTypes[e])?(n.options[e]=t[e],n.providedOptions[e]=t[e]):Object(o.l)("updOptions options ".concat(e," must be of type ").concat(a.configTypes[e]," but was ").concat(toString.call(t[e])))})}else Object(o.l)("Config options must be an object")}}])&&i(e.prototype,t),n&&i(e,n),a}();s(a,"configTypes",{debugBypassConsent:"Boolean",allowLocalStorageWithoutConsentApi:"Boolean",cmpApi:"String",consentData:"Object",refreshInSeconds:"Number",partnerId:"Number",partnerUserId:"String",callbackOnAvailable:"Function",callbackOnUpdates:"Function",callbackTimeoutInMs:"Number",pd:"String",abTesting:"Object",provider:"String",maxCascades:"Number",applyCreativeRestrictions:"Boolean"})},function(e,t,n){"use strict";t.a=r;var a=n(0),o=1e4;function r(e,t){if(!Object(a.i)(t)||t<0||1<t)throw new Error("A/B Testing controlGroupRatio must be a number >= 0 and <= 1");return((e=e)?(Object(a.b)(e)%o+o)%o:Math.floor(Math.random()*o))<t*o}},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var a="1.0.5"},function(e,t,n){"use strict";function o(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,"a",function(){return a});var i="_exp",a=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r(this,"available",!1),r(this,"win",void 0),r(this,"writingEnabled",!0),this.win=e;e="__id5test";try{this.win.localStorage.setItem(e,e),this.win.localStorage.removeItem(e),this.available=!0}catch(e){}}var e,n,a;return e=t,(n=[{key:"disableWriting",value:function(){this.writingEnabled=!1}},{key:"enableWriting",value:function(){this.writingEnabled=!0}},{key:"isAvailable",value:function(){return this.available}},{key:"getItem",value:function(e){if(this.available)return this.win.localStorage.getItem(e)}},{key:"setItem",value:function(e,t){this.available&&this.writingEnabled&&this.win.localStorage.setItem(e,t)}},{key:"removeItem",value:function(e){this.available&&this.win.localStorage.removeItem(e)}},{key:"getItemWithExpiration",value:function(e){var t=e.name,e=this.getItem(t+i);return!e||new Date(e).getTime()-Date.now()<=0?(this.removeItemWithExpiration({name:t}),null):this.getItem(t)}},{key:"setItemWithExpiration",value:function(e,t){var n=e.name,e=e.expiresDays,e=Date.now()+864e5*e,e=new Date(e).toUTCString();this.setItem(n+i,e),this.setItem(n,t)}},{key:"removeItemWithExpiration",value:function(e){e=e.name;this.removeItem(e),this.removeItem(e+i)}}])&&o(e.prototype,n),a&&o(e,a),t}()}]);