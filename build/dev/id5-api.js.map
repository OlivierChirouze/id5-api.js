{"version":3,"sources":["webpack:///webpack/bootstrap 4393d39345292b6d0fb0","webpack:///./src/utils.js","webpack:///./src/id5-api.js","webpack:///./src/constants.json","webpack:///./src/refererDetection.js","webpack:///./src/clientStore.js","webpack:///./src/consentManagement.js","webpack:///./src/id5Status.js","webpack:///./src/config.js","webpack:///./src/abTesting.js"],"names":["tArr","tStr","tFn","tNumb","tObject","tBoolean","toString","Object","prototype","consoleExists","Boolean","window","console","consoleLogExists","log","consoleInfoExists","info","consoleWarnExists","warn","consoleErrorExists","error","uniqueRef","bind","a","b","Function","self","args","Array","slice","call","arguments","apply","concat","replaceTokenInString","str","map","token","_each","value","key","undefined","keyString","toUpperCase","re","RegExp","replace","logMessage","debugTurnedOn","decorateLog","logInfo","logWarn","logError","prefix","unshift","ID5","debug","getParameterByName","name","regexS","regex","results","exec","location","search","decodeURIComponent","isA","object","_t","isFn","isStr","isArray","isNumber","isPlainObject","isBoolean","isEmpty","length","k","hasOwnProperty","fn","forEach","l","_map","callback","output","push","isSafariBrowser","test","navigator","userAgent","checkCookieSupport","cookieEnabled","document","cookie","cookiesAreEnabled","indexOf","getCookie","m","match","setCookie","expires","encodeURIComponent","hasLocalStorage","localStorage","e","getItemFromLocalStorage","getItem","getFromLocalStorage","storageConfig","storedValueExp","Date","getTime","now","removeFromLocalStorage","setItemInLocalStorage","setItem","setInLocalStorage","expiresStr","expiresDays","toUTCString","removeItemFromLocalStorage","removeItem","parseQS","query","split","reduce","acc","criteria","v","formatQS","keys","join","parse","url","options","parsed","createElement","noDecodeWholeURL","href","qsAsString","decodeSearchAsString","protocol","hostname","port","pathname","hash","host","format","obj","XHR_DONE","ajax","data","x","method","parser","callbacks","success","XMLHttpRequest","onreadystatechange","readyState","status","responseText","statusText","ontimeout","timeout","urlInfo","open","withCredentials","customHeaders","header","setRequestHeader","preflight","contentType","send","fireAsyncPixel","syncUrl","initCallBack","img","Image","src","complete","addEventListener","deferPixelFire","loadedCallback","cyrb53Hash","seed","imul","opA","opB","Math","result","h1","h2","i","ch","charCodeAt","Id5Api","loaded","referer","getRefererInfo","currentThis","clientStore","ClientStore","localStorageAllowed","version","Error","utils","partnerStatus","Id5Status","debugBypassConsent","getOptions","allowLocalStorageWithoutConsentApi","consent","ConsentManagement","getId","partnerId","id5Status","forceFetch","cancelCallback","updOptions","resetConsentData","isLocalStorageAllowed","storedResponse","storedDateTime","nb","refreshInSecondsHasElapsed","pdHasChanged","cachedResponseUsed","updateLocalStorageAllowed","getResponse","getDateTime","refreshInSeconds","getNb","storedPdMatchesPd","pd","getResponseFromLegacyCookie","scheduleWatchDog","universal_uid","setUserId","link_type","incNb","refreshNeeded","JSON","stringify","requestConsent","cmpApi","consentData","consentHasChanged","storedConsentDataMatchesConsentData","putHashedConsentData","putHashedPd","signature","gdprApplies","gdprConsentString","consentString","stack","reachedTop","partnerUserId","currentScript","tpids","response","responseObj","setStoredPrivacy","privacy","putResponse","setDateTime","setNb","clearAll","removeLegacyCookies","cascade_needed","isSync","_userId","forceSync","thisClientStore","syncCallback","detectReferer","win","getLevels","levels","walkUpWindows","ancestors","getAncestorOrigins","ancestor","ancestorOrigins","getPubUrlStack","defUrl","frameLocation","prevFrame","prevRef","detectedRefererUrl","referrer","getCanonicalUrl","doc","element","querySelector","currentWindow","parent","isTop","top","refData","canonicalUrl","refererInfo","numIframes","stackInfo","localStorageAllowedCallback","cacheConfig","legacyStoredValue","CONSTANTS","LEGACY_COOKIE_NAMES","storedValue","get","STORAGE_CONFIG","clear","put","CONSENT_DATA","makeStoredConsentDataHash","pdCacheConfig","storedDataMatchesCurrentData","getHashedPd","makeStoredHash","LAST","timestamp","cachedNb","nbCacheConfig","parseInt","FS","cachedFs","clearResponse","clearDateTime","clearNb","clearHashedPd","clearHashedConsentData","expired","getHashedConsentData","PD","userId","storedData","currentData","storedConsentData","apiVersion","lookupIabConsent","lookupStaticConsentData","cmpSuccess","finalCallback","cmpVersion","staticConsentData","getConsentData","getTCData","consentThis","v2CmpResponseCallback","tcfData","eventStatus","handleV1CmpResponseCallbacks","cmpResponse","afterEach","getVendorConsents","consentDataCallback","consentResponse","vendorConsentsCallback","v1CallbackHandler","findCMP","cmpFrame","cmpFunction","providedConsentData","cmpCallMap","storedPrivacyData","cmpConsentObject","vendorData","tcString","isProvisionalLocalStorageAllowed","purposeConsents","purpose","consents","PRIVACY","id5_consent","jurisdiction","jurisdictionRequiresConsent","JURISDICTIONS","f","__tcfapi","__cmp","frames","consentObject","checkV1Data","checkV2Data","checkFn","storeConsentData","config","Config","linkType","fromCache","_linkType","_fromCache","abTesting","enabled","_isExposed","controlGroupPct","fireCallBack","timerId","clearTimeout","_callbackFired","callbackOnAvailable","callbackTimeoutInMs","setTimeout","doFireCallBack","currentId5Status","require","callbackOnUpdates","providedOptions","topic","configTypes","ABTEST_RESOLUTION","abTestBucket","floor","random","isInControlGroup","controlGroupRatio"],"mappings":"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","file":"id5-api.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 1);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 4393d39345292b6d0fb0","import ID5 from './id5-api';\n\nconst tArr = 'Array';\nconst tStr = 'String';\nconst tFn = 'Function';\nconst tNumb = 'Number';\nconst tObject = 'Object';\nconst tBoolean = 'Boolean';\nconst toString = Object.prototype.toString;\nlet consoleExists = Boolean(window.console);\nlet consoleLogExists = Boolean(consoleExists && window.console.log);\nlet consoleInfoExists = Boolean(consoleExists && window.console.info);\nlet consoleWarnExists = Boolean(consoleExists && window.console.warn);\nlet consoleErrorExists = Boolean(consoleExists && window.console.error);\n\nlet uniqueRef = {};\nexport let bind = function(a, b) { return b; }.bind(null, 1, uniqueRef)() === uniqueRef\n  ? Function.prototype.bind\n  : function(bind) {\n    var self = this;\n    var args = Array.prototype.slice.call(arguments, 1);\n    return function() {\n      return self.apply(bind, args.concat(Array.prototype.slice.call(arguments)));\n    };\n  };\n\n/*\n *   Substitutes into a string from a given map using the token\n *   Usage\n *   var str = 'text %%REPLACE%% this text with %%SOMETHING%%';\n *   var map = {};\n *   map['replace'] = 'it was subbed';\n *   map['something'] = 'something else';\n *   console.log(replaceTokenInString(str, map, '%%')); => \"text it was subbed this text with something else\"\n */\nexport function replaceTokenInString(str, map, token) {\n  _each(map, function (value, key) {\n    value = (value === undefined) ? '' : value;\n\n    let keyString = token + key.toUpperCase() + token;\n    let re = new RegExp(keyString, 'g');\n\n    str = str.replace(re, value);\n  });\n\n  return str;\n}\n\n/**\n * Wrappers to console.(log | info | warn | error). Takes N arguments, the same as the native methods\n */\nexport function logMessage() {\n  if (debugTurnedOn() && consoleLogExists) {\n    console.log.apply(console, decorateLog(arguments, 'MESSAGE:'));\n  }\n}\n\nexport function logInfo() {\n  if (debugTurnedOn() && consoleInfoExists) {\n    console.info.apply(console, decorateLog(arguments, 'INFO:'));\n  }\n}\n\nexport function logWarn() {\n  if (debugTurnedOn() && consoleWarnExists) {\n    console.warn.apply(console, decorateLog(arguments, 'WARNING:'));\n  }\n}\n\nexport function logError() {\n  if (debugTurnedOn() && consoleErrorExists) {\n    console.error.apply(console, decorateLog(arguments, 'ERROR:'));\n  }\n}\n\nfunction decorateLog(args, prefix) {\n  args = [].slice.call(args);\n  prefix && args.unshift(prefix);\n  args.unshift('display: inline-block; color: #fff; background: #1c307e; padding: 1px 4px; border-radius: 3px;');\n  args.unshift('%cID5');\n  return args;\n}\n\nfunction debugTurnedOn() {\n  return ID5 && ID5.debug === true;\n}\n\n/*\n *   Check if a given parameter name exists in query string\n *   and if it does return the value\n */\nexport function getParameterByName(name) {\n  const regexS = '[\\\\?&]' + name + '=([^&#]*)';\n  const regex = new RegExp(regexS);\n  const results = regex.exec(window.location.search);\n  if (results === null) {\n    return '';\n  }\n\n  return decodeURIComponent(results[1].replace(/\\+/g, ' '));\n}\n\n/**\n * Return if the object is of the\n * given type.\n * @param {*} object to test\n * @param {String} _t type string (e.g., Array)\n * @return {Boolean} if object is of type _t\n */\nexport function isA(object, _t) {\n  return toString.call(object) === '[object ' + _t + ']';\n}\n\nexport function isFn(object) {\n  return isA(object, tFn);\n}\n\nexport function isStr(object) {\n  return isA(object, tStr);\n}\n\nexport function isArray(object) {\n  return isA(object, tArr);\n}\n\nexport function isNumber(object) {\n  return isA(object, tNumb);\n}\n\nexport function isPlainObject(object) {\n  return isA(object, tObject);\n}\n\nexport function isBoolean(object) {\n  return isA(object, tBoolean);\n}\n\n/**\n * Return if the object is \"empty\";\n * this includes falsey, no keys, or no items at indices\n * @param {*} object object to test\n * @return {Boolean} if object is empty\n */\nexport function isEmpty(object) {\n  if (!object) return true;\n  if (isArray(object) || isStr(object)) {\n    return !(object.length > 0);\n  }\n\n  for (let k in object) {\n    if (hasOwnProperty.call(object, k)) return false;\n  }\n\n  return true;\n}\n\n/**\n * Iterate object with the function\n * falls back to es5 `forEach`\n * @param {Array|Object} object\n * @param {function(value, key, object)} fn\n */\nexport function _each(object, fn) {\n  if (isEmpty(object)) return;\n  if (isFn(object.forEach)) return object.forEach(fn, this);\n\n  let k = 0;\n  let l = object.length;\n\n  if (l > 0) {\n    for (; k < l; k++) fn(object[k], k, object);\n  } else {\n    for (k in object) {\n      if (hasOwnProperty.call(object, k)) fn.call(this, object[k], k);\n    }\n  }\n}\n\n/**\n * Map an array or object into another array\n * given a function\n * @param {Array|Object} object\n * @param {function(value, key, object)} callback\n * @return {Array}\n */\nexport function _map(object, callback) {\n  if (isEmpty(object)) return [];\n  if (isFn(object.map)) return object.map(callback);\n  var output = [];\n  _each(object, function (value, key) {\n    output.push(callback(value, key, object));\n  });\n\n  return output;\n}\n\nexport function isSafariBrowser() {\n  return /^((?!chrome|android).)*safari/i.test(navigator.userAgent);\n}\n\nexport function checkCookieSupport() {\n  if (window.navigator.cookieEnabled || !!document.cookie.length) {\n    return true;\n  }\n}\nexport function cookiesAreEnabled() {\n  window.document.cookie = 'id5.cookieTest';\n  return window.document.cookie.indexOf('id5.cookieTest') !== -1;\n}\n\nexport function getCookie(name) {\n  let m = window.document.cookie.match('(^|;)\\\\s*' + name + '\\\\s*=\\\\s*([^;]*)\\\\s*(;|$)');\n  return m ? decodeURIComponent(m[2]) : null;\n}\n\nexport function setCookie(key, value, expires) {\n  document.cookie = `${key}=${encodeURIComponent(value)}${(expires !== '') ? `; expires=${expires}` : ''}; path=/`;\n}\n\n/**\n * @returns {boolean}\n */\nfunction hasLocalStorage() {\n  try {\n    return !!window.localStorage;\n  } catch (e) {\n    logError('Local storage api disabled!');\n  }\n  return false;\n}\n\n/**\n * @typedef {object} StoreItem\n * @property {string} name - Unique key of the stored value\n * @property {number} expiresDays - Number of days of TTL\n */\n\n/**\n * Get stored string from local storage\n *\n * @param {string} key\n * @returns {string|null|undefined} the stored value, null if no value or expired were stored, undefined if no localStorage\n */\nexport function getItemFromLocalStorage(key) {\n  if (hasLocalStorage()) {\n    return window.localStorage.getItem(key);\n  }\n}\n\n/**\n * Get StoreItem from local storage\n *\n * @param {string} storageConfig.name\n * @param {number} storageConfig.expiresDays\n * @returns {string|null|undefined} the stored value, null if no value or expired were stored, undefined if no localStorage\n */\nexport function getFromLocalStorage(storageConfig) {\n  const storedValueExp = window.localStorage.getItem(`${storageConfig.name}_exp`);\n  if (storedValueExp && (new Date(storedValueExp)).getTime() - Date.now() > 0) {\n    // result is not expired, so it can be retrieved\n    return getItemFromLocalStorage(storageConfig.name);\n  } else {\n    // if we got here, then we have an expired item, so we need to remove the item\n    // from the local storage\n    removeFromLocalStorage(storageConfig);\n    return null;\n  }\n}\n\n/**\n * Put string in local storage\n *\n * @param {string} key\n * @param {string} value\n * @returns {string|null|undefined} the stored value, null if no value or expired were stored, undefined if no localStorage\n */\nexport function setItemInLocalStorage(key, value) {\n  if (hasLocalStorage()) {\n    window.localStorage.setItem(key, value);\n  }\n}\n\n/**\n * Put StoreItem in local storage\n *\n * @param {StoreItem} storageConfig\n * @param {string} value\n * @returns {string|null|undefined} the stored value, null if no value or expired were stored, undefined if no localStorage\n */\nexport function setInLocalStorage(storageConfig, value) {\n  // always set an expiration\n  const expiresStr = (new Date(Date.now() + (storageConfig.expiresDays * (60 * 60 * 24 * 1000)))).toUTCString();\n  setItemInLocalStorage(`${storageConfig.name}_exp`, expiresStr);\n  setItemInLocalStorage(`${storageConfig.name}`, value);\n}\n\n/**\n * Clear a string in local storage\n *\n * @param {string} key\n */\nexport function removeItemFromLocalStorage(key) {\n  if (hasLocalStorage()) {\n    window.localStorage.removeItem(key);\n  }\n}\n\n/**\n * Clear StoreItem in local storage\n *\n * @param {StoreItem} storageConfig\n */\nexport function removeFromLocalStorage(storageConfig) {\n  removeItemFromLocalStorage(`${storageConfig.name}`);\n  removeItemFromLocalStorage(`${storageConfig.name}_exp`);\n}\n\nexport function parseQS(query) {\n  return !query ? {} : query\n    .replace(/^\\?/, '')\n    .split('&')\n    .reduce((acc, criteria) => {\n      let [k, v] = criteria.split('=');\n      if (/\\[\\]$/.test(k)) {\n        k = k.replace('[]', '');\n        acc[k] = acc[k] || [];\n        acc[k].push(v);\n      } else {\n        acc[k] = v || '';\n      }\n      return acc;\n    }, {});\n}\n\nexport function formatQS(query) {\n  return Object\n    .keys(query)\n    .map(k => Array.isArray(query[k])\n      ? query[k].map(v => `${k}[]=${v}`).join('&')\n      : `${k}=${query[k]}`)\n    .join('&');\n}\n\nexport function parse(url, options) {\n  let parsed = document.createElement('a');\n  if (options && 'noDecodeWholeURL' in options && options.noDecodeWholeURL) {\n    parsed.href = url;\n  } else {\n    parsed.href = decodeURIComponent(url);\n  }\n  // in window.location 'search' is string, not object\n  let qsAsString = (options && 'decodeSearchAsString' in options && options.decodeSearchAsString);\n  return {\n    href: parsed.href,\n    protocol: (parsed.protocol || '').replace(/:$/, ''),\n    hostname: parsed.hostname,\n    port: +parsed.port,\n    pathname: parsed.pathname.replace(/^(?!\\/)/, '/'),\n    search: (qsAsString) ? parsed.search : parseQS(parsed.search || ''),\n    hash: (parsed.hash || '').replace(/^#/, ''),\n    host: parsed.host || window.location.host\n  };\n}\n\nexport function format(obj) {\n  return (obj.protocol || 'http') + '://' +\n    (obj.host ||\n        obj.hostname + (obj.port ? `:${obj.port}` : '')) +\n    (obj.pathname || '') +\n    (obj.search ? `?${formatQS(obj.search || '')}` : '') +\n    (obj.hash ? `#${obj.hash}` : '');\n}\n\nconst XHR_DONE = 4;\n\n/**\n * Simple IE9+ and cross-browser ajax request function\n * Note: x-domain requests in IE9 do not support the use of cookies\n *\n * @param url string url\n * @param callback {object | function} callback\n * @param data mixed data\n * @param options object\n */\nexport function ajax(url, callback, data, options = {}) {\n  try {\n    let x;\n    let method = options.method || (data ? 'POST' : 'GET');\n    let parser = document.createElement('a');\n    parser.href = url;\n\n    let callbacks = typeof callback === 'object' && callback !== null ? callback : {\n      success: function() {\n        logMessage('xhr success');\n      },\n      error: function(e) {\n        logError('xhr error', null, e);\n      }\n    };\n\n    if (typeof callback === 'function') {\n      callbacks.success = callback;\n    }\n\n    x = new window.XMLHttpRequest();\n\n    x.onreadystatechange = function () {\n      if (x.readyState === XHR_DONE) {\n        let status = x.status;\n        if ((status >= 200 && status < 300) || status === 304) {\n          callbacks.success(x.responseText, x);\n        } else {\n          callbacks.error(x.statusText, x);\n        }\n      }\n    };\n\n    x.ontimeout = function () {\n      logError('  xhr timeout after ', x.timeout, 'ms');\n    };\n\n    if (method === 'GET' && data) {\n      let urlInfo = parse(url, options);\n      Object.assign(urlInfo.search, data);\n      url = format(urlInfo);\n    }\n\n    x.open(method, url, true);\n\n    if (options.withCredentials) {\n      x.withCredentials = true;\n    }\n    _each(options.customHeaders, (value, header) => {\n      x.setRequestHeader(header, value);\n    });\n    if (options.preflight) {\n      x.setRequestHeader('X-Requested-With', 'XMLHttpRequest');\n    }\n    x.setRequestHeader('Content-Type', options.contentType || 'text/plain');\n\n    if (method === 'POST' && data) {\n      x.send(data);\n    } else {\n      x.send();\n    }\n  } catch (error) {\n    logError('xhr construction', error);\n  }\n}\n\n/**\n * add an Image pixel to the DOM for the given sync Url\n *\n * @param syncUrl\n * @param initCallBack Called when pixel is initiated. Always called. Optional\n * @param callback Called when pixel is loaded. May never be called. Optional\n */\nexport function fireAsyncPixel(syncUrl, initCallBack, callback) {\n  let img = new Image();\n  img.src = syncUrl;\n  if (isFn(initCallBack)) {\n    initCallBack();\n  }\n  if (isFn(callback)) {\n    if (img.complete) {\n      callback()\n    } else {\n      img.addEventListener('load', callback)\n    }\n  }\n}\n\n/**\n * wait until the page finishes loading and then fire a pixel\n *\n * @param syncUrl\n * @param initCallBack Called when pixel is initiated. Optional\n * @param loadedCallback Called when pixel is loaded (may never be called). Optional\n */\nexport function deferPixelFire(syncUrl, initCallBack, loadedCallback) {\n  if (document.readyState !== 'loading') {\n    fireAsyncPixel(syncUrl, initCallBack, loadedCallback);\n  } else {\n    document.addEventListener('DOMContentLoaded', function () {\n      fireAsyncPixel(syncUrl, initCallBack, loadedCallback);\n    });\n  }\n}\n\n/**\n * returns a hash of a string using a fast algorithm\n * source: https://stackoverflow.com/a/52171480/845390\n * @param {string} str\n * @param {number} [seed] (optional)\n * @returns {string}\n */\nexport function cyrb53Hash(str, seed = 0) {\n  // IE doesn't support imul\n  // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/imul#Polyfill\n  let imul = function(opA, opB) {\n    if (isFn(Math.imul)) {\n      return Math.imul(opA, opB);\n    } else {\n      opB |= 0; // ensure that opB is an integer. opA will automatically be coerced.\n      // floating points give us 53 bits of precision to work with plus 1 sign bit\n      // automatically handled for our convienence:\n      // 1. 0x003fffff /*opA & 0x000fffff*/ * 0x7fffffff /*opB*/ = 0x1fffff7fc00001\n      //    0x1fffff7fc00001 < Number.MAX_SAFE_INTEGER /*0x1fffffffffffff*/\n      var result = (opA & 0x003fffff) * opB;\n      // 2. We can remove an integer coersion from the statement above because:\n      //    0x1fffff7fc00001 + 0xffc00000 = 0x1fffffff800001\n      //    0x1fffffff800001 < Number.MAX_SAFE_INTEGER /*0x1fffffffffffff*/\n      if (opA & 0xffc00000) result += (opA & 0xffc00000) * opB | 0;\n      return result | 0;\n    }\n  };\n\n  let h1 = 0xdeadbeef ^ seed;\n  let h2 = 0x41c6ce57 ^ seed;\n  for (let i = 0, ch; i < str.length; i++) {\n    ch = str.charCodeAt(i);\n    h1 = imul(h1 ^ ch, 2654435761);\n    h2 = imul(h2 ^ ch, 1597334677);\n  }\n  h1 = imul(h1 ^ (h1 >>> 16), 2246822507) ^ imul(h2 ^ (h2 >>> 13), 3266489909);\n  h2 = imul(h2 ^ (h2 >>> 16), 2246822507) ^ imul(h1 ^ (h1 >>> 13), 3266489909);\n  return (4294967296 * (2097151 & h2) + (h1 >>> 0)).toString();\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/utils.js","/** @module id5-api */\n\nimport * as utils from './utils';\nimport { getRefererInfo } from './refererDetection';\nimport ClientStore from './clientStore';\nimport ConsentManagement from './consentManagement';\nimport Id5Status from './id5Status';\n\nexport class Id5Api {\n  /** @type {boolean} */\n  loaded = false\n  /** @type {boolean} */\n  debug = false\n  /** @type {boolean} */\n  debugBypassConsent = false\n  /** @type {boolean} */\n  allowLocalStorageWithoutConsentApi = false\n  /** @type {boolean} */\n  localStorageAllowed = false\n  /** @type {object} */\n  referer = false\n  /** @type {string} */\n  version\n  /** @type {object} */\n  versions = {}\n\n  constructor() {\n    this.loaded = true;\n    this.referer = getRefererInfo();\n    const currentThis = this; // preserve this in callback\n    this.clientStore = new ClientStore(() => { return currentThis.localStorageAllowed });\n  }\n\n  /**\n   * This function will initialize ID5, wait for consent then try to fetch or refresh ID5 user id if required\n   * @param {Id5Options} options\n   */\n  init(options) {\n    if (typeof this.version === 'undefined') {\n      throw new Error('ID5.version variable is missing! Make sure you build from source with \"gulp build\" from this project. Contact support@id5.io for help.');\n    }\n\n    try {\n      utils.logInfo('Invoking Id5Api.init', arguments);\n      this.debug = this.debug || options.debug;\n      const partnerStatus = new Id5Status(options);\n      this.debugBypassConsent = this.debugBypassConsent || partnerStatus.getOptions().debugBypassConsent;\n      this.allowLocalStorageWithoutConsentApi = this.allowLocalStorageWithoutConsentApi || partnerStatus.getOptions().allowLocalStorageWithoutConsentApi;\n      this.consent = new ConsentManagement();\n      this.getId(partnerStatus, false);\n      utils.logInfo(`ID5 initialized for partner ${partnerStatus.getOptions().partnerId} referer is ${this.referer.referer}`);\n      return partnerStatus;\n    } catch (e) {\n      utils.logError('Exception caught from Id5Api.init', e);\n    }\n  };\n\n  /** @param {Id5Status} id5Status - Initializes id5Status returned by `init()`\n   * @param {boolean} forceFetch\n   * @param {Id5Options} [options] - Options to update */\n  refreshId(id5Status, forceFetch = false, options = {}) {\n    if (typeof this.version === 'undefined') {\n      throw new Error('ID5.version variable is missing! Make sure you build from source with \"gulp build\" from this project. Contact support@id5.io for help.');\n    }\n    if (!utils.isBoolean(forceFetch)) {\n      throw new Error('Invalid signature for Id5Api.refreshId: second parameter must be a boolean');\n    }\n\n    try {\n      utils.logInfo('Invoking Id5Api.refreshId', arguments);\n      id5Status.cancelCallback();\n      id5Status.updOptions(options);\n      this.consent.resetConsentData();\n      this.getId(id5Status, forceFetch);\n    } catch (e) {\n      utils.logError('Exception caught from Id5Api.refreshId', e);\n    }\n  };\n\n  updateLocalStorageAllowed() {\n    this.localStorageAllowed = this.consent.isLocalStorageAllowed(this.allowLocalStorageWithoutConsentApi, this.debugBypassConsent);\n  }\n\n  /**\n   * This function get the user ID for the given config\n   * @param {Id5Status} id5Status\n   * @param {boolean} forceFetch - Force a call to server\n   */\n  getId(id5Status, forceFetch = false) {\n    const options = id5Status.getOptions();\n    let storedResponse;\n    let storedDateTime;\n    let nb = 0;\n    let refreshInSecondsHasElapsed = false;\n    let pdHasChanged = false;\n    let cachedResponseUsed = false;\n\n    this.updateLocalStorageAllowed();\n    if (this.localStorageAllowed) {\n      storedResponse = this.clientStore.getResponse();\n      storedDateTime = this.clientStore.getDateTime();\n      refreshInSecondsHasElapsed = storedDateTime <= 0 || ((Date.now() - storedDateTime) > (options.refreshInSeconds * 1000));\n      nb = this.clientStore.getNb(options.partnerId);\n      pdHasChanged = !this.clientStore.storedPdMatchesPd(options.partnerId, options.pd);\n    }\n\n    if (!storedResponse) {\n      storedResponse = this.clientStore.getResponseFromLegacyCookie();\n      refreshInSecondsHasElapsed = true; // Force a refresh if we have legacy cookie\n    }\n\n    id5Status.scheduleWatchDog();\n\n    if (storedResponse && storedResponse.universal_uid && !pdHasChanged) {\n      // we have a valid stored response and pd is not different, so\n      // use the stored response to make the ID available right away\n\n      id5Status.setUserId(storedResponse.universal_uid, storedResponse.link_type || 0, true)\n      nb = this.clientStore.incNb(options.partnerId, nb);\n      cachedResponseUsed = true;\n\n      utils.logInfo('ID5 User ID available from cache:', {\n        storedResponse,\n        storedDateTime,\n        refreshNeeded: refreshInSecondsHasElapsed\n      });\n    } else if (storedResponse && storedResponse.universal_uid && pdHasChanged) {\n      utils.logInfo('PD value has changed, so ignoring User ID from cache');\n    } else if (storedResponse && !storedResponse.universal_uid) {\n      utils.logError('Invalid stored response: ', JSON.stringify(storedResponse));\n    } else {\n      utils.logInfo('No ID5 User ID available from cache');\n    }\n\n    this.consent.requestConsent(this.debugBypassConsent, options.cmpApi, options.consentData, (consentData) => {\n      // re-evaluate local storage access as consent is now available\n      this.updateLocalStorageAllowed();\n      if (this.localStorageAllowed !== false) {\n        utils.logInfo('Consent to access local storage is given: ', this.localStorageAllowed);\n\n        storedResponse = this.clientStore.getResponse() || this.clientStore.getResponseFromLegacyCookie();\n\n        // store hashed consent data and pd for future page loads\n        const consentHasChanged = !this.clientStore.storedConsentDataMatchesConsentData(consentData);\n        this.clientStore.putHashedConsentData(consentData);\n        this.clientStore.putHashedPd(options.partnerId, options.pd);\n\n        // make a call to fetch a new ID5 ID if:\n        // - there is no valid universal_uid or no signature in cache\n        // - the last refresh was longer than refreshInSeconds ago\n        // - consent has changed since the last ID was fetched\n        // - pd has changed since the last ID was fetched\n        // - fetch is being forced (e.g. by refreshId())\n        if (\n          !storedResponse || !storedResponse.universal_uid || !storedResponse.signature ||\n          refreshInSecondsHasElapsed ||\n          consentHasChanged ||\n          pdHasChanged ||\n          forceFetch\n        ) {\n          const url = `https://id5-sync.com/g/v2/${options.partnerId}.json`;\n          const gdprApplies = (consentData && consentData.gdprApplies) ? 1 : 0;\n          const gdprConsentString = (consentData && consentData.gdprApplies) ? consentData.consentString : '';\n          const signature = (storedResponse && storedResponse.signature) ? storedResponse.signature : '';\n          const data = {\n            'partner': options.partnerId,\n            'v': this.version,\n            'o': 'api',\n            'gdpr': gdprApplies,\n            'gdpr_consent': gdprConsentString,\n            'rf': this.referer.referer,\n            'u': this.referer.stack[0] || window.location.href,\n            'top': this.referer.reachedTop ? 1 : 0,\n            's': signature,\n            'pd': options.pd,\n            'puid': options.partnerUserId,\n            'nbPage': nb,\n            'id5cdn': (document.currentScript && document.currentScript.src && document.currentScript.src.indexOf('https://cdn.id5-sync.com') === 0)\n          };\n          if (options.tpids && utils.isArray(options.tpids) && options.tpids.length > 0) {\n            data.tpids = options.tpids;\n          }\n\n          utils.logInfo('Fetching ID5 user ID from:', url, data);\n          if (forceFetch) {\n            utils.logInfo('...with Force Fetch');\n          }\n          utils.ajax(url, {\n            success: response => {\n              utils.logInfo('Response from ID5 received:', response);\n              let responseObj;\n              if (response) {\n                try {\n                  responseObj = JSON.parse(response);\n                  utils.logInfo('Valid json response from ID5 received:', responseObj);\n                  if (responseObj.universal_uid) {\n                    id5Status.setUserId(responseObj.universal_uid, responseObj.link_type || 0, false);\n\n                    // privacy has to be stored first so we can use it when storing other values\n                    this.consent.setStoredPrivacy(responseObj.privacy);\n                    // re-evaluate local storage access as geo is now available\n                    this.updateLocalStorageAllowed();\n\n                    // @TODO: typeof responseObj.privacy === 'undefined' is only needed until fetch endpoint is updated and always returns a privacy object\n                    // once it does, I don't see a reason to keep that part of the if clause\n                    if (this.localStorageAllowed === true || typeof responseObj.privacy === 'undefined') {\n                      this.clientStore.putResponse(response);\n                      this.clientStore.setDateTime(Date.now());\n                      this.clientStore.setNb(options.partnerId, (cachedResponseUsed ? 0 : 1));\n                    } else {\n                      this.clientStore.clearAll(options.partnerId);\n                    }\n                    // TEMPORARY until all clients have upgraded past v1.0.0\n                    // remove cookies that were previously set\n                    this.clientStore.removeLegacyCookies(options.partnerId);\n\n                    if (responseObj.cascade_needed === true && this.localStorageAllowed === true) {\n                      const isSync = options.partnerUserId && options.partnerUserId.length > 0;\n                      const syncUrl = `https://id5-sync.com/${isSync ? 's' : 'i'}/${options.partnerId}/8.gif?id5id=${id5Status._userId}&fs=${this.clientStore.forceSync()}&o=api&${isSync ? 'puid=' + options.partnerUserId + '&' : ''}gdpr_consent=${gdprConsentString}&gdpr=${gdprApplies}`;\n                      utils.logInfo('Opportunities to cascade available:', syncUrl);\n                      const thisClientStore = this.clientStore; // preserve this in callback\n                      utils.deferPixelFire(syncUrl, undefined, () => { thisClientStore.syncCallback() });\n                    }\n                  } else {\n                    utils.logError('Invalid response from ID5 servers:', response);\n                  }\n                } catch (error) {\n                  utils.logError(error);\n                }\n              } else {\n                utils.logError('Empty response from ID5 servers:', response);\n              }\n            },\n            error: error => {\n              utils.logError(error);\n            }\n          }, JSON.stringify(data), {method: 'POST', withCredentials: true});\n        }\n      } else {\n        utils.logInfo('No legal basis to use ID5', consentData);\n      }\n    });\n  }\n}\n\nif (!window.ID5) {\n  window.ID5 = new Id5Api();\n} else {\n  // TODO: Check for different versions in the same page at init\n}\n\nexport const ID5 = window.ID5;\nexport default ID5;\n\n\n\n// WEBPACK FOOTER //\n// ./src/id5-api.js","module.exports = {\"STORAGE_CONFIG\":{\"ID5\":{\"name\":\"id5id\",\"expiresDays\":90},\"LAST\":{\"name\":\"id5id_last\",\"expiresDays\":90},\"CONSENT_DATA\":{\"name\":\"id5id_cached_consent_data\",\"expiresDays\":30},\"PD\":{\"name\":\"id5id_cached_pd\",\"expiresDays\":30},\"FS\":{\"name\":\"id5id_fs\",\"expiresDays\":7},\"PRIVACY\":{\"name\":\"id5id_privacy\",\"expiresDays\":30}},\"LEGACY_COOKIE_NAMES\":[\"id5.1st\",\"id5id.1st\"],\"PRIVACY\":{\"JURISDICTIONS\":{\"gdpr\":true,\"ccpa\":false,\"lgpd\":true,\"other\":false}}}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/constants.json\n// module id = 2\n// module chunks = 0","/**\n * The referer detection module attempts to gather referer information from the current page that id5-api.js resides in.\n * The information that it tries to collect includes:\n * The detected top url in the nav bar,\n * Whether it was able to reach the top most window (if for example it was embedded in several iframes),\n * The number of iframes it was embedded in if applicable,\n * A list of the domains of each embedded window if applicable.\n * Canonical URL which refers to an HTML link element, with the attribute of rel=\"canonical\", found in the <head> element of your webpage\n */\n\nexport function detectReferer(win) {\n  /**\n   * Returns number of frames to reach top from current frame\n   * @returns {Array} levels\n   */\n  function getLevels() {\n    let levels = walkUpWindows();\n    let ancestors = getAncestorOrigins();\n\n    if (ancestors) {\n      for (let i = 0, l = ancestors.length; i < l; i++) {\n        levels[i].ancestor = ancestors[i];\n      }\n    }\n    return levels;\n  }\n\n  /**\n   * This function would return a read-only array of hostnames for all the parent frames.\n   * win.location.ancestorOrigins is only supported in webkit browsers. For non-webkit browsers it will return undefined.\n   * @returns {(undefined|Array)} Ancestor origins or undefined\n   */\n  function getAncestorOrigins() {\n    try {\n      if (!win.location.ancestorOrigins) {\n        return;\n      }\n      return win.location.ancestorOrigins;\n    } catch (e) {\n      // Ignore error\n    }\n  }\n\n  /**\n   * This function would try to get referer and urls for all parent frames in case of win.location.ancestorOrigins undefined.\n   * @param {Array} levels\n   * @returns {Object} urls for all parent frames and top most detected referer url\n   */\n  function getPubUrlStack(levels) {\n    let stack = [];\n    let defUrl = null;\n    let frameLocation = null;\n    let prevFrame = null;\n    let prevRef = null;\n    let ancestor = null;\n    let detectedRefererUrl = null;\n\n    let i;\n    for (i = levels.length - 1; i >= 0; i--) {\n      try {\n        frameLocation = levels[i].location;\n      } catch (e) {\n        // Ignore error\n      }\n\n      if (frameLocation) {\n        stack.push(frameLocation);\n        if (!detectedRefererUrl) {\n          detectedRefererUrl = frameLocation;\n        }\n      } else if (i !== 0) {\n        prevFrame = levels[i - 1];\n        try {\n          prevRef = prevFrame.referrer;\n          ancestor = prevFrame.ancestor;\n        } catch (e) {\n          // Ignore error\n        }\n\n        if (prevRef) {\n          stack.push(prevRef);\n          if (!detectedRefererUrl) {\n            detectedRefererUrl = prevRef;\n          }\n        } else if (ancestor) {\n          stack.push(ancestor);\n          if (!detectedRefererUrl) {\n            detectedRefererUrl = ancestor;\n          }\n        } else {\n          stack.push(defUrl);\n        }\n      } else {\n        stack.push(defUrl);\n      }\n    }\n    return {\n      stack,\n      detectedRefererUrl\n    };\n  }\n\n  /**\n   * This function returns canonical URL which refers to an HTML link element, with the attribute of rel=\"canonical\", found in the <head> element of your webpage\n   * @param {Object} doc document\n   */\n  function getCanonicalUrl(doc) {\n    try {\n      let element = doc.querySelector(\"link[rel='canonical']\");\n      if (element !== null) {\n        return element.href;\n      }\n    } catch (e) {\n    }\n    return null;\n  }\n\n  /**\n   * Walk up to the top of the window to detect origin, number of iframes, ancestor origins and canonical url\n   */\n  function walkUpWindows() {\n    let acc = [];\n    let currentWindow;\n    do {\n      try {\n        currentWindow = currentWindow ? currentWindow.parent : win;\n        try {\n          let isTop = (currentWindow === win.top);\n          let refData = {\n            referrer: currentWindow.document.referrer || null,\n            location: currentWindow.location.href || null,\n            isTop\n          }\n          if (isTop) {\n            refData = Object.assign(refData, {\n              canonicalUrl: getCanonicalUrl(currentWindow.document)\n            })\n          }\n          acc.push(refData);\n        } catch (e) {\n          acc.push({\n            referrer: null,\n            location: null,\n            isTop: (currentWindow === win.top)\n          });\n        }\n      } catch (e) {\n        acc.push({\n          referrer: null,\n          location: null,\n          isTop: false\n        });\n        return acc;\n      }\n    } while (currentWindow !== win.top);\n    return acc;\n  }\n\n  /**\n   * Referer info\n   * @typedef {Object} refererInfo\n   * @property {string} referer detected top url\n   * @property {boolean} reachedTop whether it was possible to walk upto top window or not\n   * @property {number} numIframes number of iframes\n   * @property {string} stack comma separated urls of all origins\n   * @property {string} canonicalUrl canonical URL refers to an HTML link element, with the attribute of rel=\"canonical\", found in the <head> element of your webpage\n   */\n\n  /**\n   * Get referer info\n   * @returns {refererInfo}\n   */\n  function refererInfo() {\n    try {\n      let levels = getLevels();\n      let numIframes = levels.length - 1;\n      let reachedTop = (levels[numIframes].location !== null ||\n        (numIframes > 0 && levels[numIframes - 1].referrer !== null));\n      let stackInfo = getPubUrlStack(levels);\n      let canonicalUrl;\n      if (levels[levels.length - 1].canonicalUrl) {\n        canonicalUrl = levels[levels.length - 1].canonicalUrl;\n      }\n\n      return {\n        referer: stackInfo.detectedRefererUrl,\n        reachedTop,\n        numIframes,\n        stack: stackInfo.stack,\n        canonicalUrl\n      };\n    } catch (e) {\n      // Ignore error\n    }\n  }\n\n  return refererInfo;\n}\n\nexport const getRefererInfo = detectReferer(window);\n\n\n\n// WEBPACK FOOTER //\n// ./src/refererDetection.js","/*\n * Module for managing storage of information in browser Local Storage and/or cookies\n */\n\nimport * as utils from './utils';\nimport CONSTANTS from './constants.json';\n\nexport default class ClientStore {\n  /** @type {function} */\n  localStorageAllowedCallback\n\n  /* @param {function} localStorageAllowedCallback */\n  constructor(localStorageAllowedCallback) {\n    this.localStorageAllowedCallback = localStorageAllowedCallback;\n  }\n  /**\n   * Get stored data from local storage, if any, after checking if local storage is allowed\n   * @param {StoreItem} cacheConfig\n   * @returns {string|null|undefined} the stored value, null if no value or expired were stored, undefined if no consent or no access to localStorage\n   */\n  get(cacheConfig) {\n    try {\n      if (this.localStorageAllowedCallback() === true) {\n        return utils.getFromLocalStorage(cacheConfig);\n      } else {\n        utils.logError('clientStore.get() has been called without localStorageAllowed')\n      }\n    } catch (e) {\n      utils.logError(e);\n    }\n  }\n\n  /**\n   * clear stored data from local storage, if any\n   * @param {StoreItem} cacheConfig\n   */\n  clear(cacheConfig) {\n    try {\n      utils.removeFromLocalStorage(cacheConfig);\n    } catch (e) {\n      utils.logError(e);\n    }\n  }\n\n  /**\n   * puts the current data into local storage, after checking for local storage access\n   * @param {StoreItem} cacheConfig\n   * @param {string} data\n   */\n  put(cacheConfig, data) {\n    try {\n      if (this.localStorageAllowedCallback() === true) {\n        utils.setInLocalStorage(cacheConfig, data);\n      } else {\n        utils.logError('clientStore.get() has been called without localStorageAllowed')\n      }\n    } catch (e) {\n      utils.logError(e);\n    }\n  }\n\n  getResponseFromLegacyCookie() {\n    let legacyStoredValue;\n    CONSTANTS.LEGACY_COOKIE_NAMES.forEach(function (cookie) {\n      if (utils.getCookie(cookie)) {\n        legacyStoredValue = utils.getCookie(cookie);\n      }\n    });\n    if (legacyStoredValue) {\n      return JSON.parse(legacyStoredValue);\n    } else {\n      return null;\n    }\n  }\n\n  getResponse() {\n    let storedValue = this.get(CONSTANTS.STORAGE_CONFIG.ID5);\n    if (storedValue) {\n      return JSON.parse(storedValue);\n    } else {\n      return storedValue;\n    }\n  }\n\n  clearResponse() {\n    this.clear(CONSTANTS.STORAGE_CONFIG.ID5);\n  }\n\n  putResponse(response) {\n    this.put(CONSTANTS.STORAGE_CONFIG.ID5, response);\n  }\n\n  getHashedConsentData() {\n    return this.get(CONSTANTS.STORAGE_CONFIG.CONSENT_DATA);\n  }\n\n  clearHashedConsentData() {\n    this.clear(CONSTANTS.STORAGE_CONFIG.CONSENT_DATA);\n  }\n\n  putHashedConsentData(consentData) {\n    this.put(CONSTANTS.STORAGE_CONFIG.CONSENT_DATA, ClientStore.makeStoredConsentDataHash(consentData));\n  }\n\n  /**\n   * Get current hash PD for this partner\n   * @param {number} partnerId\n   */\n  getHashedPd(partnerId) {\n    return this.get(ClientStore.pdCacheConfig(partnerId));\n  }\n\n  /**\n   * Check current hash PD for this partner against the one in cache\n   * @param {number} partnerId\n   * @param {string} pd\n   */\n  storedPdMatchesPd(partnerId, pd) {\n    return ClientStore.storedDataMatchesCurrentData(this.getHashedPd(partnerId), ClientStore.makeStoredHash(pd));\n  }\n\n  /**\n   * Clear the hash PD for this partner\n   * @param {number} partnerId\n   */\n  clearHashedPd(partnerId) {\n    this.clear(ClientStore.pdCacheConfig(partnerId));\n  }\n\n  /**\n   * Hash and store the PD for this partner\n   * @param {number} partnerId\n   * @param {string} [pd]\n   */\n  putHashedPd(partnerId, pd) {\n    this.put(ClientStore.pdCacheConfig(partnerId), ClientStore.makeStoredHash(pd));\n  }\n\n  /**\n   * Generate local storage config for PD of a given partner\n   * @param {number} partnerId\n   * @return {StoreItem}\n   */\n  static pdCacheConfig(partnerId) {\n    return {\n      name: `${CONSTANTS.STORAGE_CONFIG.PD.name}_${partnerId}`,\n      expiresDays: CONSTANTS.STORAGE_CONFIG.PD.expiresDays\n    }\n  }\n\n  /**\n   * creates a hash of a user identifier for storage\n   * @param {string} userId\n   * @returns {string}\n   */\n  static makeStoredHash(userId) {\n    return utils.cyrb53Hash(typeof userId === 'string' ? userId : '');\n  }\n\n  getDateTime() {\n    return (new Date(+this.get(CONSTANTS.STORAGE_CONFIG.LAST))).getTime()\n  }\n\n  clearDateTime() {\n    this.clear(CONSTANTS.STORAGE_CONFIG.LAST);\n  }\n\n  setDateTime(timestamp) {\n    this.put(CONSTANTS.STORAGE_CONFIG.LAST, timestamp);\n  }\n\n  static nbCacheConfig(partnerId) {\n    return {\n      name: `${CONSTANTS.STORAGE_CONFIG.ID5.name}_${partnerId}_nb`,\n      expiresDays: CONSTANTS.STORAGE_CONFIG.ID5.expiresDays\n    }\n  }\n\n  getNb(partnerId) {\n    const cachedNb = this.get(ClientStore.nbCacheConfig(partnerId));\n    return (cachedNb) ? parseInt(cachedNb) : 0;\n  }\n\n  clearNb(partnerId) {\n    this.clear(ClientStore.nbCacheConfig(partnerId));\n  }\n\n  setNb(partnerId, nb) {\n    this.put(ClientStore.nbCacheConfig(partnerId), nb);\n  }\n\n  incNb(partnerId, nb) {\n    nb++;\n    this.setNb(partnerId, nb);\n    return nb;\n  }\n\n  syncCallback() {\n    this.put(CONSTANTS.STORAGE_CONFIG.FS, '1');\n  }\n\n  forceSync() {\n    const cachedFs = this.get(CONSTANTS.STORAGE_CONFIG.FS);\n    // Force cascade if we have access to Local Storage and we never cascaded\n    return (typeof cachedFs === 'undefined' || cachedFs === '1') ? 0 : 1;\n  }\n\n  clearAll(partnerId) {\n    this.clearResponse();\n    this.clearDateTime();\n    this.clearNb(partnerId);\n    this.clearHashedPd(partnerId);\n    this.clearHashedConsentData();\n  }\n\n  removeLegacyCookies(partnerId) {\n    const expired = (new Date(Date.now() - 1000)).toUTCString();\n    CONSTANTS.LEGACY_COOKIE_NAMES.forEach(function (cookie) {\n      utils.setCookie(`${cookie}`, '', expired);\n      utils.setCookie(`${cookie}_nb`, '', expired);\n      utils.setCookie(`${cookie}_${partnerId}_nb`, '', expired);\n      utils.setCookie(`${cookie}_last`, '', expired);\n      utils.setCookie(`${cookie}.cached_pd`, '', expired);\n      utils.setCookie(`${cookie}.cached_consent_data`, '', expired);\n    });\n  }\n\n  /**\n   * test if the data stored locally matches the current data.\n   * if there is nothing in storage, return true and we'll do an actual comparison next time.\n   * this way, we don't force a refresh for every user when this code rolls out\n   * @param storedData\n   * @param currentData\n   * @returns {boolean}\n   */\n  static storedDataMatchesCurrentData(storedData, currentData) {\n    return (\n      typeof storedData === 'undefined' ||\n      storedData === null ||\n      storedData === currentData\n    );\n  }\n\n  storedConsentDataMatchesConsentData(consentData) {\n    return ClientStore.storedDataMatchesCurrentData(this.getHashedConsentData(), ClientStore.makeStoredConsentDataHash(consentData));\n  }\n\n  /**\n   * makes an object that can be stored with only the keys we need to check.\n   * excluding the vendorConsents object since the consentString is enough to know\n   * if consent has changed without needing to have all the details in an object\n   * @param consentData\n   * @returns string\n   */\n  static makeStoredConsentDataHash(consentData) {\n    const storedConsentData = {\n      consentString: '',\n      gdprApplies: false,\n      apiVersion: 0\n    };\n\n    if (consentData) {\n      storedConsentData.consentString = consentData.consentString;\n      storedConsentData.gdprApplies = consentData.gdprApplies;\n      storedConsentData.apiVersion = consentData.apiVersion;\n    }\n\n    return utils.cyrb53Hash(JSON.stringify(storedConsentData));\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/clientStore.js","import * as utils from './utils';\nimport CONSTANTS from 'src/constants.json';\n\nexport default class ConsentManagement {\n  consentData;\n  staticConsentData;\n  storedPrivacyData;\n  cmpVersion = 0;\n\n  cmpCallMap = {\n    'iab': this.lookupIabConsent,\n    'static': this.lookupStaticConsentData\n  };\n\n  /**\n   * This function reads the consent string from the config to obtain the consent information of the user.\n   * @param {function(ConsentManagement, string, function(object))} cmpSuccess acts as a success callback when the value is read from config; pass along consentObject (string) from CMP\n   * @param {function(object)} finalCallback acts as an error callback while interacting with the config string; pass along an error message (string)\n   */\n  lookupStaticConsentData(cmpSuccess, finalCallback) {\n    this.cmpVersion = (this.staticConsentData.getConsentData) ? 1 : (this.staticConsentData.getTCData) ? 2 : 0;\n    // remove extra layer in static v2 data object so it matches normal v2 CMP object for processing step\n    if (this.cmpVersion === 2) {\n      cmpSuccess(this, this.staticConsentData.getTCData, finalCallback);\n    } else {\n      cmpSuccess(this, this.staticConsentData, finalCallback);\n    }\n  }\n\n  /**\n   * @typedef {Object} CMPDetails\n   * @property {number} cmpVersion - Version of CMP Found, 0 if not found\n   * @property {function} [cmpFrame] -\n   * @property {function} [cmpFunction] -\n   *\n   * This function tries to find the CMP in page.\n   * @return {CMPDetails}\n   */\n  static findCMP() {\n    let cmpVersion = 0;\n    let f = window;\n    let cmpFrame;\n    let cmpFunction;\n    while (!cmpFrame) {\n      try {\n        if (typeof f.__tcfapi === 'function' || typeof f.__cmp === 'function') {\n          if (typeof f.__tcfapi === 'function') {\n            cmpVersion = 2;\n            cmpFunction = f.__tcfapi;\n          } else {\n            cmpVersion = 1;\n            cmpFunction = f.__cmp;\n          }\n          cmpFrame = f;\n          break;\n        }\n      } catch (e) { }\n\n      // need separate try/catch blocks due to the exception errors thrown when trying to check for a frame that doesn't exist in 3rd party env\n      try {\n        if (f.frames['__tcfapiLocator']) {\n          cmpVersion = 2;\n          cmpFrame = f;\n          break;\n        }\n      } catch (e) { }\n\n      try {\n        if (f.frames['__cmpLocator']) {\n          cmpVersion = 1;\n          cmpFrame = f;\n          break;\n        }\n      } catch (e) { }\n\n      if (f === window.top) break;\n      f = f.parent;\n    }\n    return {\n      cmpVersion,\n      cmpFrame,\n      cmpFunction\n    };\n  }\n  /**\n   * This function handles async interacting with an IAB compliant CMP to obtain the consent information of the user.\n   * @param {function(ConsentManagement, string, function(object))} cmpSuccess acts as a success callback when CMP returns a value; pass along consentObject (string) from CMP\n   * @param {function(object)} finalCallback required;\n   */\n  lookupIabConsent(cmpSuccess, finalCallback) {\n    const consentThis = this;\n    function v2CmpResponseCallback(tcfData, success) {\n      utils.logInfo('Received a response from CMP', tcfData);\n      if (success) {\n        if (tcfData.gdprApplies === false || tcfData.eventStatus === 'tcloaded' || tcfData.eventStatus === 'useractioncomplete') {\n          cmpSuccess(consentThis, tcfData, finalCallback);\n        }\n      } else {\n        utils.logError(`CMP unable to register callback function.  Please check CMP setup.`);\n        cmpSuccess(consentThis, undefined, finalCallback);\n        // TODO cmpError('CMP unable to register callback function.  Please check CMP setup.', hookConfig);\n      }\n    }\n\n    function handleV1CmpResponseCallbacks() {\n      const cmpResponse = {};\n\n      function afterEach() {\n        if (cmpResponse.getConsentData && cmpResponse.getVendorConsents) {\n          cmpSuccess(consentThis, cmpResponse, finalCallback);\n        }\n      }\n\n      return {\n        consentDataCallback: function (consentResponse) {\n          utils.logInfo(`cmpApi: consentDataCallback`);\n          cmpResponse.getConsentData = consentResponse;\n          afterEach();\n        },\n        vendorConsentsCallback: function (consentResponse) {\n          utils.logInfo(`cmpApi: vendorConsentsCallback`);\n          cmpResponse.getVendorConsents = consentResponse;\n          afterEach();\n        }\n      }\n    }\n\n    let v1CallbackHandler = handleV1CmpResponseCallbacks();\n    let {cmpVersion, cmpFrame, cmpFunction} = ConsentManagement.findCMP();\n    this.cmpVersion = cmpVersion;\n\n    if (!cmpFrame) {\n      // TODO implement cmpError\n      // return cmpError('CMP not found.', hookConfig);\n      utils.logError(`CMP not found`);\n      cmpSuccess(consentThis, undefined, finalCallback);\n      return;\n    }\n\n    if (utils.isFn(cmpFunction)) {\n      utils.logInfo(`cmpApi: calling getConsentData & getVendorConsents`);\n      if (cmpVersion === 1) {\n        cmpFunction('getConsentData', null, v1CallbackHandler.consentDataCallback);\n        cmpFunction('getVendorConsents', null, v1CallbackHandler.vendorConsentsCallback);\n      } else if (cmpVersion === 2) {\n        cmpFunction('addEventListener', cmpVersion, v2CmpResponseCallback);\n      }\n    } else {\n      cmpSuccess(consentThis, undefined, finalCallback);\n    }\n  }\n\n  /**\n   * Try to fetch consent from CMP\n   * @param {boolean} debugBypassConsent\n   * @param {string} cmpApi - CMP Api to use\n   * @param {object} [providedConsentData] - static consent data provided to ID5 API\n   * @param {function(object)} finalCallback required; final callback\n   */\n  requestConsent(debugBypassConsent, cmpApi, providedConsentData, finalCallback) {\n    if (debugBypassConsent) {\n      utils.logError('ID5 is operating in forced consent mode');\n      finalCallback(this.consentData);\n    } else if (!this.cmpCallMap[cmpApi]) {\n      utils.logError(`Unknown consent API: ${cmpApi}`);\n      this.resetConsentData();\n      finalCallback(this.consentData);\n    } else if (!this.consentData) {\n      if (cmpApi === 'static') {\n        if (utils.isPlainObject(providedConsentData)) {\n          this.staticConsentData = providedConsentData;\n        } else {\n          utils.logError(`cmpApi: 'static' did not specify consentData.`);\n        }\n      }\n      this.cmpCallMap[cmpApi].call(this, ConsentManagement.cmpSuccess, finalCallback);\n    } else {\n      finalCallback(this.consentData);\n    }\n  }\n\n  /**\n   * This function checks the consent data provided by CMP to ensure it's in an expected state.\n   * @param {ConsentManagement} consentThis\n   * @param {object} consentObject required; object returned by CMP that contains user's consent choices\n   * @param {function(object)} finalCallback required; final callback receiving the consent\n   */\n  static cmpSuccess(consentThis, consentObject, finalCallback) {\n    function checkV1Data(consentObject) {\n      let gdprApplies = consentObject && consentObject.getConsentData && consentObject.getConsentData.gdprApplies;\n      return !!(\n        (typeof gdprApplies !== 'boolean') ||\n        (gdprApplies === true &&\n          !(utils.isStr(consentObject.getConsentData.consentData) &&\n            utils.isPlainObject(consentObject.getVendorConsents) &&\n            Object.keys(consentObject.getVendorConsents).length > 1\n          )\n        )\n      );\n    }\n\n    function checkV2Data() {\n      let gdprApplies = consentObject && typeof consentObject.gdprApplies === 'boolean' ? consentObject.gdprApplies : undefined;\n      let tcString = consentObject && consentObject.tcString;\n      return !!(\n        (typeof gdprApplies !== 'boolean') ||\n        (gdprApplies === true && !utils.isStr(tcString))\n      );\n    }\n\n    // determine which set of checks to run based on cmpVersion\n    let checkFn = (consentThis.cmpVersion === 1) ? checkV1Data : (consentThis.cmpVersion === 2) ? checkV2Data : null;\n    utils.logInfo('CMP Success callback for version', consentThis.cmpVersion, checkFn);\n    if (utils.isFn(checkFn)) {\n      if (checkFn(consentObject)) {\n        consentThis.resetConsentData();\n        utils.logError(`CMP returned unexpected value during lookup process.`, consentObject);\n      } else {\n        consentThis.storeConsentData(consentObject);\n      }\n    } else {\n      // TODO: Log unhandled CMP version\n    }\n\n    finalCallback(consentThis.consentData);\n  }\n\n  /**\n   * Simply resets the module's consentData variable back to undefined, mainly for testing purposes\n   */\n  resetConsentData() {\n    this.consentData = undefined;\n    this.storedPrivacyData = undefined;\n  }\n\n  /**\n   * Stores CMP data locally in module\n   * @param {object} cmpConsentObject required; an object representing user's consent choices (can be undefined in certain use-cases for this function only)\n   */\n  storeConsentData(cmpConsentObject) {\n    if (this.cmpVersion === 1) {\n      this.consentData = {\n        consentString: (cmpConsentObject) ? cmpConsentObject.getConsentData.consentData : undefined,\n        vendorData: (cmpConsentObject) ? cmpConsentObject.getVendorConsents : undefined,\n        gdprApplies: (cmpConsentObject) ? cmpConsentObject.getConsentData.gdprApplies : undefined,\n        apiVersion: 1\n      };\n    } else if (this.cmpVersion === 2) {\n      this.consentData = {\n        consentString: (cmpConsentObject) ? cmpConsentObject.tcString : undefined,\n        vendorData: (cmpConsentObject) || undefined,\n        gdprApplies: cmpConsentObject && typeof cmpConsentObject.gdprApplies === 'boolean' ? cmpConsentObject.gdprApplies : undefined,\n        apiVersion: 2\n      };\n    } else {\n      this.consentData = {\n        apiVersion: 0\n      };\n    }\n  }\n\n  /**\n   * test if consent module is present, applies, and is valid for local storage or cookies (purpose 1)\n   * @param {boolean} allowLocalStorageWithoutConsentApi\n   * @param {boolean} debugBypassConsent\n   * @returns {boolean}\n   */\n  isLocalStorageAllowed(allowLocalStorageWithoutConsentApi, debugBypassConsent) {\n    if (allowLocalStorageWithoutConsentApi === true || debugBypassConsent === true) {\n      return true;\n    } else if (!this.consentData) {\n      // no cmp on page, so check if provisional access is allowed\n      return this.isProvisionalLocalStorageAllowed();\n    } else if (typeof this.consentData.gdprApplies === 'boolean' && this.consentData.gdprApplies) {\n      // gdpr applies\n      if (!this.consentData.consentString || this.consentData.apiVersion === 0) {\n        return false;\n      } else if (this.consentData.apiVersion === 1 && this.consentData.vendorData &&\n        this.consentData.vendorData.purposeConsents &&\n        this.consentData.vendorData.purposeConsents['1'] === false) {\n        return false;\n      } else if (this.consentData.apiVersion === 2 && this.consentData.vendorData &&\n        this.consentData.vendorData.purpose && this.consentData.vendorData.purpose.consents &&\n        this.consentData.vendorData.purpose.consents['1'] === false) {\n        return false;\n      } else {\n        return true;\n      }\n    } else {\n      // we have consent data and it tells us gdpr doesn't apply\n      return true;\n    }\n  }\n\n  /**\n   * if there is no CMP on page, consentData will be undefined, so we will check if we had stored\n   * privacy data from a previous request to determine if we are allowed to access local storage.\n   * if so, we use the previous authorization as a legal basis before calling our servers to confirm.\n   * if we do not have any stored privacy data, we will need to call our servers to know if we\n   * are in a jurisdiction that requires consent or not before accessing local storage.\n   *\n   * if there is no stored privacy data or jurisdiction wasn't set, will return undefined so the\n   * caller can decide what to do with in that case\n   *\n   * @return boolean|undefined\n   */\n  isProvisionalLocalStorageAllowed() {\n    if (!utils.isPlainObject(this.storedPrivacyData)) {\n      this.storedPrivacyData = JSON.parse(utils.getFromLocalStorage(CONSTANTS.STORAGE_CONFIG.PRIVACY));\n    }\n\n    if (this.storedPrivacyData && this.storedPrivacyData.id5_consent === true) {\n      return true;\n    } else if (!this.storedPrivacyData || typeof this.storedPrivacyData.jurisdiction === 'undefined') {\n      return undefined;\n    } else {\n      const jurisdictionRequiresConsent = (typeof CONSTANTS.PRIVACY.JURISDICTIONS[this.storedPrivacyData.jurisdiction] !== 'undefined') ? CONSTANTS.PRIVACY.JURISDICTIONS[this.storedPrivacyData.jurisdiction] : false;\n      return (jurisdictionRequiresConsent === false || this.storedPrivacyData.id5_consent === true);\n    }\n  }\n\n  setStoredPrivacy(privacy) {\n    try {\n      if (utils.isPlainObject(privacy)) {\n        this.storedPrivacyData = privacy;\n        utils.setInLocalStorage(CONSTANTS.STORAGE_CONFIG.PRIVACY, JSON.stringify(privacy));\n      } else {\n        utils.logInfo('Cannot store privacy if it is not an object: ', privacy);\n      }\n    } catch (e) {\n      utils.logError(e);\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/consentManagement.js","/*\n * Class containing the status of the API for a partner\n */\n\nimport Config from './config';\nimport * as abTesting from './abTesting';\nimport * as utils from './utils';\n\nexport default class Id5Status {\n  timerId;\n  /** @type boolean */\n  _callbackFired = false;\n  /** @type boolean */\n  _isExposed;\n  /** @type boolean */\n  _fromCache;\n  /** @type string */\n  _userId;\n  /** @type number */\n  _linkType;\n  /** @type Config */\n  config;\n\n  /** @param {Id5Options} options */\n  constructor(options) {\n    this.config = new Config(options);\n  }\n\n  /** @returns {Id5Options} options - Current options for this partner */\n  getOptions() {\n    return this.config.getOptions();\n  }\n\n  /** @param {Id5Options} options */\n  updOptions(options) {\n    return this.config.updOptions(options);\n  }\n\n  /**\n   * Set the user Id for this Id5Status\n   * @param {string} [userId]\n   * @param {number} [linkType]\n   * @param {boolean} [fromCache]\n   */\n  setUserId(userId, linkType, fromCache = false) {\n    if (userId) {\n      this._userId = userId;\n      this._linkType = linkType;\n      this._fromCache = fromCache;\n\n      // Evaluate if should be exposed\n      const options = this.config.getOptions();\n      if (options.abTesting.enabled === true) {\n        this._isExposed = !abTesting.isInControlGroup(userId, options.abTesting.controlGroupPct);\n      } else {\n        this._isExposed = true;\n      }\n\n      // Fire callback if not in control group\n      if (this._isExposed) {\n        this.fireCallBack();\n      }\n    } else {\n      this._userId = undefined;\n      this._linkType = undefined;\n      this._fromCache = undefined;\n      this._isExposed = undefined;\n    }\n  }\n\n  /**\n   * Return the current userId if available and not in control group\n   * @return {string} userId\n   */\n  getUserId() {\n    return this._isExposed === false ? '0' : this._userId;\n  }\n\n  /**\n   * Return the current linkType if available and not in control group\n   * @return {number} linkType\n   */\n  getLinkType() {\n    return this._isExposed === false ? 0 : this._linkType;\n  }\n\n  /**\n   * Return true if the userId provided is from cache\n   * @return {boolean}\n   */\n  isFromCache() {\n    return this._fromCache;\n  }\n\n  /**\n   * Return true if we should expose this user Id within AB Test\n   * @return {boolean}\n   */\n  exposeUserId() {\n    return this._isExposed;\n  }\n\n  /**\n   * This function cancel any pending watchdog callback\n   */\n  cancelCallback() {\n    if (this.timerId) {\n      clearTimeout(this.timerId);\n      this.timerId = undefined;\n    }\n    this._callbackFired = false;\n  }\n\n  /**\n   * This function schedule the watchdog of the callback if configured\n   */\n  scheduleWatchDog() {\n    if (this._callbackFired === true) {\n      utils.logInfo('scheduleWatchDog: Callback was already called, ignoring');\n    } else {\n      if (this.timerId) {\n        utils.logError('scheduleWatchDog: Watchdog timer already in progress, canceling and rescheduling');\n      }\n      this.cancelCallback();\n      const currentThis = this; // Preserve this within callback\n      if (utils.isFn(this.getOptions().callbackOnAvailable) && this.getOptions().callbackTimeoutInMs >= 0) {\n        this.timerId = setTimeout(() => Id5Status.doFireCallBack(currentThis), this.getOptions().callbackTimeoutInMs);\n      }\n    }\n  }\n\n  /**\n   * This function fire the callbacks of the current Id5Status\n   */\n  fireCallBack() {\n    if (this._callbackFired === true) {\n      utils.logInfo('fireCallBack: callbackOnAvailable was already called, ignoring');\n    } else {\n      this.cancelCallback();\n      const currentThis = this; // Preserve this within callbacks\n      if (utils.isFn(this.getOptions().callbackOnAvailable)) {\n        this.timerId = setTimeout(() => Id5Status.doFireCallBack(currentThis), 0);\n      }\n    }\n  }\n\n  /**\n   * This function fire the callback of the passed Id5Status\n   * @param {Id5Status} currentId5Status\n   */\n  static doFireCallBack(currentId5Status) {\n    const callbackOnAvailable = currentId5Status.getOptions().callbackOnAvailable;\n    currentId5Status.timerId = undefined;\n    if (!currentId5Status._callbackFired && utils.isFn(callbackOnAvailable)) {\n      utils.logInfo('Calling callbackOnAvailable');\n      currentId5Status._callbackFired = true;\n      callbackOnAvailable(currentId5Status);\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/id5Status.js","/*\n * Module for getting and setting ID5 API configuration.\n */\n\nconst utils = require('./utils');\n\n/**\n * @typedef {Object} Id5Options\n * @property {number} [partnerId] - ID5 Publisher ID, mandatory\n * @property {boolean|false} [debug] - enable verbose debug mode (defaulting to id5_debug query string param if present, or false)\n * @property {boolean|false} [debugBypassConsent] - Bypass consent API et local storage consent for testing purpose only\n * @property {boolean|false} [allowLocalStorageWithoutConsentApi] - Tell ID5 that consent has been given to read local storage\n * => and allowLocalStorageWithoutConsent (if enabled, then for everyone in the page), platform should not set\n * @property {number} [refreshInSeconds] - Refresh period of first-party cookie (defaulting to 7200s)\n * => Keep the lowest until now, platform should not set\n * @property {string} [partnerUserId] - User ID for the platform deploying the API, to be stored by ID5 for further cookie matching if provided\n * @property {string} [cmpApi] - API to use CMP. As of today, either 'iab' or 'static'\n * => use cached consentData, supposed to be one per page\n * @property {object} [consentData] - Consent data if cmpApi is 'static'\n * @property {function} [callbackOnAvailable] - Function to call back when User ID is available. if callbackTimeoutInMs is not provided, will be fired only if a User ID is available.\n * @property {function} [callbackOnUpdates] - Function to call back on further updates of User ID by changes in the page (consent, pd, refresh). Cannot be provided if `callbackOnAvailable` is not provided\n * @property {number} [callbackTimeoutInMs] - Delay in ms after which the callbackOnAvailable is guaranteed to be fired. A User ID may not yet be available at this time.\n * @property {string} [pd] - Publisher data that can be passed to help with cross-domain reconciliation of the ID5 ID, more details here: https://wiki.id5.io/x/BIAZ\n * @property {array} [tpids] - An array of third party IDs that can be passed to usersync with ID5. Contact your ID5 representative to enable this\n * @property {AbTestConfig} [abTesting] - An object defining if and how A/B testing should be enabled\n * => per partner\n *\n * => multiple instance with same partner and different PD ?\n */\n\n/**\n * @typedef {Object} AbTestConfig\n * @property {boolean|false} [enabled] - Enable control group\n * @property {number} [controlGroupPct] - Ratio of users in control group [0,1]\n */\n\nexport default class Config {\n  /** @type {Id5Options} */\n  options;\n\n  /** @type {Id5Options} */\n  providedOptions;\n\n  static configTypes = {\n    debug: 'Boolean',\n    debugBypassConsent: 'Boolean',\n    allowLocalStorageWithoutConsentApi: 'Boolean',\n    cmpApi: 'String',\n    consentData: 'Object',\n    refreshInSeconds: 'Number',\n    partnerId: 'Number',\n    partnerUserId: 'String',\n    callbackOnAvailable: 'Function',\n    callbackOnUpdates: 'Function',\n    callbackTimeoutInMs: 'Number',\n    pd: 'String',\n    tpids: 'Array',\n    abTesting: 'Object'\n  };\n\n  /**\n   * Create configuration instance from an object containing key-value pairs\n   * @param {Id5Options} options\n   */\n  constructor(options) {\n    this.options = {\n      debug: utils.getParameterByName('id5_debug').toUpperCase() === 'TRUE',\n      debugBypassConsent: false,\n      allowLocalStorageWithoutConsentApi: false,\n      cmpApi: 'iab',\n      consentData: {\n        getConsentData: {\n          consentData: undefined,\n          gdprApplies: undefined\n        },\n        getVendorConsents: {}\n      },\n      refreshInSeconds: 7200,\n      partnerId: undefined,\n      partnerUserId: undefined,\n      callbackOnAvailable: undefined,\n      callbackOnUpdates: undefined,\n      callbackTimeoutInMs: undefined,\n      pd: '',\n      tpids: undefined,\n      abTesting: {\n        enabled: false,\n        controlGroupPct: 0\n      }\n    };\n    this.providedOptions = {};\n\n    if (!options.partnerId || typeof options.partnerId !== 'number') {\n      throw new Error('partnerId is required and must be a number');\n    }\n\n    this.updOptions(options);\n  }\n\n  /**\n   * Return current configuration\n   * @returns {Id5Options} options\n   */\n  getOptions() {\n    return this.options;\n  }\n\n  /**\n   * Return configuration set by user\n   * @returns {Id5Options} options\n   */\n  getProvidedOptions() {\n    return this.providedOptions;\n  }\n\n  /**\n   * Override the configuration with an object containing key-value pairs\n   * @param {Id5Options} options\n   */\n  updOptions(options) {\n    if (typeof options !== 'object') {\n      utils.logError('Config options must be an object');\n    }\n\n    if (typeof this.options.partnerId === 'number' &&\n      typeof options.partnerId === 'number' &&\n      options.partnerId !== this.options.partnerId) {\n      throw new Error('Cannot update config with a different partentId');\n    }\n\n    Object.keys(options).forEach(topic => {\n      if (utils.isA(options[topic], Config.configTypes[topic])) {\n        this.options[topic] = options[topic];\n        this.providedOptions[topic] = options[topic];\n      } else {\n        utils.logError(`setConfig options ${topic} must be of type ${Config.configTypes[topic]} but was ${toString.call(options[topic])}`);\n      }\n    });\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/config.js","/*\n * Module for managing A/B Testing\n */\n\nimport { isNumber, cyrb53Hash } from './utils';\n\nconst ABTEST_RESOLUTION = 10000;\n\n/**\n * Return a consistant random number between 0 and ABTEST_RESOLUTION-1 for this user\n * Falls back to plain random if no user provided\n * @param {string} [userId]\n * @returns {number}\n */\nfunction abTestBucket(userId) {\n  if (userId) {\n    return ((cyrb53Hash(userId) % ABTEST_RESOLUTION) + ABTEST_RESOLUTION) % ABTEST_RESOLUTION;\n  } else {\n    return Math.floor(Math.random() * ABTEST_RESOLUTION);\n  }\n}\n\n/**\n * Return a consistant boolean if this user is within the control group ratio provided\n * @param {string} [userId]\n * @param {number} controlGroupRatio - Ratio [0,1] of users expected to be in the control group\n * @returns {boolean}\n */\nexport function isInControlGroup(userId, controlGroupRatio) {\n  if (!isNumber(controlGroupRatio) || controlGroupRatio < 0 || controlGroupRatio > 1) {\n    throw new Error('A/B Testing controlGroupRatio must be a number >= 0 and <= 1');\n  }\n  return abTestBucket(userId) < controlGroupRatio * ABTEST_RESOLUTION;\n}\n\nexport default isInControlGroup;\n\n\n\n// WEBPACK FOOTER //\n// ./src/abTesting.js"],"sourceRoot":""}