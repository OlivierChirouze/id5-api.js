{"version":3,"sources":["webpack:///webpack/bootstrap 8516ca84ab8f39842dc0","webpack:///./src/config.js","webpack:///./src/utils.js","webpack:///./src/id5-api.js","webpack:///./src/id5-apiGlobal.js","webpack:///./src/consentManagement.js","webpack:///./src/refererDetection.js"],"names":["utils","require","newConfig","config","configTypes","debug","allowID5WithoutConsentApi","cmpApi","consentData","cookieName","refreshInSeconds","cookieExpirationInSeconds","partnerId","partnerUserId","callback","callbackTimeoutInMs","pd","resetConfig","getParameterByName","toUpperCase","getConsentData","undefined","gdprApplies","getVendorConsents","getConfig","setConfig","options","logError","Object","keys","forEach","topic","isA","toString","call","tArr","tStr","tFn","tNumb","tObject","tBoolean","prototype","consoleExists","Boolean","window","console","consoleLogExists","log","consoleInfoExists","info","consoleWarnExists","warn","consoleErrorExists","error","uniqueRef","bind","a","b","Function","self","args","Array","slice","arguments","apply","concat","replaceTokenInString","str","map","token","_each","value","key","keyString","re","RegExp","replace","logMessage","debugTurnedOn","decorateLog","logInfo","logWarn","prefix","unshift","name","regexS","regex","results","exec","location","search","decodeURIComponent","object","_t","isFn","isStr","isArray","isNumber","isPlainObject","isBoolean","isEmpty","length","k","hasOwnProperty","fn","l","_map","output","push","isSafariBrowser","test","navigator","userAgent","checkCookieSupport","cookieEnabled","document","cookie","cookiesAreEnabled","indexOf","getCookie","m","match","setCookie","expires","encodeURIComponent","parseQS","query","split","reduce","acc","criteria","v","formatQS","join","parse","url","parsed","createElement","noDecodeWholeURL","href","qsAsString","decodeSearchAsString","protocol","hostname","port","pathname","hash","host","format","obj","XHR_DONE","ajax","data","x","method","parser","callbacks","success","e","XMLHttpRequest","onreadystatechange","readyState","status","responseText","statusText","ontimeout","timeout","urlInfo","open","withCredentials","customHeaders","header","setRequestHeader","preflight","contentType","send","fireAsyncPixel","syncUrl","Image","src","deferPixelFire","addEventListener","ID5","getGlobal","loaded","initialized","callbackFired","init","version","Error","cfg","userConfig","referer","getRefererInfo","storedResponse","JSON","storedDateTime","Date","lastCookieName","getTime","refreshNeeded","now","expiresStr","toUTCString","nb","getNbFromCookie","idSetFromStoredResponse","setTimeout","fireCallBack","expired","ID5ID","userId","universal_uid","linkType","link_type","incrementNb","consent","signature","gdprConsentString","consentString","pubId","stack","reachedTop","response","responseObj","nbCookieName","cascade_needed","isSync","stringify","cachedNb","parseInt","staticConsentData","cmpVersion","cmpCallMap","lookupIabConsent","lookupStaticConsentData","cmpSuccess","finalCallback","findCMP","f","cmpFrame","cmpFunction","__tcfapi","__cmp","frames","top","parent","v2CmpResponseCallback","tcfData","eventStatus","handleV1CmpResponseCallbacks","cmpResponse","afterEach","consentDataCallback","consentResponse","vendorConsentsCallback","v1CallbackHandler","requestConsent","resetConsentData","consentObject","checkV1Data","checkV2Data","tcString","getTCData","checkFn","storeConsentData","cmpConsentObject","vendorData","apiVersion","isLocalStorageAllowed","purposeConsents","purpose","consents","detectReferer","win","getLevels","levels","walkUpWindows","ancestors","getAncestorOrigins","i","ancestor","ancestorOrigins","getPubUrlStack","defUrl","frameLocation","prevFrame","prevRef","detectedRefererUrl","referrer","getCanonicalUrl","doc","element","querySelector","currentWindow","isTop","refData","canonicalUrl","refererInfo","numIframes","stackInfo"],"mappings":"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","file":"id5-api.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 2);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 8516ca84ab8f39842dc0","/*\n * Module for getting and setting ID5 API configuration.\n */\n\nconst utils = require('./utils');\n\n/**\n * @typedef {Object} Id5Config\n * @property {boolean|false} debug - enable verbose debug mode (defaulting to id5_debug query string param if present, or false)\n * @property {boolean|false} allowID5WithoutConsentApi - Allow ID5 to fetch user id even if no consent API\n * @property {(string|undefined)} cookieName - ID5 1st party cookie name (defaulting to id5.1st)\n * @property {(number|undefined)} refreshInSeconds - Refresh period of first-party cookie (defaulting to 7200s)\n * @property {(number|undefined)} cookieExpirationInSeconds - Expiration of 1st party cookie (defaulting to 90 days)\n * @property {(number)} partnerId - ID5 Publisher ID, mandatory\n * @property {(string|undefined)} partnerUserId - User ID for the publisher, to be stored by ID5 for further matching if provided\n * @property {(string|undefined)} cmpApi - API to use CMP. As of today, either 'iab' or 'static'\n * @property {(object|undefined)} consentData - Consent data if cmpApi is 'static'\n * @property {(function|undefined)} callback - Function to call back when User ID is available. if callbackTimeoutInMs is not provided, will be fired only if a User ID is available.\n * @property {(number|undefined)} callbackTimeoutInMs - Delay in ms after which the callback is guaranteed to be fired. A User ID may not yet be available at this time.\n */\n\nexport function newConfig() {\n  /**\n   * @property {Id5Config}\n   */\n  let config;\n\n  const configTypes = {\n    debug: 'Boolean',\n    allowID5WithoutConsentApi: 'Boolean',\n    cmpApi: 'String',\n    consentData: 'Object',\n    cookieName: 'String',\n    refreshInSeconds: 'Number',\n    cookieExpirationInSeconds: 'Number',\n    partnerId: 'Number',\n    partnerUserId: 'String',\n    callback: 'Function',\n    callbackTimeoutInMs: 'Number',\n    pd: 'String'\n  };\n\n  function resetConfig() {\n    config = {\n      debug: utils.getParameterByName('id5_debug').toUpperCase() === 'TRUE',\n      allowID5WithoutConsentApi: false,\n      cmpApi: 'iab',\n      consentData: {\n        getConsentData: {\n          consentData: undefined,\n          gdprApplies: undefined\n        },\n        getVendorConsents: {}\n      },\n      cookieName: 'id5id.1st',\n      refreshInSeconds: 7200,\n      cookieExpirationInSeconds: 90 * 24 * 60 * 60,\n      partnerId: undefined,\n      partnerUserId: undefined,\n      callback: undefined,\n      callbackTimeoutInMs: undefined,\n      pd: ''\n    };\n  }\n\n  /**\n   * Return current configuration\n   * @returns {Id5Config} options\n   */\n  function getConfig() {\n    return config;\n  }\n\n  /**\n   * Sets configuration given an object containing key-value pairs\n   * @param {Id5Config} options\n   * @returns {Id5Config} options\n   */\n  function setConfig(options) {\n    if (typeof options !== 'object') {\n      utils.logError('setConfig options must be an object');\n      return undefined;\n    }\n\n    Object.keys(options).forEach(topic => {\n      if (utils.isA(options[topic], configTypes[topic])) {\n        config[topic] = options[topic];\n      } else {\n        utils.logError(`setConfig options ${topic} must be of type ${configTypes[topic]} but was ${toString.call(options[topic])}`);\n      }\n    });\n    return config\n  }\n\n  resetConfig();\n\n  return {\n    getConfig,\n    setConfig,\n    resetConfig\n  };\n}\n\nexport const config = newConfig();\n\n\n\n// WEBPACK FOOTER //\n// ./src/config.js","\nimport { config } from './config';\n\nconst tArr = 'Array';\nconst tStr = 'String';\nconst tFn = 'Function';\nconst tNumb = 'Number';\nconst tObject = 'Object';\nconst tBoolean = 'Boolean';\nconst toString = Object.prototype.toString;\nlet consoleExists = Boolean(window.console);\nlet consoleLogExists = Boolean(consoleExists && window.console.log);\nlet consoleInfoExists = Boolean(consoleExists && window.console.info);\nlet consoleWarnExists = Boolean(consoleExists && window.console.warn);\nlet consoleErrorExists = Boolean(consoleExists && window.console.error);\n\nvar uniqueRef = {};\nexport let bind = function(a, b) { return b; }.bind(null, 1, uniqueRef)() === uniqueRef\n  ? Function.prototype.bind\n  : function(bind) {\n    var self = this;\n    var args = Array.prototype.slice.call(arguments, 1);\n    return function() {\n      return self.apply(bind, args.concat(Array.prototype.slice.call(arguments)));\n    };\n  };\n\n/*\n *   Substitutes into a string from a given map using the token\n *   Usage\n *   var str = 'text %%REPLACE%% this text with %%SOMETHING%%';\n *   var map = {};\n *   map['replace'] = 'it was subbed';\n *   map['something'] = 'something else';\n *   console.log(replaceTokenInString(str, map, '%%')); => \"text it was subbed this text with something else\"\n */\nexport function replaceTokenInString(str, map, token) {\n  _each(map, function (value, key) {\n    value = (value === undefined) ? '' : value;\n\n    var keyString = token + key.toUpperCase() + token;\n    var re = new RegExp(keyString, 'g');\n\n    str = str.replace(re, value);\n  });\n\n  return str;\n}\n\n/**\n * Wrappers to console.(log | info | warn | error). Takes N arguments, the same as the native methods\n */\nexport function logMessage() {\n  if (debugTurnedOn() && consoleLogExists) {\n    console.log.apply(console, decorateLog(arguments, 'MESSAGE:'));\n  }\n}\n\nexport function logInfo() {\n  if (debugTurnedOn() && consoleInfoExists) {\n    console.info.apply(console, decorateLog(arguments, 'INFO:'));\n  }\n}\n\nexport function logWarn() {\n  if (debugTurnedOn() && consoleWarnExists) {\n    console.warn.apply(console, decorateLog(arguments, 'WARNING:'));\n  }\n}\n\nexport function logError() {\n  if (debugTurnedOn() && consoleErrorExists) {\n    console.error.apply(console, decorateLog(arguments, 'ERROR:'));\n  }\n}\n\nfunction decorateLog(args, prefix) {\n  args = [].slice.call(args);\n  prefix && args.unshift(prefix);\n  args.unshift('display: inline-block; color: #fff; background: #1c307e; padding: 1px 4px; border-radius: 3px;');\n  args.unshift('%cID5');\n  return args;\n}\n\nexport function debugTurnedOn() {\n  return config.getConfig().debug;\n}\n\n/*\n *   Check if a given parameter name exists in query string\n *   and if it does return the value\n */\nexport function getParameterByName(name) {\n  var regexS = '[\\\\?&]' + name + '=([^&#]*)';\n  var regex = new RegExp(regexS);\n  var results = regex.exec(window.location.search);\n  if (results === null) {\n    return '';\n  }\n\n  return decodeURIComponent(results[1].replace(/\\+/g, ' '));\n}\n\n/**\n * Return if the object is of the\n * given type.\n * @param {*} object to test\n * @param {String} _t type string (e.g., Array)\n * @return {Boolean} if object is of type _t\n */\nexport function isA(object, _t) {\n  return toString.call(object) === '[object ' + _t + ']';\n}\n\nexport function isFn(object) {\n  return isA(object, tFn);\n}\n\nexport function isStr(object) {\n  return isA(object, tStr);\n}\n\nexport function isArray(object) {\n  return isA(object, tArr);\n}\n\nexport function isNumber(object) {\n  return isA(object, tNumb);\n}\n\nexport function isPlainObject(object) {\n  return isA(object, tObject);\n}\n\nexport function isBoolean(object) {\n  return isA(object, tBoolean);\n}\n\n/**\n * Return if the object is \"empty\";\n * this includes falsey, no keys, or no items at indices\n * @param {*} object object to test\n * @return {Boolean} if object is empty\n */\nexport function isEmpty(object) {\n  if (!object) return true;\n  if (isArray(object) || isStr(object)) {\n    return !(object.length > 0);\n  }\n\n  for (var k in object) {\n    if (hasOwnProperty.call(object, k)) return false;\n  }\n\n  return true;\n}\n\n/**\n * Iterate object with the function\n * falls back to es5 `forEach`\n * @param {Array|Object} object\n * @param {Function(value, key, object)} fn\n */\nexport function _each(object, fn) {\n  if (isEmpty(object)) return;\n  if (isFn(object.forEach)) return object.forEach(fn, this);\n\n  var k = 0;\n  var l = object.length;\n\n  if (l > 0) {\n    for (; k < l; k++) fn(object[k], k, object);\n  } else {\n    for (k in object) {\n      if (hasOwnProperty.call(object, k)) fn.call(this, object[k], k);\n    }\n  }\n}\n\n/**\n * Map an array or object into another array\n * given a function\n * @param {Array|Object} object\n * @param {Function(value, key, object)} callback\n * @return {Array}\n */\nexport function _map(object, callback) {\n  if (isEmpty(object)) return [];\n  if (isFn(object.map)) return object.map(callback);\n  var output = [];\n  _each(object, function (value, key) {\n    output.push(callback(value, key, object));\n  });\n\n  return output;\n}\n\nexport function isSafariBrowser() {\n  return /^((?!chrome|android).)*safari/i.test(navigator.userAgent);\n}\n\nexport function checkCookieSupport() {\n  if (window.navigator.cookieEnabled || !!document.cookie.length) {\n    return true;\n  }\n}\nexport function cookiesAreEnabled() {\n  window.document.cookie = 'id5.cookieTest';\n  return window.document.cookie.indexOf('id5.cookieTest') !== -1;\n}\n\nexport function getCookie(name) {\n  let m = window.document.cookie.match('(^|;)\\\\s*' + name + '\\\\s*=\\\\s*([^;]*)\\\\s*(;|$)');\n  return m ? decodeURIComponent(m[2]) : null;\n}\n\nexport function setCookie(key, value, expires) {\n  document.cookie = `${key}=${encodeURIComponent(value)}${(expires !== '') ? `; expires=${expires}` : ''}; path=/`;\n}\n\nexport function parseQS(query) {\n  return !query ? {} : query\n    .replace(/^\\?/, '')\n    .split('&')\n    .reduce((acc, criteria) => {\n      let [k, v] = criteria.split('=');\n      if (/\\[\\]$/.test(k)) {\n        k = k.replace('[]', '');\n        acc[k] = acc[k] || [];\n        acc[k].push(v);\n      } else {\n        acc[k] = v || '';\n      }\n      return acc;\n    }, {});\n}\n\nexport function formatQS(query) {\n  return Object\n    .keys(query)\n    .map(k => Array.isArray(query[k])\n      ? query[k].map(v => `${k}[]=${v}`).join('&')\n      : `${k}=${query[k]}`)\n    .join('&');\n}\n\nexport function parse(url, options) {\n  let parsed = document.createElement('a');\n  if (options && 'noDecodeWholeURL' in options && options.noDecodeWholeURL) {\n    parsed.href = url;\n  } else {\n    parsed.href = decodeURIComponent(url);\n  }\n  // in window.location 'search' is string, not object\n  let qsAsString = (options && 'decodeSearchAsString' in options && options.decodeSearchAsString);\n  return {\n    href: parsed.href,\n    protocol: (parsed.protocol || '').replace(/:$/, ''),\n    hostname: parsed.hostname,\n    port: +parsed.port,\n    pathname: parsed.pathname.replace(/^(?!\\/)/, '/'),\n    search: (qsAsString) ? parsed.search : parseQS(parsed.search || ''),\n    hash: (parsed.hash || '').replace(/^#/, ''),\n    host: parsed.host || window.location.host\n  };\n}\n\nexport function format(obj) {\n  return (obj.protocol || 'http') + '://' +\n    (obj.host ||\n        obj.hostname + (obj.port ? `:${obj.port}` : '')) +\n    (obj.pathname || '') +\n    (obj.search ? `?${formatQS(obj.search || '')}` : '') +\n    (obj.hash ? `#${obj.hash}` : '');\n}\n\nconst XHR_DONE = 4;\n\n/**\n * Simple IE9+ and cross-browser ajax request function\n * Note: x-domain requests in IE9 do not support the use of cookies\n *\n * @param url string url\n * @param callback {object | function} callback\n * @param data mixed data\n * @param options object\n */\n\nexport function ajax(url, callback, data, options = {}) {\n  try {\n    let x;\n    let method = options.method || (data ? 'POST' : 'GET');\n    let parser = document.createElement('a');\n    parser.href = url;\n\n    let callbacks = typeof callback === 'object' && callback !== null ? callback : {\n      success: function() {\n        logMessage('xhr success');\n      },\n      error: function(e) {\n        logError('xhr error', null, e);\n      }\n    };\n\n    if (typeof callback === 'function') {\n      callbacks.success = callback;\n    }\n\n    x = new window.XMLHttpRequest();\n\n    x.onreadystatechange = function () {\n      if (x.readyState === XHR_DONE) {\n        let status = x.status;\n        if ((status >= 200 && status < 300) || status === 304) {\n          callbacks.success(x.responseText, x);\n        } else {\n          callbacks.error(x.statusText, x);\n        }\n      }\n    };\n\n    x.ontimeout = function () {\n      logError('  xhr timeout after ', x.timeout, 'ms');\n    };\n\n    if (method === 'GET' && data) {\n      let urlInfo = parse(url, options);\n      Object.assign(urlInfo.search, data);\n      url = format(urlInfo);\n    }\n\n    x.open(method, url, true);\n\n    if (options.withCredentials) {\n      x.withCredentials = true;\n    }\n    _each(options.customHeaders, (value, header) => {\n      x.setRequestHeader(header, value);\n    });\n    if (options.preflight) {\n      x.setRequestHeader('X-Requested-With', 'XMLHttpRequest');\n    }\n    x.setRequestHeader('Content-Type', options.contentType || 'text/plain');\n\n    if (method === 'POST' && data) {\n      x.send(data);\n    } else {\n      x.send();\n    }\n  } catch (error) {\n    logError('xhr construction', error);\n  }\n}\n\n/**\n * add an Image pixel to the DOM for the given sync Url\n *\n * @param syncUrl\n */\nexport function fireAsyncPixel(syncUrl, callback) {\n  (new Image()).src = syncUrl;\n  if (isFn(callback)) {\n    callback();\n  }\n};\n\n/**\n * wait until the page finishes loading and then fire a pixel\n *\n * @param syncUrl\n */\nexport function deferPixelFire(syncUrl, callback) {\n  if (document.readyState !== 'loading') {\n    fireAsyncPixel(syncUrl, callback);\n  } else {\n    document.addEventListener('DOMContentLoaded', function () {\n      fireAsyncPixel(syncUrl, callback);\n    });\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/utils.js","/** @module id5-api */\n\nimport { getGlobal } from './id5-apiGlobal';\nimport { config } from './config';\nimport * as utils from './utils';\nimport * as consent from './consentManagement';\nimport { getRefererInfo } from './refererDetection';\n\nexport const ID5 = getGlobal();\n\nID5.loaded = true;\nID5.initialized = false;\nID5.callbackFired = false;\n\n/**\n * This function will initialize ID5, wait for consent then try to fetch or refresh ID5 user id if required\n * @param {Id5Config} options\n * @alias module:ID5.init\n */\n// TODO: Use Async init by pushing setting in a queue\nID5.init = function (options) {\n  if (typeof ID5.version === 'undefined') {\n    throw new Error('ID5.version variable is missing! Make sure you build from source with \"gulp build\" from this project. Contact support@id5.io for help.');\n  }\n\n  try {\n    utils.logInfo('Invoking ID5.init', arguments);\n    const cfg = config.setConfig(options);\n    ID5.userConfig = options;\n    ID5.config = cfg;\n    ID5.initialized = true;\n    ID5.callbackFired = false;\n    ID5.getConfig = config.getConfig;\n    const referer = getRefererInfo();\n    utils.logInfo(`ID5 detected referer is ${referer.referer}`);\n\n    if (typeof cfg.partnerId !== 'number') {\n      throw new Error('partnerId is required and must be a number');\n    }\n\n    const storedResponse = JSON.parse(utils.getCookie(cfg.cookieName));\n    const storedDateTime = (new Date(+utils.getCookie(lastCookieName(cfg)))).getTime();\n    const refreshNeeded = storedDateTime <= 0 || ((Date.now() - storedDateTime) > (cfg.refreshInSeconds * 1000));\n    const expiresStr = (new Date(Date.now() + (cfg.cookieExpirationInSeconds * 1000))).toUTCString();\n    let nb = getNbFromCookie(cfg);\n    let idSetFromStoredResponse = false;\n\n    // Callback watchdogs\n    if (utils.isFn(this.config.callback) && this.config.callbackTimeoutInMs >= 0) {\n      setTimeout(() => this.fireCallBack(), this.config.callbackTimeoutInMs);\n    }\n\n    // TEMPORARY until all clients have upgraded past v0.9.3\n    // remove cookies that were previously set with the old cookie name\n    if (cfg.cookieName !== 'id5.1st') {\n      const expired = (new Date(Date.now() - 1000)).toUTCString();\n      utils.setCookie('id5.1st', '', expired);\n      utils.setCookie('id5.1st_last', '', expired);\n      utils.setCookie('id5.1st_nb', '', expired);\n    }\n\n    if (storedResponse) {\n      // this is needed to avoid losing the ID5ID from publishers that was\n      // previously stored. Eventually we can remove this, once pubs have all\n      // upgraded to this version of code\n      if (storedResponse.ID5ID) { // TODO: remove this block when 1puid isn't needed\n        ID5.userId = storedResponse.ID5ID;\n      } else if (storedResponse.universal_uid) {\n        ID5.userId = storedResponse.universal_uid;\n        ID5.linkType = storedResponse.link_type || 0;\n      }\n      nb = incrementNb(cfg, expiresStr, nb);\n      idSetFromStoredResponse = true;\n      if (ID5.userId) {\n        this.fireCallBack();\n      }\n      utils.logInfo('ID5 User ID available from cache:', { storedResponse, storedDateTime, refreshNeeded });\n    } else {\n      utils.logInfo('No ID5 User ID available from cache');\n    }\n\n    consent.requestConsent((consentData) => {\n      if (consent.isLocalStorageAllowed()) {\n        utils.logInfo('Consent to access local storage and cookies is given');\n\n        if (!storedResponse || !storedResponse.universal_uid || !storedResponse.signature || refreshNeeded) {\n          const gdprApplies = (consentData && consentData.gdprApplies) ? 1 : 0;\n          const gdprConsentString = (consentData && consentData.gdprApplies) ? consentData.consentString : '';\n          const url = `https://id5-sync.com/g/v2/${cfg.partnerId}.json?gdpr_consent=${gdprConsentString}&gdpr=${gdprApplies}`;\n          const signature = (storedResponse && storedResponse.signature) ? storedResponse.signature : '';\n          const pubId = (storedResponse && storedResponse.ID5ID) ? storedResponse.ID5ID : ''; // TODO: remove when 1puid isn't needed\n          const data = {\n            'partner': cfg.partnerId,\n            '1puid': pubId, // TODO: remove when 1puid isn't needed\n            'v': ID5.version,\n            'o': 'api',\n            'rf': referer.referer,\n            'u': referer.stack[0] || window.location.href,\n            'top': referer.reachedTop ? 1 : 0,\n            's': signature,\n            'pd': cfg.pd || '',\n            'nbPage': nb\n          };\n\n          utils.logInfo('Fetching ID5 user ID from:', url, data);\n          utils.ajax(url, {\n            success: response => {\n              utils.logInfo('Response from ID5 received:', response);\n              let responseObj;\n              if (response) {\n                try {\n                  responseObj = JSON.parse(response);\n                  if (responseObj.universal_uid) {\n                    ID5.userId = responseObj.universal_uid;\n                    utils.setCookie(cfg.cookieName, response, expiresStr);\n                    utils.setCookie(lastCookieName(cfg), Date.now(), expiresStr);\n                    utils.setCookie(nbCookieName(cfg), (idSetFromStoredResponse ? 0 : 1), expiresStr);\n                    if (responseObj.cascade_needed === true) {\n                      const isSync = cfg.partnerUserId && cfg.partnerUserId.length > 0;\n                      const syncUrl = `https://id5-sync.com/${isSync ? 's' : 'i'}/${cfg.partnerId}/8.gif?${isSync ? 'puid=' + cfg.partnerUserId + '&' : ''}gdpr_consent=${gdprConsentString}&gdpr=${gdprApplies}`;\n                      utils.logInfo('Opportunities to cascade available:', syncUrl);\n                      utils.deferPixelFire(syncUrl);\n                    }\n                    this.fireCallBack();\n                    // TODO: Server should use 1puid to override uid if not in 3rd party cookie\n                  } else {\n                    utils.logError('Invalid response from ID5 servers:', response);\n                  }\n                } catch (error) {\n                  utils.logError(error);\n                }\n              }\n            },\n            error: error => {\n              utils.logError(error);\n            }\n          }, JSON.stringify(data), { method: 'POST', withCredentials: true });\n        }\n      } else {\n        utils.logInfo('No legal basis to use ID5', consentData);\n      }\n    });\n  } catch (e) {\n    utils.logError('Exception catch', e);\n  }\n};\n\nID5.fireCallBack = function () {\n  if (!this.callbackFired && utils.isFn(this.config.callback)) {\n    this.callbackFired = true;\n    utils.logInfo('Scheduling callback');\n    setTimeout(() => this.config.callback(ID5), 0);\n  }\n}\n\nfunction lastCookieName(cfg) {\n  return `${cfg.cookieName}_last`;\n}\nfunction nbCookieName(cfg) {\n  return `${cfg.cookieName}_${cfg.partnerId}_nb`;\n}\nfunction getNbFromCookie(cfg) {\n  const cachedNb = utils.getCookie(nbCookieName(cfg));\n  return (cachedNb) ? parseInt(cachedNb) : 0;\n}\nfunction incrementNb(cfg, expiresStr, nb) {\n  nb++;\n  utils.setCookie(nbCookieName(cfg), nb, expiresStr);\n  return nb;\n}\n\nexport default ID5;\n\n\n\n// WEBPACK FOOTER //\n// ./src/id5-api.js","window.ID5 = (window.ID5 || {});\n\nexport function getGlobal() {\n  return window.ID5;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/id5-apiGlobal.js","import * as utils from './utils';\nimport {config} from './config';\n\nexport let consentData;\nexport let staticConsentData;\n\nlet cmpVersion = 0;\n\nconst cmpCallMap = {\n  'iab': lookupIabConsent,\n  'static': lookupStaticConsentData\n};\n\n/**\n * This function reads the consent string from the config to obtain the consent information of the user.\n * @param {function(string, function(object))} cmpSuccess acts as a success callback when the value is read from config; pass along consentObject (string) from CMP\n * @param {function(object)} finalCallback acts as an error callback while interacting with the config string; pass along an error message (string)\n */\nfunction lookupStaticConsentData(cmpSuccess, finalCallback) {\n  cmpSuccess(staticConsentData, finalCallback);\n}\n\n/**\n * This function handles async interacting with an IAB compliant CMP to obtain the consent information of the user.\n * @param {function(string, function(object))} cmpSuccess acts as a success callback when CMP returns a value; pass along consentObject (string) from CMP\n * @param {function(object)} finalCallback required;\n */\nfunction lookupIabConsent(cmpSuccess, finalCallback) {\n  function findCMP() {\n    cmpVersion = 0;\n    let f = window;\n    let cmpFrame;\n    let cmpFunction;\n    while (!cmpFrame) {\n      try {\n        if (typeof f.__tcfapi === 'function' || typeof f.__cmp === 'function') {\n          if (typeof f.__tcfapi === 'function') {\n            cmpVersion = 2;\n            cmpFunction = f.__tcfapi;\n          } else {\n            cmpVersion = 1;\n            cmpFunction = f.__cmp;\n          }\n          cmpFrame = f;\n          break;\n        }\n      } catch (e) { }\n\n      // need separate try/catch blocks due to the exception errors thrown when trying to check for a frame that doesn't exist in 3rd party env\n      try {\n        if (f.frames['__tcfapiLocator']) {\n          cmpVersion = 2;\n          cmpFrame = f;\n          break;\n        }\n      } catch (e) { }\n\n      try {\n        if (f.frames['__cmpLocator']) {\n          cmpVersion = 1;\n          cmpFrame = f;\n          break;\n        }\n      } catch (e) { }\n\n      if (f === window.top) break;\n      f = f.parent;\n    }\n    return {\n      cmpFrame,\n      cmpFunction\n    };\n  }\n\n  function v2CmpResponseCallback(tcfData, success) {\n    utils.logInfo('Received a response from CMP', tcfData);\n    if (success) {\n      if (tcfData.gdprApplies === false || tcfData.eventStatus === 'tcloaded' || tcfData.eventStatus === 'useractioncomplete') {\n        cmpSuccess(tcfData, finalCallback);\n      }\n    } else {\n      utils.logError(`CMP unable to register callback function.  Please check CMP setup.`);\n      cmpSuccess(undefined, finalCallback);\n      // TODO cmpError('CMP unable to register callback function.  Please check CMP setup.', hookConfig);\n    }\n  }\n\n  function handleV1CmpResponseCallbacks() {\n    const cmpResponse = {};\n\n    function afterEach() {\n      if (cmpResponse.getConsentData && cmpResponse.getVendorConsents) {\n        cmpSuccess(cmpResponse, finalCallback);\n      }\n    }\n\n    return {\n      consentDataCallback: function (consentResponse) {\n        utils.logInfo(`cmpApi: consentDataCallback`);\n        cmpResponse.getConsentData = consentResponse;\n        afterEach();\n      },\n      vendorConsentsCallback: function (consentResponse) {\n        utils.logInfo(`cmpApi: vendorConsentsCallback`);\n        cmpResponse.getVendorConsents = consentResponse;\n        afterEach();\n      }\n    }\n  }\n\n  let v1CallbackHandler = handleV1CmpResponseCallbacks();\n  let { cmpFrame, cmpFunction } = findCMP();\n\n  if (!cmpFrame) {\n    // TODO implement cmpError\n    // return cmpError('CMP not found.', hookConfig);\n    utils.logError(`CMP not found`);\n    return cmpSuccess(undefined, finalCallback);\n  }\n\n  if (utils.isFn(cmpFunction)) {\n    utils.logInfo(`cmpApi: calling getConsentData & getVendorConsents`);\n    if (cmpVersion === 1) {\n      cmpFunction('getConsentData', null, v1CallbackHandler.consentDataCallback);\n      cmpFunction('getVendorConsents', null, v1CallbackHandler.vendorConsentsCallback);\n    } else if (cmpVersion === 2) {\n      cmpFunction('addEventListener', cmpVersion, v2CmpResponseCallback);\n    }\n  } else {\n    // TODO might need to check if we're in an iframe...\n\n    cmpSuccess(undefined, finalCallback);\n  }\n}\n\n/**\n * Try to fetch consent from CMP\n * @param {string} cmpApi - API to use to fetch consent. Either iab or static\n * @param {function(object)} finalCallback required; final callback\n */\nexport function requestConsent(finalCallback) {\n  const cfg = config.getConfig();\n  if (cfg.allowID5WithoutConsentApi) {\n    utils.logError('ID5 is operating in forced consent mode');\n    finalCallback(consentData);\n  } else if (!cmpCallMap[cfg.cmpApi]) {\n    utils.logError(`Unknown consent API: ${cfg.cmpApi}`);\n    resetConsentData();\n    finalCallback(consentData);\n  } else if (!consentData) {\n    if (cfg.cmpApi === 'static') {\n      if (utils.isPlainObject(config.getConfig().consentData)) {\n        staticConsentData = config.getConfig().consentData;\n      } else {\n        utils.logError(`cmpApi: 'static' did not specify consentData.`);\n      }\n    }\n    cmpCallMap[cfg.cmpApi].call(this, cmpSuccess, finalCallback);\n  } else {\n    finalCallback(consentData);\n  }\n}\n\n/**\n * This function checks the consent data provided by CMP to ensure it's in an expected state.\n * @param {object} consentObject required; object returned by CMP that contains user's consent choices\n * @param {function(ConsentData)} finalCallback required; final callback receiving the consent\n */\nfunction cmpSuccess(consentObject, finalCallback) {\n  const cfg = config.getConfig();\n\n  function checkV1Data(consentObject) {\n    let gdprApplies = consentObject && consentObject.getConsentData && consentObject.getConsentData.gdprApplies;\n    return !!(\n      (typeof gdprApplies !== 'boolean') ||\n      (gdprApplies === true &&\n        !(utils.isStr(consentObject.getConsentData.consentData) &&\n          utils.isPlainObject(consentObject.getVendorConsents) &&\n          Object.keys(consentObject.getVendorConsents).length > 1\n        )\n      )\n    );\n  }\n\n  function checkV2Data() {\n    let gdprApplies = consentObject && typeof consentObject.gdprApplies === 'boolean' ? consentObject.gdprApplies : undefined;\n    let tcString = consentObject && consentObject.tcString;\n    return !!(\n      (typeof gdprApplies !== 'boolean') ||\n      (gdprApplies === true && !utils.isStr(tcString))\n    );\n  }\n\n  // do extra things for static config\n  if (cfg.cmpApi === 'static') {\n    cmpVersion = (consentObject.getConsentData) ? 1 : (consentObject.getTCData) ? 2 : 0;\n    // remove extra layer in static v2 data object so it matches normal v2 CMP object for processing step\n    if (cmpVersion === 2) {\n      consentObject = consentObject.getTCData;\n    }\n  }\n\n  // determine which set of checks to run based on cmpVersion\n  let checkFn = (cmpVersion === 1) ? checkV1Data : (cmpVersion === 2) ? checkV2Data : null;\n  utils.logInfo('CMP Success callback for version', cmpVersion, checkFn);\n  if (utils.isFn(checkFn)) {\n    if (checkFn(consentObject)) {\n      resetConsentData();\n      utils.logError(`CMP returned unexpected value during lookup process.`, consentObject);\n    } else {\n      storeConsentData(consentObject);\n    }\n  }\n\n  finalCallback(consentData);\n}\n\n/**\n * Simply resets the module's consentData variable back to undefined, mainly for testing purposes\n */\nexport function resetConsentData() {\n  consentData = undefined;\n}\n\n/**\n * Stores CMP data locally in module\n * @param {object} cmpConsentObject required; an object representing user's consent choices (can be undefined in certain use-cases for this function only)\n */\nfunction storeConsentData(cmpConsentObject) {\n  if (cmpVersion === 1) {\n    consentData = {\n      consentString: (cmpConsentObject) ? cmpConsentObject.getConsentData.consentData : undefined,\n      vendorData: (cmpConsentObject) ? cmpConsentObject.getVendorConsents : undefined,\n      gdprApplies: (cmpConsentObject) ? cmpConsentObject.getConsentData.gdprApplies : undefined,\n      apiVersion: 1\n    };\n  } else if (cmpVersion === 2) {\n    consentData = {\n      consentString: (cmpConsentObject) ? cmpConsentObject.tcString : undefined,\n      vendorData: (cmpConsentObject) || undefined,\n      gdprApplies: cmpConsentObject && typeof cmpConsentObject.gdprApplies === 'boolean' ? cmpConsentObject.gdprApplies : undefined,\n      apiVersion: 2\n    };\n  } else {\n    consentData = {\n      apiVersion: 0\n    };\n  }\n}\n\n/**\n * test if consent module is present, applies, and is valid for local storage or cookies (purpose 1)\n * @returns {boolean}\n */\nexport function isLocalStorageAllowed() {\n  if (config.getConfig().allowID5WithoutConsentApi) {\n    return true;\n  } else if (!consentData) {\n    return false;\n  } else if (typeof consentData.gdprApplies === 'boolean' && consentData.gdprApplies) {\n    if (!consentData.consentString || consentData.apiVersion === 0) {\n      return false;\n    } else if (consentData.apiVersion === 1 && consentData.vendorData && consentData.vendorData.purposeConsents && consentData.vendorData.purposeConsents['1'] === false) {\n      return false;\n    } else if (consentData.apiVersion === 2 && consentData.vendorData && consentData.vendorData.purpose && consentData.vendorData.purpose.consents && consentData.vendorData.purpose.consents['1'] === false) {\n      return false;\n    } else {\n      return true;\n    }\n  } else {\n    return true;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/consentManagement.js","/**\n * The referer detection module attempts to gather referer information from the current page that id5-api.js resides in.\n * The information that it tries to collect includes:\n * The detected top url in the nav bar,\n * Whether it was able to reach the top most window (if for example it was embedded in several iframes),\n * The number of iframes it was embedded in if applicable,\n * A list of the domains of each embedded window if applicable.\n * Canonical URL which refers to an HTML link element, with the attribute of rel=\"canonical\", found in the <head> element of your webpage\n */\n\nexport function detectReferer(win) {\n  /**\n   * Returns number of frames to reach top from current frame\n   * @returns {Array} levels\n   */\n  function getLevels() {\n    let levels = walkUpWindows();\n    let ancestors = getAncestorOrigins();\n\n    if (ancestors) {\n      for (let i = 0, l = ancestors.length; i < l; i++) {\n        levels[i].ancestor = ancestors[i];\n      }\n    }\n    return levels;\n  }\n\n  /**\n   * This function would return a read-only array of hostnames for all the parent frames.\n   * win.location.ancestorOrigins is only supported in webkit browsers. For non-webkit browsers it will return undefined.\n   * @returns {(undefined|Array)} Ancestor origins or undefined\n   */\n  function getAncestorOrigins() {\n    try {\n      if (!win.location.ancestorOrigins) {\n        return;\n      }\n      return win.location.ancestorOrigins;\n    } catch (e) {\n      // Ignore error\n    }\n  }\n\n  /**\n   * This function would try to get referer and urls for all parent frames in case of win.location.ancestorOrigins undefined.\n   * @param {Array} levels\n   * @returns {Object} urls for all parent frames and top most detected referer url\n   */\n  function getPubUrlStack(levels) {\n    let stack = [];\n    let defUrl = null;\n    let frameLocation = null;\n    let prevFrame = null;\n    let prevRef = null;\n    let ancestor = null;\n    let detectedRefererUrl = null;\n\n    let i;\n    for (i = levels.length - 1; i >= 0; i--) {\n      try {\n        frameLocation = levels[i].location;\n      } catch (e) {\n        // Ignore error\n      }\n\n      if (frameLocation) {\n        stack.push(frameLocation);\n        if (!detectedRefererUrl) {\n          detectedRefererUrl = frameLocation;\n        }\n      } else if (i !== 0) {\n        prevFrame = levels[i - 1];\n        try {\n          prevRef = prevFrame.referrer;\n          ancestor = prevFrame.ancestor;\n        } catch (e) {\n          // Ignore error\n        }\n\n        if (prevRef) {\n          stack.push(prevRef);\n          if (!detectedRefererUrl) {\n            detectedRefererUrl = prevRef;\n          }\n        } else if (ancestor) {\n          stack.push(ancestor);\n          if (!detectedRefererUrl) {\n            detectedRefererUrl = ancestor;\n          }\n        } else {\n          stack.push(defUrl);\n        }\n      } else {\n        stack.push(defUrl);\n      }\n    }\n    return {\n      stack,\n      detectedRefererUrl\n    };\n  }\n\n  /**\n   * This function returns canonical URL which refers to an HTML link element, with the attribute of rel=\"canonical\", found in the <head> element of your webpage\n   * @param {Object} doc document\n   */\n  function getCanonicalUrl(doc) {\n    try {\n      let element = doc.querySelector(\"link[rel='canonical']\");\n      if (element !== null) {\n        return element.href;\n      }\n    } catch (e) {\n    }\n    return null;\n  }\n\n  /**\n   * Walk up to the top of the window to detect origin, number of iframes, ancestor origins and canonical url\n   */\n  function walkUpWindows() {\n    let acc = [];\n    let currentWindow;\n    do {\n      try {\n        currentWindow = currentWindow ? currentWindow.parent : win;\n        try {\n          let isTop = (currentWindow === win.top);\n          let refData = {\n            referrer: currentWindow.document.referrer || null,\n            location: currentWindow.location.href || null,\n            isTop\n          }\n          if (isTop) {\n            refData = Object.assign(refData, {\n              canonicalUrl: getCanonicalUrl(currentWindow.document)\n            })\n          }\n          acc.push(refData);\n        } catch (e) {\n          acc.push({\n            referrer: null,\n            location: null,\n            isTop: (currentWindow === win.top)\n          });\n        }\n      } catch (e) {\n        acc.push({\n          referrer: null,\n          location: null,\n          isTop: false\n        });\n        return acc;\n      }\n    } while (currentWindow !== win.top);\n    return acc;\n  }\n\n  /**\n   * Referer info\n   * @typedef {Object} refererInfo\n   * @property {string} referer detected top url\n   * @property {boolean} reachedTop whether it was possible to walk upto top window or not\n   * @property {number} numIframes number of iframes\n   * @property {string} stack comma separated urls of all origins\n   * @property {string} canonicalUrl canonical URL refers to an HTML link element, with the attribute of rel=\"canonical\", found in the <head> element of your webpage\n   */\n\n  /**\n   * Get referer info\n   * @returns {refererInfo}\n   */\n  function refererInfo() {\n    try {\n      let levels = getLevels();\n      let numIframes = levels.length - 1;\n      let reachedTop = (levels[numIframes].location !== null ||\n        (numIframes > 0 && levels[numIframes - 1].referrer !== null));\n      let stackInfo = getPubUrlStack(levels);\n      let canonicalUrl;\n      if (levels[levels.length - 1].canonicalUrl) {\n        canonicalUrl = levels[levels.length - 1].canonicalUrl;\n      }\n\n      return {\n        referer: stackInfo.detectedRefererUrl,\n        reachedTop,\n        numIframes,\n        stack: stackInfo.stack,\n        canonicalUrl\n      };\n    } catch (e) {\n      // Ignore error\n    }\n  }\n\n  return refererInfo;\n}\n\nexport const getRefererInfo = detectReferer(window);\n\n\n\n// WEBPACK FOOTER //\n// ./src/refererDetection.js"],"sourceRoot":""}