{"version":3,"sources":["webpack:///webpack/bootstrap 84c9e270922658391f6d","webpack:///./src/utils.js","webpack:///./src/config.js","webpack:///./src/consentManagement.js","webpack:///./src/constants.json","webpack:///./src/id5-api.js","webpack:///./src/id5-apiGlobal.js","webpack:///./src/refererDetection.js","webpack:///./src/abTesting.js","webpack:///./src/clientStore.js"],"names":["tArr","tStr","tFn","tNumb","tObject","tBoolean","toString","Object","prototype","consoleExists","Boolean","window","console","consoleLogExists","log","consoleInfoExists","info","consoleWarnExists","warn","consoleErrorExists","error","uniqueRef","bind","a","b","Function","self","args","Array","slice","call","arguments","apply","concat","replaceTokenInString","str","map","token","_each","value","key","undefined","keyString","toUpperCase","re","RegExp","replace","logMessage","debugTurnedOn","decorateLog","logInfo","logWarn","logError","prefix","unshift","config","getConfig","debug","getParameterByName","name","regexS","regex","results","exec","location","search","decodeURIComponent","isA","object","_t","isFn","isStr","isArray","isNumber","isPlainObject","isBoolean","isEmpty","length","k","hasOwnProperty","fn","forEach","l","_map","callback","output","push","isSafariBrowser","test","navigator","userAgent","checkCookieSupport","cookieEnabled","document","cookie","cookiesAreEnabled","indexOf","getCookie","m","match","setCookie","expires","encodeURIComponent","hasLocalStorage","localStorage","e","getItemFromLocalStorage","getItem","getFromLocalStorage","storageConfig","storedValueExp","Date","getTime","now","removeFromLocalStorage","setItemInLocalStorage","setItem","setInLocalStorage","expiresStr","expiresDays","toUTCString","removeItemFromLocalStorage","removeItem","parseQS","query","split","reduce","acc","criteria","v","formatQS","keys","join","parse","url","options","parsed","createElement","noDecodeWholeURL","href","qsAsString","decodeSearchAsString","protocol","hostname","port","pathname","hash","host","format","obj","XHR_DONE","ajax","data","x","method","parser","callbacks","success","XMLHttpRequest","onreadystatechange","readyState","status","responseText","statusText","ontimeout","timeout","urlInfo","open","withCredentials","customHeaders","header","setRequestHeader","preflight","contentType","send","fireAsyncPixel","syncUrl","initCallBack","img","Image","src","complete","addEventListener","deferPixelFire","loadedCallback","cyrb53Hash","seed","imul","opA","opB","Math","result","h1","h2","i","ch","charCodeAt","utils","require","newConfig","providedConfig","configTypes","allowID5WithoutConsentApi","cmpApi","consentData","refreshInSeconds","partnerId","partnerUserId","callbackTimeoutInMs","pd","tpids","abTesting","resetConfig","getConsentData","gdprApplies","getVendorConsents","enabled","controlGroupPct","getProvidedConfig","setConfig","topic","staticConsentData","storedPrivacyData","cmpVersion","cmpCallMap","lookupIabConsent","lookupStaticConsentData","cmpSuccess","finalCallback","findCMP","f","cmpFrame","cmpFunction","__tcfapi","__cmp","frames","top","parent","v2CmpResponseCallback","tcfData","eventStatus","handleV1CmpResponseCallbacks","cmpResponse","afterEach","consentDataCallback","consentResponse","vendorConsentsCallback","v1CallbackHandler","requestConsent","cfg","resetConsentData","consentObject","checkV1Data","checkV2Data","tcString","getTCData","checkFn","storeConsentData","cmpConsentObject","consentString","vendorData","apiVersion","isLocalStorageAllowed","isProvisionalLocalStorageAllowed","purposeConsents","purpose","consents","JSON","CONSTANTS","STORAGE_CONFIG","PRIVACY","id5_consent","jurisdiction","jurisdictionRequiresConsent","JURISDICTIONS","setStoredPrivacy","privacy","stringify","ID5","getGlobal","loaded","initialized","callbackFired","init","version","Error","setStoredConsentData","clientStore","setStoredPd","AbTesting","getId","exposeId","refreshId","forceFetch","consent","referer","getRefererInfo","storedResponse","storedDateTime","refreshInSecondsHasElapsed","nb","fromCache","pdHasChanged","setTimeout","fireCallBack","universal_uid","userId","linkType","link_type","refreshNeeded","consentHasChanged","signature","gdprConsentString","stack","reachedTop","currentScript","response","responseObj","cascade_needed","isSync","detectReferer","win","getLevels","levels","walkUpWindows","ancestors","getAncestorOrigins","ancestor","ancestorOrigins","getPubUrlStack","defUrl","frameLocation","prevFrame","prevRef","detectedRefererUrl","referrer","getCanonicalUrl","doc","element","querySelector","currentWindow","isTop","refData","canonicalUrl","refererInfo","numIframes","stackInfo","abConfig","controlGroup","random","get","cacheConfig","clear","put","getResponseFromLegacyCookie","legacyStoredValue","LEGACY_COOKIE_NAMES","getResponse","clearResponse","putResponse","getHashedConsentData","CONSENT_DATA","clearHashedConsentData","putHashedConsentData","makeStoredConsentDataHash","getHashedPd","PD","clearHashedPd","putHashedPd","makeStoredPdHash","getDateTime","LAST","clearDateTime","setDateTime","timestamp","nbCacheConfig","getNb","cachedNb","parseInt","clearNb","setNb","incNb","syncCallback","FS","forceSync","cachedFs","clearAll","removeLegacyCookies","expired","storedDataMatchesCurrentData","storedData","currentData","storedConsentDataMatchesConsentData","storedPdMatchesPd","storedConsentData"],"mappings":"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","file":"id5-api.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 4);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 84c9e270922658391f6d","\nimport { config } from './config';\n\nconst tArr = 'Array';\nconst tStr = 'String';\nconst tFn = 'Function';\nconst tNumb = 'Number';\nconst tObject = 'Object';\nconst tBoolean = 'Boolean';\nconst toString = Object.prototype.toString;\nlet consoleExists = Boolean(window.console);\nlet consoleLogExists = Boolean(consoleExists && window.console.log);\nlet consoleInfoExists = Boolean(consoleExists && window.console.info);\nlet consoleWarnExists = Boolean(consoleExists && window.console.warn);\nlet consoleErrorExists = Boolean(consoleExists && window.console.error);\n\nlet uniqueRef = {};\nexport let bind = function(a, b) { return b; }.bind(null, 1, uniqueRef)() === uniqueRef\n  ? Function.prototype.bind\n  : function(bind) {\n    var self = this;\n    var args = Array.prototype.slice.call(arguments, 1);\n    return function() {\n      return self.apply(bind, args.concat(Array.prototype.slice.call(arguments)));\n    };\n  };\n\n/*\n *   Substitutes into a string from a given map using the token\n *   Usage\n *   var str = 'text %%REPLACE%% this text with %%SOMETHING%%';\n *   var map = {};\n *   map['replace'] = 'it was subbed';\n *   map['something'] = 'something else';\n *   console.log(replaceTokenInString(str, map, '%%')); => \"text it was subbed this text with something else\"\n */\nexport function replaceTokenInString(str, map, token) {\n  _each(map, function (value, key) {\n    value = (value === undefined) ? '' : value;\n\n    let keyString = token + key.toUpperCase() + token;\n    let re = new RegExp(keyString, 'g');\n\n    str = str.replace(re, value);\n  });\n\n  return str;\n}\n\n/**\n * Wrappers to console.(log | info | warn | error). Takes N arguments, the same as the native methods\n */\nexport function logMessage() {\n  if (debugTurnedOn() && consoleLogExists) {\n    console.log.apply(console, decorateLog(arguments, 'MESSAGE:'));\n  }\n}\n\nexport function logInfo() {\n  if (debugTurnedOn() && consoleInfoExists) {\n    console.info.apply(console, decorateLog(arguments, 'INFO:'));\n  }\n}\n\nexport function logWarn() {\n  if (debugTurnedOn() && consoleWarnExists) {\n    console.warn.apply(console, decorateLog(arguments, 'WARNING:'));\n  }\n}\n\nexport function logError() {\n  if (debugTurnedOn() && consoleErrorExists) {\n    console.error.apply(console, decorateLog(arguments, 'ERROR:'));\n  }\n}\n\nfunction decorateLog(args, prefix) {\n  args = [].slice.call(args);\n  prefix && args.unshift(prefix);\n  args.unshift('display: inline-block; color: #fff; background: #1c307e; padding: 1px 4px; border-radius: 3px;');\n  args.unshift('%cID5');\n  return args;\n}\n\nexport function debugTurnedOn() {\n  return config.getConfig().debug;\n}\n\n/*\n *   Check if a given parameter name exists in query string\n *   and if it does return the value\n */\nexport function getParameterByName(name) {\n  const regexS = '[\\\\?&]' + name + '=([^&#]*)';\n  const regex = new RegExp(regexS);\n  const results = regex.exec(window.location.search);\n  if (results === null) {\n    return '';\n  }\n\n  return decodeURIComponent(results[1].replace(/\\+/g, ' '));\n}\n\n/**\n * Return if the object is of the\n * given type.\n * @param {*} object to test\n * @param {String} _t type string (e.g., Array)\n * @return {Boolean} if object is of type _t\n */\nexport function isA(object, _t) {\n  return toString.call(object) === '[object ' + _t + ']';\n}\n\nexport function isFn(object) {\n  return isA(object, tFn);\n}\n\nexport function isStr(object) {\n  return isA(object, tStr);\n}\n\nexport function isArray(object) {\n  return isA(object, tArr);\n}\n\nexport function isNumber(object) {\n  return isA(object, tNumb);\n}\n\nexport function isPlainObject(object) {\n  return isA(object, tObject);\n}\n\nexport function isBoolean(object) {\n  return isA(object, tBoolean);\n}\n\n/**\n * Return if the object is \"empty\";\n * this includes falsey, no keys, or no items at indices\n * @param {*} object object to test\n * @return {Boolean} if object is empty\n */\nexport function isEmpty(object) {\n  if (!object) return true;\n  if (isArray(object) || isStr(object)) {\n    return !(object.length > 0);\n  }\n\n  for (let k in object) {\n    if (hasOwnProperty.call(object, k)) return false;\n  }\n\n  return true;\n}\n\n/**\n * Iterate object with the function\n * falls back to es5 `forEach`\n * @param {Array|Object} object\n * @param {function(value, key, object)} fn\n */\nexport function _each(object, fn) {\n  if (isEmpty(object)) return;\n  if (isFn(object.forEach)) return object.forEach(fn, this);\n\n  let k = 0;\n  let l = object.length;\n\n  if (l > 0) {\n    for (; k < l; k++) fn(object[k], k, object);\n  } else {\n    for (k in object) {\n      if (hasOwnProperty.call(object, k)) fn.call(this, object[k], k);\n    }\n  }\n}\n\n/**\n * Map an array or object into another array\n * given a function\n * @param {Array|Object} object\n * @param {function(value, key, object)} callback\n * @return {Array}\n */\nexport function _map(object, callback) {\n  if (isEmpty(object)) return [];\n  if (isFn(object.map)) return object.map(callback);\n  var output = [];\n  _each(object, function (value, key) {\n    output.push(callback(value, key, object));\n  });\n\n  return output;\n}\n\nexport function isSafariBrowser() {\n  return /^((?!chrome|android).)*safari/i.test(navigator.userAgent);\n}\n\nexport function checkCookieSupport() {\n  if (window.navigator.cookieEnabled || !!document.cookie.length) {\n    return true;\n  }\n}\nexport function cookiesAreEnabled() {\n  window.document.cookie = 'id5.cookieTest';\n  return window.document.cookie.indexOf('id5.cookieTest') !== -1;\n}\n\nexport function getCookie(name) {\n  let m = window.document.cookie.match('(^|;)\\\\s*' + name + '\\\\s*=\\\\s*([^;]*)\\\\s*(;|$)');\n  return m ? decodeURIComponent(m[2]) : null;\n}\n\nexport function setCookie(key, value, expires) {\n  document.cookie = `${key}=${encodeURIComponent(value)}${(expires !== '') ? `; expires=${expires}` : ''}; path=/`;\n}\n\n/**\n * @returns {boolean}\n */\nfunction hasLocalStorage() {\n  try {\n    return !!window.localStorage;\n  } catch (e) {\n    logError('Local storage api disabled!');\n  }\n  return false;\n}\n\n/**\n * @typedef {object} StoreItem\n * @property {string} name - Unique key of the stored value\n * @property {number} expiresDays - Number of days of TTL\n */\n\n/**\n * Get stored string from local storage\n *\n * @param {string} key\n * @returns {string|null|undefined} the stored value, null if no value or expired were stored, undefined if no localStorage\n */\nexport function getItemFromLocalStorage(key) {\n  if (hasLocalStorage()) {\n    return window.localStorage.getItem(key);\n  }\n}\n\n/**\n * Get StoreItem from local storage\n *\n * @param {string} storageConfig.name\n * @param {number} storageConfig.expiresDays\n * @returns {string|null|undefined} the stored value, null if no value or expired were stored, undefined if no localStorage\n */\nexport function getFromLocalStorage(storageConfig) {\n  const storedValueExp = window.localStorage.getItem(`${storageConfig.name}_exp`);\n  if (storedValueExp && (new Date(storedValueExp)).getTime() - Date.now() > 0) {\n    // result is not expired, so it can be retrieved\n    return getItemFromLocalStorage(storageConfig.name);\n  } else {\n    // if we got here, then we have an expired item, so we need to remove the item\n    // from the local storage\n    removeFromLocalStorage(storageConfig);\n    return null;\n  }\n}\n\n/**\n * Put string in local storage\n *\n * @param {string} key\n * @param {string} value\n * @returns {string|null|undefined} the stored value, null if no value or expired were stored, undefined if no localStorage\n */\nexport function setItemInLocalStorage(key, value) {\n  if (hasLocalStorage()) {\n    window.localStorage.setItem(key, value);\n  }\n}\n\n/**\n * Put StoreItem in local storage\n *\n * @param {StoreItem} storageConfig\n * @param {string} value\n * @returns {string|null|undefined} the stored value, null if no value or expired were stored, undefined if no localStorage\n */\nexport function setInLocalStorage(storageConfig, value) {\n  // always set an expiration\n  const expiresStr = (new Date(Date.now() + (storageConfig.expiresDays * (60 * 60 * 24 * 1000)))).toUTCString();\n  setItemInLocalStorage(`${storageConfig.name}_exp`, expiresStr);\n  setItemInLocalStorage(`${storageConfig.name}`, value);\n}\n\n/**\n * Clear a string in local storage\n *\n * @param {string} key\n */\nexport function removeItemFromLocalStorage(key) {\n  if (hasLocalStorage()) {\n    window.localStorage.removeItem(key);\n  }\n}\n\n/**\n * Clear StoreItem in local storage\n *\n * @param {StoreItem} storageConfig\n */\nexport function removeFromLocalStorage(storageConfig) {\n  removeItemFromLocalStorage(`${storageConfig.name}`);\n  removeItemFromLocalStorage(`${storageConfig.name}_exp`);\n}\n\nexport function parseQS(query) {\n  return !query ? {} : query\n    .replace(/^\\?/, '')\n    .split('&')\n    .reduce((acc, criteria) => {\n      let [k, v] = criteria.split('=');\n      if (/\\[\\]$/.test(k)) {\n        k = k.replace('[]', '');\n        acc[k] = acc[k] || [];\n        acc[k].push(v);\n      } else {\n        acc[k] = v || '';\n      }\n      return acc;\n    }, {});\n}\n\nexport function formatQS(query) {\n  return Object\n    .keys(query)\n    .map(k => Array.isArray(query[k])\n      ? query[k].map(v => `${k}[]=${v}`).join('&')\n      : `${k}=${query[k]}`)\n    .join('&');\n}\n\nexport function parse(url, options) {\n  let parsed = document.createElement('a');\n  if (options && 'noDecodeWholeURL' in options && options.noDecodeWholeURL) {\n    parsed.href = url;\n  } else {\n    parsed.href = decodeURIComponent(url);\n  }\n  // in window.location 'search' is string, not object\n  let qsAsString = (options && 'decodeSearchAsString' in options && options.decodeSearchAsString);\n  return {\n    href: parsed.href,\n    protocol: (parsed.protocol || '').replace(/:$/, ''),\n    hostname: parsed.hostname,\n    port: +parsed.port,\n    pathname: parsed.pathname.replace(/^(?!\\/)/, '/'),\n    search: (qsAsString) ? parsed.search : parseQS(parsed.search || ''),\n    hash: (parsed.hash || '').replace(/^#/, ''),\n    host: parsed.host || window.location.host\n  };\n}\n\nexport function format(obj) {\n  return (obj.protocol || 'http') + '://' +\n    (obj.host ||\n        obj.hostname + (obj.port ? `:${obj.port}` : '')) +\n    (obj.pathname || '') +\n    (obj.search ? `?${formatQS(obj.search || '')}` : '') +\n    (obj.hash ? `#${obj.hash}` : '');\n}\n\nconst XHR_DONE = 4;\n\n/**\n * Simple IE9+ and cross-browser ajax request function\n * Note: x-domain requests in IE9 do not support the use of cookies\n *\n * @param url string url\n * @param callback {object | function} callback\n * @param data mixed data\n * @param options object\n */\nexport function ajax(url, callback, data, options = {}) {\n  try {\n    let x;\n    let method = options.method || (data ? 'POST' : 'GET');\n    let parser = document.createElement('a');\n    parser.href = url;\n\n    let callbacks = typeof callback === 'object' && callback !== null ? callback : {\n      success: function() {\n        logMessage('xhr success');\n      },\n      error: function(e) {\n        logError('xhr error', null, e);\n      }\n    };\n\n    if (typeof callback === 'function') {\n      callbacks.success = callback;\n    }\n\n    x = new window.XMLHttpRequest();\n\n    x.onreadystatechange = function () {\n      if (x.readyState === XHR_DONE) {\n        let status = x.status;\n        if ((status >= 200 && status < 300) || status === 304) {\n          callbacks.success(x.responseText, x);\n        } else {\n          callbacks.error(x.statusText, x);\n        }\n      }\n    };\n\n    x.ontimeout = function () {\n      logError('  xhr timeout after ', x.timeout, 'ms');\n    };\n\n    if (method === 'GET' && data) {\n      let urlInfo = parse(url, options);\n      Object.assign(urlInfo.search, data);\n      url = format(urlInfo);\n    }\n\n    x.open(method, url, true);\n\n    if (options.withCredentials) {\n      x.withCredentials = true;\n    }\n    _each(options.customHeaders, (value, header) => {\n      x.setRequestHeader(header, value);\n    });\n    if (options.preflight) {\n      x.setRequestHeader('X-Requested-With', 'XMLHttpRequest');\n    }\n    x.setRequestHeader('Content-Type', options.contentType || 'text/plain');\n\n    if (method === 'POST' && data) {\n      x.send(data);\n    } else {\n      x.send();\n    }\n  } catch (error) {\n    logError('xhr construction', error);\n  }\n}\n\n/**\n * add an Image pixel to the DOM for the given sync Url\n *\n * @param syncUrl\n * @param initCallBack Called when pixel is initiated. Always called. Optional\n * @param callback Called when pixel is loaded. May never be called. Optional\n */\nexport function fireAsyncPixel(syncUrl, initCallBack, callback) {\n  let img = new Image();\n  img.src = syncUrl;\n  if (isFn(initCallBack)) {\n    initCallBack();\n  }\n  if (isFn(callback)) {\n    if (img.complete) {\n      callback()\n    } else {\n      img.addEventListener('load', callback)\n    }\n  }\n}\n\n/**\n * wait until the page finishes loading and then fire a pixel\n *\n * @param syncUrl\n * @param initCallBack Called when pixel is initiated. Optional\n * @param loadedCallback Called when pixel is loaded (may never be called). Optional\n */\nexport function deferPixelFire(syncUrl, initCallBack, loadedCallback) {\n  if (document.readyState !== 'loading') {\n    fireAsyncPixel(syncUrl, initCallBack, loadedCallback);\n  } else {\n    document.addEventListener('DOMContentLoaded', function () {\n      fireAsyncPixel(syncUrl, initCallBack, loadedCallback);\n    });\n  }\n}\n\n/**\n * returns a hash of a string using a fast algorithm\n * source: https://stackoverflow.com/a/52171480/845390\n * @param str\n * @param seed (optional)\n * @returns {string}\n */\nexport function cyrb53Hash(str, seed = 0) {\n  // IE doesn't support imul\n  // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/imul#Polyfill\n  let imul = function(opA, opB) {\n    if (isFn(Math.imul)) {\n      return Math.imul(opA, opB);\n    } else {\n      opB |= 0; // ensure that opB is an integer. opA will automatically be coerced.\n      // floating points give us 53 bits of precision to work with plus 1 sign bit\n      // automatically handled for our convienence:\n      // 1. 0x003fffff /*opA & 0x000fffff*/ * 0x7fffffff /*opB*/ = 0x1fffff7fc00001\n      //    0x1fffff7fc00001 < Number.MAX_SAFE_INTEGER /*0x1fffffffffffff*/\n      var result = (opA & 0x003fffff) * opB;\n      // 2. We can remove an integer coersion from the statement above because:\n      //    0x1fffff7fc00001 + 0xffc00000 = 0x1fffffff800001\n      //    0x1fffffff800001 < Number.MAX_SAFE_INTEGER /*0x1fffffffffffff*/\n      if (opA & 0xffc00000) result += (opA & 0xffc00000) * opB | 0;\n      return result | 0;\n    }\n  };\n\n  let h1 = 0xdeadbeef ^ seed;\n  let h2 = 0x41c6ce57 ^ seed;\n  for (let i = 0, ch; i < str.length; i++) {\n    ch = str.charCodeAt(i);\n    h1 = imul(h1 ^ ch, 2654435761);\n    h2 = imul(h2 ^ ch, 1597334677);\n  }\n  h1 = imul(h1 ^ (h1 >>> 16), 2246822507) ^ imul(h2 ^ (h2 >>> 13), 3266489909);\n  h2 = imul(h2 ^ (h2 >>> 16), 2246822507) ^ imul(h1 ^ (h1 >>> 13), 3266489909);\n  return (4294967296 * (2097151 & h2) + (h1 >>> 0)).toString();\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/utils.js","/*\n * Module for getting and setting ID5 API configuration.\n */\n\nconst utils = require('./utils');\n\n/**\n * @typedef {Object} Id5Config\n * @property {number} partnerId - ID5 Publisher ID, mandatory\n * @property {boolean|false} [debug] - enable verbose debug mode (defaulting to id5_debug query string param if present, or false)\n * @property {boolean|false} [allowID5WithoutConsentApi] - Allow ID5 to fetch user id even if no consent API\n * @property {number} [refreshInSeconds] - Refresh period of first-party cookie (defaulting to 7200s)\n * @property {string} [partnerUserId] - User ID for the platform deploying the API, to be stored by ID5 for further cookie matching if provided\n * @property {string} [cmpApi] - API to use CMP. As of today, either 'iab' or 'static'\n * @property {object} [consentData] - Consent data if cmpApi is 'static'\n * @property {function} [callback] - Function to call back when User ID is available. if callbackTimeoutInMs is not provided, will be fired only if a User ID is available.\n * @property {number} [callbackTimeoutInMs] - Delay in ms after which the callback is guaranteed to be fired. A User ID may not yet be available at this time.\n * @property {string} [pd] - Publisher data that can be passed to help with cross-domain reconciliation of the ID5 ID, more details here: https://wiki.id5.io/x/BIAZ\n * @property {array} [tpids] - An array of third party IDs that can be passed to usersync with ID5. Contact your ID5 representative to enable this\n * @property {AbTestConfig} [abTesting] - An object defining if and how A/B testing should be enabled\n */\n\nexport function newConfig() {\n  /** @type {Id5Config} */\n  let config;\n\n  /** @type {Id5Config} */\n  let providedConfig;\n\n  const configTypes = {\n    debug: 'Boolean',\n    allowID5WithoutConsentApi: 'Boolean',\n    cmpApi: 'String',\n    consentData: 'Object',\n    refreshInSeconds: 'Number',\n    partnerId: 'Number',\n    partnerUserId: 'String',\n    callback: 'Function',\n    callbackTimeoutInMs: 'Number',\n    pd: 'String',\n    tpids: 'Array',\n    abTesting: 'Object'\n  };\n\n  function resetConfig() {\n    config = {\n      debug: utils.getParameterByName('id5_debug').toUpperCase() === 'TRUE',\n      allowID5WithoutConsentApi: false,\n      cmpApi: 'iab',\n      consentData: {\n        getConsentData: {\n          consentData: undefined,\n          gdprApplies: undefined\n        },\n        getVendorConsents: {}\n      },\n      refreshInSeconds: 7200,\n      partnerId: undefined,\n      partnerUserId: undefined,\n      callback: undefined,\n      callbackTimeoutInMs: undefined,\n      pd: '',\n      tpids: undefined,\n      abTesting: {\n        enabled: false,\n        controlGroupPct: 0\n      }\n    };\n    providedConfig = {};\n  }\n\n  /**\n   * Return current configuration\n   * @returns {Id5Config} options\n   */\n  function getConfig() {\n    return config;\n  }\n\n  /**\n   * Return configuration set by user\n   * @returns {Id5Config} options\n   */\n  function getProvidedConfig() {\n    return providedConfig;\n  }\n\n  /**\n   * Sets configuration given an object containing key-value pairs\n   * @param {Id5Config} options\n   * @returns {Id5Config} config\n   */\n  function setConfig(options) {\n    if (typeof options !== 'object') {\n      utils.logError('setConfig options must be an object');\n      return undefined;\n    }\n\n    Object.keys(options).forEach(topic => {\n      if (utils.isA(options[topic], configTypes[topic])) {\n        config[topic] = options[topic];\n        providedConfig[topic] = options[topic];\n      } else {\n        utils.logError(`setConfig options ${topic} must be of type ${configTypes[topic]} but was ${toString.call(options[topic])}`);\n      }\n    });\n    return config\n  }\n\n  resetConfig();\n\n  return {\n    getConfig,\n    getProvidedConfig,\n    setConfig,\n    resetConfig\n  };\n}\n\nexport const config = newConfig();\n\n\n\n// WEBPACK FOOTER //\n// ./src/config.js","import * as utils from './utils';\nimport {config} from './config';\nimport CONSTANTS from 'src/constants.json';\n\nexport let consentData;\nexport let staticConsentData;\nexport let storedPrivacyData;\n\nlet cmpVersion = 0;\n\nconst cmpCallMap = {\n  'iab': lookupIabConsent,\n  'static': lookupStaticConsentData\n};\n\n/**\n * This function reads the consent string from the config to obtain the consent information of the user.\n * @param {function(string, function(object))} cmpSuccess acts as a success callback when the value is read from config; pass along consentObject (string) from CMP\n * @param {function(object)} finalCallback acts as an error callback while interacting with the config string; pass along an error message (string)\n */\nfunction lookupStaticConsentData(cmpSuccess, finalCallback) {\n  cmpSuccess(staticConsentData, finalCallback);\n}\n\n/**\n * This function handles async interacting with an IAB compliant CMP to obtain the consent information of the user.\n * @param {function(string, function(object))} cmpSuccess acts as a success callback when CMP returns a value; pass along consentObject (string) from CMP\n * @param {function(object)} finalCallback required;\n */\nfunction lookupIabConsent(cmpSuccess, finalCallback) {\n  function findCMP() {\n    cmpVersion = 0;\n    let f = window;\n    let cmpFrame;\n    let cmpFunction;\n    while (!cmpFrame) {\n      try {\n        if (typeof f.__tcfapi === 'function' || typeof f.__cmp === 'function') {\n          if (typeof f.__tcfapi === 'function') {\n            cmpVersion = 2;\n            cmpFunction = f.__tcfapi;\n          } else {\n            cmpVersion = 1;\n            cmpFunction = f.__cmp;\n          }\n          cmpFrame = f;\n          break;\n        }\n      } catch (e) { }\n\n      // need separate try/catch blocks due to the exception errors thrown when trying to check for a frame that doesn't exist in 3rd party env\n      try {\n        if (f.frames['__tcfapiLocator']) {\n          cmpVersion = 2;\n          cmpFrame = f;\n          break;\n        }\n      } catch (e) { }\n\n      try {\n        if (f.frames['__cmpLocator']) {\n          cmpVersion = 1;\n          cmpFrame = f;\n          break;\n        }\n      } catch (e) { }\n\n      if (f === window.top) break;\n      f = f.parent;\n    }\n    return {\n      cmpFrame,\n      cmpFunction\n    };\n  }\n\n  function v2CmpResponseCallback(tcfData, success) {\n    utils.logInfo('Received a response from CMP', tcfData);\n    if (success) {\n      if (tcfData.gdprApplies === false || tcfData.eventStatus === 'tcloaded' || tcfData.eventStatus === 'useractioncomplete') {\n        cmpSuccess(tcfData, finalCallback);\n      }\n    } else {\n      utils.logError(`CMP unable to register callback function.  Please check CMP setup.`);\n      cmpSuccess(undefined, finalCallback);\n      // TODO cmpError('CMP unable to register callback function.  Please check CMP setup.', hookConfig);\n    }\n  }\n\n  function handleV1CmpResponseCallbacks() {\n    const cmpResponse = {};\n\n    function afterEach() {\n      if (cmpResponse.getConsentData && cmpResponse.getVendorConsents) {\n        cmpSuccess(cmpResponse, finalCallback);\n      }\n    }\n\n    return {\n      consentDataCallback: function (consentResponse) {\n        utils.logInfo(`cmpApi: consentDataCallback`);\n        cmpResponse.getConsentData = consentResponse;\n        afterEach();\n      },\n      vendorConsentsCallback: function (consentResponse) {\n        utils.logInfo(`cmpApi: vendorConsentsCallback`);\n        cmpResponse.getVendorConsents = consentResponse;\n        afterEach();\n      }\n    }\n  }\n\n  let v1CallbackHandler = handleV1CmpResponseCallbacks();\n  let { cmpFrame, cmpFunction } = findCMP();\n\n  if (!cmpFrame) {\n    // TODO implement cmpError\n    // return cmpError('CMP not found.', hookConfig);\n    utils.logError(`CMP not found`);\n    return cmpSuccess(undefined, finalCallback);\n  }\n\n  if (utils.isFn(cmpFunction)) {\n    utils.logInfo(`cmpApi: calling getConsentData & getVendorConsents`);\n    if (cmpVersion === 1) {\n      cmpFunction('getConsentData', null, v1CallbackHandler.consentDataCallback);\n      cmpFunction('getVendorConsents', null, v1CallbackHandler.vendorConsentsCallback);\n    } else if (cmpVersion === 2) {\n      cmpFunction('addEventListener', cmpVersion, v2CmpResponseCallback);\n    }\n  } else {\n    cmpSuccess(undefined, finalCallback);\n  }\n}\n\n/**\n * Try to fetch consent from CMP\n * @param {string} cmpApi - API to use to fetch consent. Either iab or static\n * @param {function(object)} finalCallback required; final callback\n */\nexport function requestConsent(finalCallback) {\n  const cfg = config.getConfig();\n  if (cfg.allowID5WithoutConsentApi) {\n    utils.logError('ID5 is operating in forced consent mode');\n    finalCallback(consentData);\n  } else if (!cmpCallMap[cfg.cmpApi]) {\n    utils.logError(`Unknown consent API: ${cfg.cmpApi}`);\n    resetConsentData();\n    finalCallback(consentData);\n  } else if (!consentData) {\n    if (cfg.cmpApi === 'static') {\n      if (utils.isPlainObject(config.getConfig().consentData)) {\n        staticConsentData = config.getConfig().consentData;\n      } else {\n        utils.logError(`cmpApi: 'static' did not specify consentData.`);\n      }\n    }\n    cmpCallMap[cfg.cmpApi].call(this, cmpSuccess, finalCallback);\n  } else {\n    finalCallback(consentData);\n  }\n}\n\n/**\n * This function checks the consent data provided by CMP to ensure it's in an expected state.\n * @param {object} consentObject required; object returned by CMP that contains user's consent choices\n * @param {function(ConsentData)} finalCallback required; final callback receiving the consent\n */\nfunction cmpSuccess(consentObject, finalCallback) {\n  const cfg = config.getConfig();\n\n  function checkV1Data(consentObject) {\n    let gdprApplies = consentObject && consentObject.getConsentData && consentObject.getConsentData.gdprApplies;\n    return !!(\n      (typeof gdprApplies !== 'boolean') ||\n      (gdprApplies === true &&\n        !(utils.isStr(consentObject.getConsentData.consentData) &&\n          utils.isPlainObject(consentObject.getVendorConsents) &&\n          Object.keys(consentObject.getVendorConsents).length > 1\n        )\n      )\n    );\n  }\n\n  function checkV2Data() {\n    let gdprApplies = consentObject && typeof consentObject.gdprApplies === 'boolean' ? consentObject.gdprApplies : undefined;\n    let tcString = consentObject && consentObject.tcString;\n    return !!(\n      (typeof gdprApplies !== 'boolean') ||\n      (gdprApplies === true && !utils.isStr(tcString))\n    );\n  }\n\n  // do extra things for static config\n  if (cfg.cmpApi === 'static') {\n    cmpVersion = (consentObject.getConsentData) ? 1 : (consentObject.getTCData) ? 2 : 0;\n    // remove extra layer in static v2 data object so it matches normal v2 CMP object for processing step\n    if (cmpVersion === 2) {\n      consentObject = consentObject.getTCData;\n    }\n  }\n\n  // determine which set of checks to run based on cmpVersion\n  let checkFn = (cmpVersion === 1) ? checkV1Data : (cmpVersion === 2) ? checkV2Data : null;\n  utils.logInfo('CMP Success callback for version', cmpVersion, checkFn);\n  if (utils.isFn(checkFn)) {\n    if (checkFn(consentObject)) {\n      resetConsentData();\n      utils.logError(`CMP returned unexpected value during lookup process.`, consentObject);\n    } else {\n      storeConsentData(consentObject);\n    }\n  }\n\n  finalCallback(consentData);\n}\n\n/**\n * Simply resets the module's consentData variable back to undefined, mainly for testing purposes\n */\nexport function resetConsentData() {\n  consentData = undefined;\n  storedPrivacyData = undefined;\n}\n\n/**\n * Stores CMP data locally in module\n * @param {object} cmpConsentObject required; an object representing user's consent choices (can be undefined in certain use-cases for this function only)\n */\nfunction storeConsentData(cmpConsentObject) {\n  if (cmpVersion === 1) {\n    consentData = {\n      consentString: (cmpConsentObject) ? cmpConsentObject.getConsentData.consentData : undefined,\n      vendorData: (cmpConsentObject) ? cmpConsentObject.getVendorConsents : undefined,\n      gdprApplies: (cmpConsentObject) ? cmpConsentObject.getConsentData.gdprApplies : undefined,\n      apiVersion: 1\n    };\n  } else if (cmpVersion === 2) {\n    consentData = {\n      consentString: (cmpConsentObject) ? cmpConsentObject.tcString : undefined,\n      vendorData: (cmpConsentObject) || undefined,\n      gdprApplies: cmpConsentObject && typeof cmpConsentObject.gdprApplies === 'boolean' ? cmpConsentObject.gdprApplies : undefined,\n      apiVersion: 2\n    };\n  } else {\n    consentData = {\n      apiVersion: 0\n    };\n  }\n}\n\n/**\n * test if consent module is present, applies, and is valid for local storage or cookies (purpose 1)\n * @returns {boolean}\n */\nexport function isLocalStorageAllowed() {\n  if (config.getConfig().allowID5WithoutConsentApi === true) {\n    // allowID5WithoutConsentApi:true forces local storage access\n    return true;\n  } else if (!consentData) {\n    // no cmp on page, so check if provisional access is allowed\n    return isProvisionalLocalStorageAllowed();\n  } else if (typeof consentData.gdprApplies === 'boolean' && consentData.gdprApplies) {\n    // gdpr applies\n    if (!consentData.consentString || consentData.apiVersion === 0) {\n      return false;\n    } else if (consentData.apiVersion === 1 && consentData.vendorData && consentData.vendorData.purposeConsents && consentData.vendorData.purposeConsents['1'] === false) {\n      return false;\n    } else if (consentData.apiVersion === 2 && consentData.vendorData && consentData.vendorData.purpose && consentData.vendorData.purpose.consents && consentData.vendorData.purpose.consents['1'] === false) {\n      return false;\n    } else {\n      return true;\n    }\n  } else {\n    // we have consent data and it tells us gdpr doesn't apply\n    return true;\n  }\n}\n\n/**\n * if there is no CMP on page, consentData will be undefined, so we will check if we had stored\n * privacy data from a previous request to determine if we are allowed to access local storage.\n * if so, we use the previous authorization as a legal basis before calling our servers to confirm.\n * if we do not have any stored privacy data, we will need to call our servers to know if we\n * are in a jurisdiction that requires consent or not before accessing local storage.\n *\n * if there is no stored privacy data or jurisdiction wasn't set, will return undefined so the\n * caller can decide what to do with in that case\n *\n * @return boolean|undefined\n */\nexport function isProvisionalLocalStorageAllowed() {\n  if (!utils.isPlainObject(storedPrivacyData)) {\n    storedPrivacyData = JSON.parse(utils.getFromLocalStorage(CONSTANTS.STORAGE_CONFIG.PRIVACY));\n  }\n\n  if (storedPrivacyData && storedPrivacyData.id5_consent === true) {\n    return true;\n  } else if (!storedPrivacyData || typeof storedPrivacyData.jurisdiction === 'undefined') {\n    return undefined;\n  } else {\n    const jurisdictionRequiresConsent = (typeof CONSTANTS.PRIVACY.JURISDICTIONS[storedPrivacyData.jurisdiction] !== 'undefined') ? CONSTANTS.PRIVACY.JURISDICTIONS[storedPrivacyData.jurisdiction] : false;\n    return (jurisdictionRequiresConsent === false || storedPrivacyData.id5_consent === true);\n  }\n}\n\nexport function setStoredPrivacy(privacy) {\n  try {\n    if (utils.isPlainObject(privacy)) {\n      storedPrivacyData = privacy;\n      utils.setInLocalStorage(CONSTANTS.STORAGE_CONFIG.PRIVACY, JSON.stringify(privacy));\n    } else {\n      utils.logInfo('Cannot store privacy if it\\'s not an object: ', privacy);\n    }\n  } catch (e) {\n    utils.logError(e);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/consentManagement.js","module.exports = {\"STORAGE_CONFIG\":{\"ID5\":{\"name\":\"id5id\",\"expiresDays\":90},\"LAST\":{\"name\":\"id5id_last\",\"expiresDays\":90},\"CONSENT_DATA\":{\"name\":\"id5id_cached_consent_data\",\"expiresDays\":30},\"PD\":{\"name\":\"id5id_cached_pd\",\"expiresDays\":30},\"FS\":{\"name\":\"id5id_fs\",\"expiresDays\":7},\"PRIVACY\":{\"name\":\"id5id_privacy\",\"expiresDays\":30}},\"LEGACY_COOKIE_NAMES\":[\"id5.1st\",\"id5id.1st\"],\"PRIVACY\":{\"JURISDICTIONS\":{\"gdpr\":true,\"ccpa\":false,\"lgpd\":true,\"other\":false}}}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/constants.json\n// module id = 3\n// module chunks = 0","/** @module id5-api */\n\nimport { getGlobal } from './id5-apiGlobal';\nimport { config } from './config';\nimport * as utils from './utils';\nimport * as consent from './consentManagement';\nimport { getRefererInfo } from './refererDetection';\nimport AbTesting from './abTesting';\nimport * as clientStore from './clientStore';\n\nexport const ID5 = getGlobal();\n\nID5.loaded = true;\nID5.initialized = false;\nID5.callbackFired = false;\n\n/**\n * This function will initialize ID5, wait for consent then try to fetch or refresh ID5 user id if required\n * @param {Id5Config} options\n * @alias module:ID5.init\n */\n// TODO: Use Async init by pushing setting in a queue\nID5.init = function (options) {\n  if (typeof ID5.version === 'undefined') {\n    throw new Error('ID5.version variable is missing! Make sure you build from source with \"gulp build\" from this project. Contact support@id5.io for help.');\n  }\n\n  try {\n    utils.logInfo('Invoking ID5.init', arguments);\n    ID5.initialized = true;\n    ID5.getConfig = config.getConfig;\n    ID5.getProvidedConfig = config.getProvidedConfig;\n    ID5.setConfig = config.setConfig;\n    ID5.setStoredConsentData = clientStore.putHashedConsentData;\n    ID5.setStoredPd = clientStore.putHashedPd;\n    ID5.abTesting = new AbTesting(options.abTesting);\n\n    this.getId(options, false);\n  } catch (e) {\n    utils.logError('Exception caught from ID5.init', e);\n  }\n};\n\nID5.exposeId = function() {\n  if (ID5.initialized !== true) {\n    throw new Error('ID5.refreshID() cannot be called before ID5.exposeId()!');\n  }\n  return ID5.abTesting.exposeId();\n}\n\nID5.refreshId = function (forceFetch = false, options = {}) {\n  if (ID5.initialized !== true) {\n    throw new Error('ID5.refreshID() cannot be called before ID5.init()!');\n  }\n\n  try {\n    utils.logInfo('Invoking ID5.refreshId', arguments);\n\n    if (!utils.isBoolean(forceFetch)) {\n      throw new Error('Invalid signature for ID5.refreshID: first parameter must be a boolean');\n    }\n\n    // consent may have changed, so we need to check it again\n    consent.resetConsentData();\n\n    this.getId(options, forceFetch);\n  } catch (e) {\n    utils.logError('Exception caught from ID5.refreshId', e);\n  }\n};\n\nID5.getId = function(options, forceFetch = false) {\n  ID5.config = config.setConfig(options);\n  ID5.callbackFired = false;\n  // @FIXME: Not required => Add doc to say that refresh does not change control group\n\n  const referer = getRefererInfo();\n  utils.logInfo(`ID5 detected referer is ${referer.referer}`);\n\n  if (!this.config.partnerId || typeof this.config.partnerId !== 'number') {\n    throw new Error('partnerId is required and must be a number');\n  }\n\n  // pick up data from local storage\n  // (will only read if local storage access is allowed)\n  const storedResponse = clientStore.getResponse();\n  const storedDateTime = clientStore.getDateTime();\n  const refreshInSecondsHasElapsed = storedDateTime <= 0 || ((Date.now() - storedDateTime) > (this.config.refreshInSeconds * 1000));\n  let nb = clientStore.getNb(this.config.partnerId);\n  ID5.fromCache = false;\n\n  // always save the current pd to track if it changes\n  // (will only read if local storage access is allowed)\n  const pd = this.config.pd || '';\n  const pdHasChanged = !clientStore.storedPdMatchesPd(pd);\n\n  // Callback watchdogs\n  if (utils.isFn(this.config.callback) && this.config.callbackTimeoutInMs >= 0) {\n    setTimeout(() => this.fireCallBack(), this.config.callbackTimeoutInMs);\n  }\n\n  // TEMPORARY until all clients have upgraded past v1.0.0\n  // remove cookies that were previously set\n  // @FIXME: There is a risk of clearing without storing in local storage\n  clientStore.removeLegacyCookies(this.config.partnerId);\n\n  if (storedResponse && !pdHasChanged) {\n    // we have a valid stored response and pd is not different, so\n    // use the stored response to make the ID available right away\n\n    if (storedResponse.universal_uid && this.exposeId()) {\n      ID5.userId = storedResponse.universal_uid;\n      ID5.linkType = storedResponse.link_type || 0;\n    } else if (storedResponse.universal_uid) {\n      // we're in A/B testing and this is the control group, so do\n      // not set a userId or linkType\n      ID5.userId = ID5.linkType = 0;\n    } else {\n      utils.logError('Invalid stored response: ', JSON.stringify(storedResponse));\n    }\n\n    nb = clientStore.incNb(this.config.partnerId, nb);\n    ID5.fromCache = true;\n    if (typeof ID5.userId !== 'undefined') {\n      this.fireCallBack();\n    }\n\n    utils.logInfo('ID5 User ID available from cache:', { storedResponse, storedDateTime, refreshNeeded: refreshInSecondsHasElapsed });\n  } else if (storedResponse && pdHasChanged) {\n    utils.logInfo('PD value has changed, so ignoring User ID from cache');\n  } else {\n    utils.logInfo('No ID5 User ID available from cache');\n  }\n\n  consent.requestConsent((consentData) => {\n    if (consent.isLocalStorageAllowed() !== false) {\n      utils.logInfo('Consent to access local storage is given: ', consent.isLocalStorageAllowed());\n\n      // @FIXME: If we had not consent before, we should read response/Nb/everything\n\n      // store hashed consent data and pd for future page loads\n      const consentHasChanged = !clientStore.storedConsentDataMatchesConsentData(consentData);\n      clientStore.putHashedConsentData(consentData);\n      clientStore.putHashedPd(pd);\n\n      // make a call to fetch a new ID5 ID if:\n      // - there is no valid universal_uid or no signature in cache\n      // - the last refresh was longer than refreshInSeconds ago\n      // - consent has changed since the last ID was fetched\n      // - pd has changed since the last ID was fetched\n      // - fetch is being forced (e.g. by refreshId())\n      if (\n        !storedResponse || !storedResponse.universal_uid || !storedResponse.signature ||\n        refreshInSecondsHasElapsed ||\n        consentHasChanged ||\n        pdHasChanged ||\n        forceFetch\n      ) {\n        const url = `https://id5-sync.com/g/v2/${this.config.partnerId}.json`;\n        const gdprApplies = (consentData && consentData.gdprApplies) ? 1 : 0;\n        const gdprConsentString = (consentData && consentData.gdprApplies) ? consentData.consentString : '';\n        const signature = (storedResponse && storedResponse.signature) ? storedResponse.signature : '';\n        const data = {\n          'partner': this.config.partnerId,\n          'v': ID5.version,\n          'o': 'api',\n          'gdpr': gdprApplies,\n          'gdpr_consent': gdprConsentString,\n          'rf': referer.referer,\n          'u': referer.stack[0] || window.location.href,\n          'top': referer.reachedTop ? 1 : 0,\n          's': signature,\n          'pd': pd,\n          'nbPage': nb,\n          'id5cdn': (document.currentScript && document.currentScript.src && document.currentScript.src.indexOf('https://cdn.id5-sync.com') === 0)\n        };\n        if (this.config.tpids && utils.isArray(this.config.tpids) && this.config.tpids.length > 0) {\n          data.tpids = this.config.tpids;\n        }\n\n        utils.logInfo('Fetching ID5 user ID from:', url, data);\n        if (forceFetch) {\n          utils.logInfo('...with Force Fetch');\n        }\n        utils.ajax(url, {\n          success: response => {\n            let responseObj;\n            if (response) {\n              try {\n                responseObj = JSON.parse(response);\n                utils.logInfo('Response from ID5 received:', responseObj);\n                if (responseObj.universal_uid) {\n                  if (this.exposeId()) {\n                    ID5.userId = responseObj.universal_uid;\n                    ID5.linkType = responseObj.link_type || 0\n                  } else {\n                    // we're in A/B testing and this is the control group, so do\n                    // not set a userId or linkType\n                    ID5.userId = ID5.linkType = 0;\n                  }\n\n                  // privacy has to be stored first so we can use it when storing other values\n                  consent.setStoredPrivacy(responseObj.privacy);\n\n                  // @TODO: typeof responseObj.privacy === 'undefined' is only needed until fetch endpoint is updated and always returns a privacy object\n                  // once it does, I don't see a reason to keep that part of the if clause\n                  if (consent.isLocalStorageAllowed() === true || typeof responseObj.privacy === 'undefined') {\n                    clientStore.putResponse(response);\n                    clientStore.setDateTime(Date.now());\n                    clientStore.setNb(this.config.partnerId, (ID5.fromCache ? 0 : 1));\n                  } else {\n                    clientStore.clearAll(this.config.partnerId);\n                  }\n\n                  // this must come after storing Nb or it will store the wrong value\n                  ID5.fromCache = false;\n\n                  if (responseObj.cascade_needed === true && consent.isLocalStorageAllowed() === true) {\n                    const isSync = this.config.partnerUserId && this.config.partnerUserId.length > 0;\n                    const syncUrl = `https://id5-sync.com/${isSync ? 's' : 'i'}/${this.config.partnerId}/8.gif?id5id=${ID5.userId}&fs=${clientStore.forceSync()}&o=api&${isSync ? 'puid=' + this.config.partnerUserId + '&' : ''}gdpr_consent=${gdprConsentString}&gdpr=${gdprApplies}`;\n                    utils.logInfo('Opportunities to cascade available:', syncUrl);\n                    utils.deferPixelFire(syncUrl, undefined, clientStore.syncCallback);\n                  }\n                  this.fireCallBack();\n                } else {\n                  utils.logError('Invalid response from ID5 servers:', response);\n                }\n              } catch (error) {\n                utils.logError(error);\n              }\n            } else {\n              utils.logError('Empty response from ID5 servers:', response);\n            }\n          },\n          error: error => {\n            utils.logError(error);\n          }\n        }, JSON.stringify(data), { method: 'POST', withCredentials: true });\n      }\n    } else {\n      utils.logInfo('No legal basis to use ID5', consentData);\n    }\n  });\n}\n\nID5.fireCallBack = function () {\n  if (!this.callbackFired && utils.isFn(this.config.callback)) {\n    utils.logInfo('Scheduling callback');\n    setTimeout(() => this.config.callback(ID5), 0);\n    this.callbackFired = true;\n  }\n}\n\nexport default ID5;\n\n\n\n// WEBPACK FOOTER //\n// ./src/id5-api.js","window.ID5 = (window.ID5 || {});\n\nexport function getGlobal() {\n  return window.ID5;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/id5-apiGlobal.js","/**\n * The referer detection module attempts to gather referer information from the current page that id5-api.js resides in.\n * The information that it tries to collect includes:\n * The detected top url in the nav bar,\n * Whether it was able to reach the top most window (if for example it was embedded in several iframes),\n * The number of iframes it was embedded in if applicable,\n * A list of the domains of each embedded window if applicable.\n * Canonical URL which refers to an HTML link element, with the attribute of rel=\"canonical\", found in the <head> element of your webpage\n */\n\nexport function detectReferer(win) {\n  /**\n   * Returns number of frames to reach top from current frame\n   * @returns {Array} levels\n   */\n  function getLevels() {\n    let levels = walkUpWindows();\n    let ancestors = getAncestorOrigins();\n\n    if (ancestors) {\n      for (let i = 0, l = ancestors.length; i < l; i++) {\n        levels[i].ancestor = ancestors[i];\n      }\n    }\n    return levels;\n  }\n\n  /**\n   * This function would return a read-only array of hostnames for all the parent frames.\n   * win.location.ancestorOrigins is only supported in webkit browsers. For non-webkit browsers it will return undefined.\n   * @returns {(undefined|Array)} Ancestor origins or undefined\n   */\n  function getAncestorOrigins() {\n    try {\n      if (!win.location.ancestorOrigins) {\n        return;\n      }\n      return win.location.ancestorOrigins;\n    } catch (e) {\n      // Ignore error\n    }\n  }\n\n  /**\n   * This function would try to get referer and urls for all parent frames in case of win.location.ancestorOrigins undefined.\n   * @param {Array} levels\n   * @returns {Object} urls for all parent frames and top most detected referer url\n   */\n  function getPubUrlStack(levels) {\n    let stack = [];\n    let defUrl = null;\n    let frameLocation = null;\n    let prevFrame = null;\n    let prevRef = null;\n    let ancestor = null;\n    let detectedRefererUrl = null;\n\n    let i;\n    for (i = levels.length - 1; i >= 0; i--) {\n      try {\n        frameLocation = levels[i].location;\n      } catch (e) {\n        // Ignore error\n      }\n\n      if (frameLocation) {\n        stack.push(frameLocation);\n        if (!detectedRefererUrl) {\n          detectedRefererUrl = frameLocation;\n        }\n      } else if (i !== 0) {\n        prevFrame = levels[i - 1];\n        try {\n          prevRef = prevFrame.referrer;\n          ancestor = prevFrame.ancestor;\n        } catch (e) {\n          // Ignore error\n        }\n\n        if (prevRef) {\n          stack.push(prevRef);\n          if (!detectedRefererUrl) {\n            detectedRefererUrl = prevRef;\n          }\n        } else if (ancestor) {\n          stack.push(ancestor);\n          if (!detectedRefererUrl) {\n            detectedRefererUrl = ancestor;\n          }\n        } else {\n          stack.push(defUrl);\n        }\n      } else {\n        stack.push(defUrl);\n      }\n    }\n    return {\n      stack,\n      detectedRefererUrl\n    };\n  }\n\n  /**\n   * This function returns canonical URL which refers to an HTML link element, with the attribute of rel=\"canonical\", found in the <head> element of your webpage\n   * @param {Object} doc document\n   */\n  function getCanonicalUrl(doc) {\n    try {\n      let element = doc.querySelector(\"link[rel='canonical']\");\n      if (element !== null) {\n        return element.href;\n      }\n    } catch (e) {\n    }\n    return null;\n  }\n\n  /**\n   * Walk up to the top of the window to detect origin, number of iframes, ancestor origins and canonical url\n   */\n  function walkUpWindows() {\n    let acc = [];\n    let currentWindow;\n    do {\n      try {\n        currentWindow = currentWindow ? currentWindow.parent : win;\n        try {\n          let isTop = (currentWindow === win.top);\n          let refData = {\n            referrer: currentWindow.document.referrer || null,\n            location: currentWindow.location.href || null,\n            isTop\n          }\n          if (isTop) {\n            refData = Object.assign(refData, {\n              canonicalUrl: getCanonicalUrl(currentWindow.document)\n            })\n          }\n          acc.push(refData);\n        } catch (e) {\n          acc.push({\n            referrer: null,\n            location: null,\n            isTop: (currentWindow === win.top)\n          });\n        }\n      } catch (e) {\n        acc.push({\n          referrer: null,\n          location: null,\n          isTop: false\n        });\n        return acc;\n      }\n    } while (currentWindow !== win.top);\n    return acc;\n  }\n\n  /**\n   * Referer info\n   * @typedef {Object} refererInfo\n   * @property {string} referer detected top url\n   * @property {boolean} reachedTop whether it was possible to walk upto top window or not\n   * @property {number} numIframes number of iframes\n   * @property {string} stack comma separated urls of all origins\n   * @property {string} canonicalUrl canonical URL refers to an HTML link element, with the attribute of rel=\"canonical\", found in the <head> element of your webpage\n   */\n\n  /**\n   * Get referer info\n   * @returns {refererInfo}\n   */\n  function refererInfo() {\n    try {\n      let levels = getLevels();\n      let numIframes = levels.length - 1;\n      let reachedTop = (levels[numIframes].location !== null ||\n        (numIframes > 0 && levels[numIframes - 1].referrer !== null));\n      let stackInfo = getPubUrlStack(levels);\n      let canonicalUrl;\n      if (levels[levels.length - 1].canonicalUrl) {\n        canonicalUrl = levels[levels.length - 1].canonicalUrl;\n      }\n\n      return {\n        referer: stackInfo.detectedRefererUrl,\n        reachedTop,\n        numIframes,\n        stack: stackInfo.stack,\n        canonicalUrl\n      };\n    } catch (e) {\n      // Ignore error\n    }\n  }\n\n  return refererInfo;\n}\n\nexport const getRefererInfo = detectReferer(window);\n\n\n\n// WEBPACK FOOTER //\n// ./src/refererDetection.js","/*\n * Module for managing A/B Testing\n */\n\nimport { isNumber } from './utils';\n\nexport class AbTesting {\n  /** @type boolean */\n  controlGroup = false;\n\n  /**\n   * @typedef {Object} AbTestConfig\n   * @property {boolean|false} [enabled] - Enable control group\n   * @property {number} [controlGroupPct] - Ratio of users in control group [0,1]\n   */\n\n  /** @param {AbTestConfig} [abConfig] */\n  constructor(abConfig) {\n    if (abConfig && abConfig.enabled === true &&\n      (!isNumber(abConfig.controlGroupPct) ||\n        abConfig.controlGroupPct < 0 ||\n        abConfig.controlGroupPct > 1)\n    ) {\n      throw new Error('A/B Testing controlGroupPct must be a number >= 0 and <= 1');\n    }\n\n    if (abConfig && abConfig.enabled === true) {\n      this.controlGroup = Math.random() < abConfig.controlGroupPct;\n    }\n  }\n\n  exposeId() {\n    return typeof this.controlGroup !== 'boolean' || this.controlGroup === false;\n  }\n}\n\nexport default AbTesting;\n\n\n\n// WEBPACK FOOTER //\n// ./src/abTesting.js","/*\n * Module for managing storage of information in browser Local Storage and/or cookies\n */\n\nimport * as consent from './consentManagement';\nimport * as utils from './utils';\nimport CONSTANTS from './constants.json';\n\n/**\n * Get stored data from local storage, if any, after checking if local storage is allowed\n * @param {{name: string, expiresDays: number}} cacheConfig\n * @returns {string|null|undefined} the stored value, null if no value or expired were stored, undefined if no consent or no access to localStorage\n */\nfunction get(cacheConfig) {\n  try {\n    if (consent.isLocalStorageAllowed() === true) {\n      return utils.getFromLocalStorage(cacheConfig);\n    }\n  } catch (e) {\n    utils.logError(e);\n  }\n}\n\n/**\n * clear stored data from local storage, if any\n * @param {StoreItem} cacheConfig\n */\nfunction clear(cacheConfig) {\n  try {\n    utils.removeFromLocalStorage(cacheConfig);\n  } catch (e) {\n    utils.logError(e);\n  }\n}\n\n/**\n * puts the current data into local storage, after checking for local storage access\n * @param {StoreItem} cacheConfig\n * @param {string} data\n */\nfunction put(cacheConfig, data) {\n  try {\n    if (consent.isLocalStorageAllowed() === true) {\n      utils.setInLocalStorage(cacheConfig, data);\n    }\n  } catch (e) {\n    utils.logError(e);\n  }\n}\n\nfunction getResponseFromLegacyCookie() {\n  let legacyStoredValue;\n  CONSTANTS.LEGACY_COOKIE_NAMES.forEach(function(cookie) {\n    if (utils.getCookie(cookie)) {\n      legacyStoredValue = utils.getCookie(cookie);\n    }\n  });\n  return legacyStoredValue || null;\n}\n\nexport function getResponse() {\n  return JSON.parse(get(CONSTANTS.STORAGE_CONFIG.ID5) || getResponseFromLegacyCookie());\n}\n\nexport function clearResponse() {\n  clear(CONSTANTS.STORAGE_CONFIG.ID5);\n}\n\nexport function putResponse(response) {\n  put(CONSTANTS.STORAGE_CONFIG.ID5, response);\n}\n\nfunction getHashedConsentData() {\n  return get(CONSTANTS.STORAGE_CONFIG.CONSENT_DATA);\n}\n\nexport function clearHashedConsentData() {\n  clear(CONSTANTS.STORAGE_CONFIG.CONSENT_DATA);\n}\n\nexport function putHashedConsentData(consentData) {\n  put(CONSTANTS.STORAGE_CONFIG.CONSENT_DATA, makeStoredConsentDataHash(consentData));\n}\n\nfunction getHashedPd() {\n  return get(CONSTANTS.STORAGE_CONFIG.PD);\n}\n\nexport function clearHashedPd() {\n  clear(CONSTANTS.STORAGE_CONFIG.PD);\n}\n\nexport function putHashedPd(pd) {\n  // @FIXME: per partner storage\n  put(CONSTANTS.STORAGE_CONFIG.PD, makeStoredPdHash(pd));\n}\n\nexport function getDateTime() {\n  return (new Date(+get(CONSTANTS.STORAGE_CONFIG.LAST))).getTime()\n}\n\nexport function clearDateTime() {\n  clear(CONSTANTS.STORAGE_CONFIG.LAST);\n}\n\nexport function setDateTime(timestamp) {\n  put(CONSTANTS.STORAGE_CONFIG.LAST, timestamp);\n}\n\nfunction nbCacheConfig(partnerId) {\n  return {\n    name: `${CONSTANTS.STORAGE_CONFIG.ID5.name}_${partnerId}_nb`,\n    expiresDays: CONSTANTS.STORAGE_CONFIG.ID5.expiresDays\n  }\n}\n\nexport function getNb(partnerId) {\n  const cachedNb = get(nbCacheConfig(partnerId));\n  return (cachedNb) ? parseInt(cachedNb) : 0;\n}\n\nfunction clearNb(partnerId) {\n  clear(nbCacheConfig(partnerId));\n}\n\nexport function setNb(partnerId, nb) {\n  put(nbCacheConfig(partnerId), nb);\n}\n\nexport function incNb(partnerId, nb) {\n  nb++;\n  setNb(partnerId, nb);\n  return nb;\n}\n\nexport function syncCallback() {\n  put(CONSTANTS.STORAGE_CONFIG.FS, '1');\n}\n\nexport function forceSync() {\n  const cachedFs = get(CONSTANTS.STORAGE_CONFIG.FS);\n  // Force cascade if we have access to Local Storage and we never cascaded\n  return (typeof cachedFs === 'undefined' || cachedFs === '1') ? 0 : 1;\n}\n\nexport function clearAll(partnerId) {\n  clearResponse();\n  clearDateTime();\n  clearNb(partnerId);\n  clearHashedPd();\n  clearHashedConsentData();\n}\n\nexport function removeLegacyCookies(partnerId) {\n  const expired = (new Date(Date.now() - 1000)).toUTCString();\n  CONSTANTS.LEGACY_COOKIE_NAMES.forEach(function(cookie) {\n    utils.setCookie(`${cookie}`, '', expired);\n    utils.setCookie(`${cookie}_nb`, '', expired);\n    utils.setCookie(`${cookie}_${partnerId}_nb`, '', expired);\n    utils.setCookie(`${cookie}_last`, '', expired);\n    utils.setCookie(`${cookie}.cached_pd`, '', expired);\n    utils.setCookie(`${cookie}.cached_consent_data`, '', expired);\n  });\n}\n\n/**\n * test if the data stored locally matches the current data.\n * if there is nothing in storage, return true and we'll do an actual comparison next time.\n * this way, we don't force a refresh for every user when this code rolls out\n * @param storedData\n * @param currentData\n * @returns {boolean}\n */\nfunction storedDataMatchesCurrentData(storedData, currentData) {\n  return (\n    typeof storedData === 'undefined' ||\n    storedData === null ||\n    storedData === currentData\n  );\n}\nexport function storedConsentDataMatchesConsentData(consentData) {\n  return storedDataMatchesCurrentData(getHashedConsentData(), makeStoredConsentDataHash(consentData));\n}\nexport function storedPdMatchesPd(pd) {\n  return storedDataMatchesCurrentData(getHashedPd(), makeStoredPdHash(pd));\n}\n\n/**\n * makes an object that can be stored with only the keys we need to check.\n * excluding the vendorConsents object since the consentString is enough to know\n * if consent has changed without needing to have all the details in an object\n * @param consentData\n * @returns string\n */\nfunction makeStoredConsentDataHash(consentData) {\n  const storedConsentData = {\n    consentString: '',\n    gdprApplies: false,\n    apiVersion: 0\n  };\n\n  if (consentData) {\n    storedConsentData.consentString = consentData.consentString;\n    storedConsentData.gdprApplies = consentData.gdprApplies;\n    storedConsentData.apiVersion = consentData.apiVersion;\n  }\n\n  return utils.cyrb53Hash(JSON.stringify(storedConsentData));\n}\n\n/**\n * creates a hash of pd for storage\n * @param pd\n * @returns string\n */\nfunction makeStoredPdHash(pd) {\n  return utils.cyrb53Hash(typeof pd === 'string' ? pd : '');\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/clientStore.js"],"sourceRoot":""}