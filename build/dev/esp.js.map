{"version":3,"sources":["webpack:///webpack/bootstrap 545aac3fded4da6ef64b","webpack:///./lib/utils.js","webpack:///./lib/constants.json","webpack:///./lib/consentManagement.js","webpack:///./lib/clientStore.js","webpack:///./lib/localStorage.js","webpack:///./lib/config.js","webpack:///./src/esp.js","webpack:///./lib/id5-api.js","webpack:///./lib/refererDetection.js","webpack:///./lib/id5Status.js","webpack:///./generated/version.js"],"names":["tArr","tStr","tFn","tNumb","tObject","tBoolean","toString","Object","prototype","isParamDebug","getParameterByName","toUpperCase","isParamTrace","consoleExists","Boolean","window","console","isDebug","replaceTokenInString","str","map","token","_each","value","key","undefined","keyString","re","RegExp","replace","all","array","fn","result","logInfo","invocationId","messages","doLog","info","logWarn","warn","logError","error","consoleMethod","prefix","isGlobalDebug","apply","concat","setGlobalDebug","isGlobalTrace","name","regexS","regex","results","exec","location","search","decodeURIComponent","isA","object","_t","call","isFn","isStr","isArray","isNumber","isPlainObject","isBoolean","isDefined","isEmpty","length","k","hasOwnProperty","forEach","l","getCookie","m","document","cookie","match","setCookie","expires","encodeURIComponent","parseQS","query","split","reduce","acc","criteria","v","test","push","formatQS","keys","Array","join","parse","url","options","parsed","createElement","noDecodeWholeURL","href","qsAsString","decodeSearchAsString","protocol","hostname","port","pathname","hash","host","format","obj","XHR_DONE","ajax","callback","data","x","method","parser","callbacks","success","e","XMLHttpRequest","onreadystatechange","readyState","status","responseText","statusText","ontimeout","timeout","urlInfo","open","withCredentials","customHeaders","header","setRequestHeader","preflight","contentType","send","fireAsyncPixel","syncUrl","initCallBack","img","Image","src","complete","addEventListener","deferPixelFire","loadedCallback","cyrb53Hash","seed","imul","opA","opB","Math","h1","h2","i","ch","charCodeAt","delve","def","p","undef","ID5_GVL_ID","USPAPI_VERSION","SURROGATE_CONFIG","tcfv1","objName","objKeys","returnObjName","tcfv2","uspv1","API_TYPE","freeze","NONE","TCF_V1","TCF_V2","USP_V1","ID5_ALLOWED_VENDORS","GRANT_TYPE","FORCE_ALLOWED_BY_CONFIG","ID5_CONSENT","PROVISIONAL","JURISDICTION","CONSENT_API","LocalStorageGrant","allowed","grantType","api","ConsentData","isGranted","gdprApplies","allowedVendors","includes","vendorData","ccpaString","others","JSON","stringify","ConsentManagement","localStorage","resetConsentData","debugBypassConsent","cmpApi","providedConsentData","finalCallback","consentData","_consentRequested","parseStaticConsentData","lookupIabConsent","mergeData","getConsentData","parseTcfData","getTCData","item","String","getUSPData","parseUspData","self","done","makeCallback","callbackPos","every","d","callbackTcf","callbackUsp","lookupTcf","lookupUsp","findUsp","uspapiFrame","uspapiFunction","uspFn","buildCmpSurrogate","uspCallback","consentResponse","findTCF","cmpVersion","cmpFrame","cmpFunction","lookupDirectTcf","lookupMessageTcf","cmpResponse","logcb","version","logNoSuccess","makeV1Callback","verb","values","v2CmpResponseCallback","tcfData","eventStatus","consentDataCallback","vendorConsentsCallback","storedPrivacyData","allowLocalStorageWithoutConsentApi","privacyData","getItemWithExpiration","CONSTANTS","STORAGE_CONFIG","PRIVACY","id5_consent","jurisdiction","jurisdictionRequiresConsent","JURISDICTIONS","localStorageGrant","privacy","setItemWithExpiration","typeOfCall","apiFrame","param0","param1","messageCallback","callId","random","config","msg","requestObj","eventHandler","event","removeEventListener","returnValue","postMessage","consentObject","uspString","hasCcpaString","isValid","normalizeFn","isValidV1ConsentObject","normalizeV1Data","isValidV2ConsentObject","normalizeV2Data","getVendorConsents","tcString","cmpConsentObject","consentString","f","__tcfapi","__cmp","frames","top","parent","__uspapi","ClientStore","localStorageGrantChecker","cacheConfig","isDefinitivelyAllowed","removeItemWithExpiration","isAvailable","legacyStoredValue","LEGACY_COOKIE_NAMES","storedValue","get","ID5","clear","response","put","CONSENT_DATA","hashCode","partnerId","pdCacheConfig","pd","storedDataMatchesCurrentData","getHashedPd","makeStoredHash","Date","LAST","getTime","timestamp","cachedNb","nbCacheConfig","parseInt","nb","setNb","clearResponse","clearDateTime","clearNb","clearHashedPd","clearHashedConsentData","expired","now","toUTCString","getHashedConsentData","PD","expiresDays","userId","storedData","currentData","EXP_SUFFIX","LocalStorage","win","writingEnabled","setItem","removeItem","available","getItem","storedValueExp","isExpired","expirationInMs","expiresStr","dateValue","Config","refreshInSeconds","partnerUserId","callbackOnAvailable","callbackOnUpdates","callbackTimeoutInMs","abTesting","enabled","controlGroupPct","provider","maxCascades","applyCreativeRestrictions","segments","providedOptions","Error","invalidSegments","updOptions","acceptOption","topic","logTypeError","segment","index","locator","expectedType","configTypes","gt","googletag","encryptedSignalProviders","id","collectorFunction","INCREMENT_URL","Promise","resolve","reject","ID5EspConfig","afterAjax","init","onAvailable","id5Status","getUserId","Id5Api","currentVersion","loaded","_isUsingCdn","currentScript","indexOf","_referer","getRefererInfo","versions","passedOptions","_version","getOptions","consentManagement","clientStore","partnerStatus","Id5Status","getId","referer","forceFetch","arguments","startRefresh","updateOptions","storedResponse","storedDateTime","refreshInSecondsHasElapsed","pdHasChanged","cachedResponseUsed","getResponse","getDateTime","getNb","storedPdMatchesPd","getResponseFromLegacyCookie","universal_uid","refreshNeeded","setUserId","incNb","requestConsent","consentHasChanged","storedConsentDataMatchesConsentData","putHashedConsentData","putHashedPd","missingStoredData","signature","stack","reachedTop","isLocalStorageAvailable","navigator","userAgent","gdprConsentString","gdpr_consent","allowed_vendors","s","us_privacy","entries","entry","optKey","dataKey","ab_testing","control_group_pct","getInvalidSegments","_invalid_segments","_trace","responseObj","setStoredPrivacy","putResponse","setDateTime","clearAll","removeLegacyCookies","cascade_needed","isSync","_userId","detectReferer","getLevels","levels","walkUpWindows","ancestors","getAncestorOrigins","ancestor","ancestorOrigins","getPubUrlStack","defUrl","frameLocation","prevFrame","prevRef","detectedRefererUrl","referrer","getCanonicalUrl","doc","element","querySelector","currentWindow","isTop","refData","canonicalUrl","refererInfo","numIframes","stackInfo","_isRefreshing","_isRefreshingWithFetch","fromCache","_this","linkType","link_type","_isExposed","hasChanged","_linkType","_userIdAvailable","_fromCache","_availableCallback","_availableCallbackFired","_availableCallbackTimerId","clearTimeout","setTimeout","doFireOnAvailableCallBack","_refreshCallback","_refreshCallbackFired","_refreshCallbackTimerId","doFireOnRefreshCallBack","_updateCallback","doFireOnUpdateCallBack","source","ID5_EIDS_SOURCE","uids","atype","ext","getLinkType","abTestingControlGroup","exposeUserId","currentThis","message","currentId5Status"],"mappings":"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","file":"esp.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 6);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 545aac3fded4da6ef64b","const tArr = 'Array';\nconst tStr = 'String';\nconst tFn = 'Function';\nconst tNumb = 'Number';\nconst tObject = 'Object';\nconst tBoolean = 'Boolean';\nconst toString = Object.prototype.toString;\nconst isParamDebug = getParameterByName('id5_debug').toUpperCase() === 'TRUE';\nconst isParamTrace = getParameterByName('id5_debug').toUpperCase() === 'TRACE';\nconst consoleExists = Boolean(window.console);\n\nlet isDebug = false;\n\n/*\n *   Substitutes into a string from a given map using the token\n *   Usage\n *   var str = 'text %%REPLACE%% this text with %%SOMETHING%%';\n *   var map = {};\n *   map['replace'] = 'it was subbed';\n *   map['something'] = 'something else';\n *   console.log(replaceTokenInString(str, map, '%%')); => \"text it was subbed this text with something else\"\n */\nexport function replaceTokenInString(str, map, token) {\n  _each(map, function (value, key) {\n    value = (value === undefined) ? '' : value;\n\n    let keyString = token + key.toUpperCase() + token;\n    let re = new RegExp(keyString, 'g');\n\n    str = str.replace(re, value);\n  });\n\n  return str;\n}\n\nexport function all(array, fn) {\n  let result = true;\n  _each(array, (value) => (result = result && fn(value)));\n  return result;\n}\n\n/**\n * Wrappers to console.(log | info | warn | error). Takes N arguments, the same as the native methods\n */\nexport function logInfo(invocationId, ...messages) {\n  doLog(console.info, invocationId, 'INFO', messages);\n}\n\nexport function logWarn(invocationId, ...messages) {\n  doLog(console.warn, invocationId, 'WARNING', messages);\n}\n\nexport function logError(invocationId, ...messages) {\n  doLog(console.error, invocationId, 'ERROR', messages);\n}\n\nfunction doLog(consoleMethod, invocationId, prefix, messages) {\n  if (isGlobalDebug() && consoleExists && consoleMethod) {\n    consoleMethod.apply(console, [`%cID5 - #${invocationId}`,\n      'color: #fff; background: #1c307e; padding: 1px 4px; border-radius: 3px;',\n      prefix].concat(messages));\n  }\n}\n\nexport function setGlobalDebug(value) {\n  isDebug = !!value;\n}\n\nexport function isGlobalDebug() {\n  return isParamDebug || isParamTrace || isDebug;\n}\n\nexport function isGlobalTrace() {\n  return isParamTrace;\n}\n\n/*\n *   Check if a given parameter name exists in query string\n *   and if it does return the value\n */\nexport function getParameterByName(name) {\n  const regexS = '[\\\\?&]' + name + '=([^&#]*)';\n  const regex = new RegExp(regexS);\n  const results = regex.exec(window.location.search);\n  if (results === null) {\n    return '';\n  }\n\n  return decodeURIComponent(results[1].replace(/\\+/g, ' '));\n}\n\n/**\n * Return if the object is of the\n * given type.\n * @param {*} object to test\n * @param {String} _t type string (e.g., Array)\n * @return {Boolean} if object is of type _t\n */\nexport function isA(object, _t) {\n  return toString.call(object) === '[object ' + _t + ']';\n}\n\nexport function isFn(object) {\n  return isA(object, tFn);\n}\n\nexport function isStr(object) {\n  return isA(object, tStr);\n}\n\nexport function isArray(object) {\n  return isA(object, tArr);\n}\n\nexport function isNumber(object) {\n  return isA(object, tNumb);\n}\n\nexport function isPlainObject(object) {\n  return isA(object, tObject);\n}\n\nexport function isBoolean(object) {\n  return isA(object, tBoolean);\n}\n\nexport function isDefined(object) {\n  return typeof object !== 'undefined';\n}\n\n/**\n * Return if the object is \"empty\";\n * this includes falsey, no keys, or no items at indices\n * @param {*} object object to test\n * @return {Boolean} if object is empty\n */\nexport function isEmpty(object) {\n  if (!object) return true;\n  if (isArray(object) || isStr(object)) {\n    return !(object.length > 0);\n  }\n\n  for (let k in object) {\n    if (hasOwnProperty.call(object, k)) return false;\n  }\n\n  return true;\n}\n\n/**\n * Iterate object with the function\n * falls back to es5 `forEach`\n * @param {Array|Object} object\n * @param {function(value, key, object)} fn\n */\nfunction _each(object, fn) {\n  if (isEmpty(object)) return;\n  if (isFn(object.forEach)) return object.forEach(fn, this);\n\n  let k = 0;\n  let l = object.length;\n\n  if (l > 0) {\n    for (; k < l; k++) fn(object[k], k, object);\n  } else {\n    for (k in object) {\n      if (hasOwnProperty.call(object, k)) fn.call(this, object[k], k);\n    }\n  }\n}\n\nexport function getCookie(name) {\n  let m = window.document.cookie.match('(^|;)\\\\s*' + name + '\\\\s*=\\\\s*([^;]*)\\\\s*(;|$)');\n  return m ? decodeURIComponent(m[2]) : null;\n}\n\nexport function setCookie(key, value, expires) {\n  document.cookie = `${key}=${encodeURIComponent(value)}${(expires !== '') ? `; expires=${expires}` : ''}; path=/`;\n}\n\nexport function parseQS(query) {\n  return !query ? {} : query\n    .replace(/^\\?/, '')\n    .split('&')\n    .reduce((acc, criteria) => {\n      let [k, v] = criteria.split('=');\n      if (/\\[\\]$/.test(k)) {\n        k = k.replace('[]', '');\n        acc[k] = acc[k] || [];\n        acc[k].push(v);\n      } else {\n        acc[k] = v || '';\n      }\n      return acc;\n    }, {});\n}\n\nexport function formatQS(query) {\n  return Object\n    .keys(query)\n    .map(k => Array.isArray(query[k])\n      ? query[k].map(v => `${k}[]=${v}`).join('&')\n      : `${k}=${query[k]}`)\n    .join('&');\n}\n\nexport function parse(url, options) {\n  let parsed = document.createElement('a');\n  if (options && 'noDecodeWholeURL' in options && options.noDecodeWholeURL) {\n    parsed.href = url;\n  } else {\n    parsed.href = decodeURIComponent(url);\n  }\n  // in window.location 'search' is string, not object\n  let qsAsString = (options && 'decodeSearchAsString' in options && options.decodeSearchAsString);\n  return {\n    href: parsed.href,\n    protocol: (parsed.protocol || '').replace(/:$/, ''),\n    hostname: parsed.hostname,\n    port: +parsed.port,\n    pathname: parsed.pathname.replace(/^(?!\\/)/, '/'),\n    search: (qsAsString) ? parsed.search : parseQS(parsed.search || ''),\n    hash: (parsed.hash || '').replace(/^#/, ''),\n    host: parsed.host || window.location.host\n  };\n}\n\nexport function format(obj) {\n  return (obj.protocol || 'http') + '://' +\n    (obj.host ||\n        obj.hostname + (obj.port ? `:${obj.port}` : '')) +\n    (obj.pathname || '') +\n    (obj.search ? `?${formatQS(obj.search || '')}` : '') +\n    (obj.hash ? `#${obj.hash}` : '');\n}\n\nconst XHR_DONE = 4;\n\n/**\n * Simple IE9+ and cross-browser ajax request function\n * Note: x-domain requests in IE9 do not support the use of cookies\n *\n * @param url string url\n * @param callback {object | function} callback\n * @param data mixed data\n * @param options object\n */\nexport function ajax(url, callback, data, options = {}) {\n  try {\n    let x;\n    let method = options.method || (data ? 'POST' : 'GET');\n    let parser = document.createElement('a');\n    parser.href = url;\n\n    let callbacks = typeof callback === 'object' && callback !== null ? callback : {\n      success: function() {\n        logInfo('ajax', 'xhr success');\n      },\n      error: function(e) {\n        logError('ajax', 'xhr error', null, e);\n      }\n    };\n\n    if (typeof callback === 'function') {\n      callbacks.success = callback;\n    }\n\n    x = new window.XMLHttpRequest();\n\n    x.onreadystatechange = function () {\n      if (x.readyState === XHR_DONE) {\n        let status = x.status;\n        if ((status >= 200 && status < 300) || status === 304) {\n          callbacks.success(x.responseText, x);\n        } else {\n          callbacks.error(x.statusText, x);\n        }\n      }\n    };\n\n    x.ontimeout = function () {\n      logError('ajax', 'xhr timeout after ', x.timeout, 'ms');\n    };\n\n    if (method === 'GET' && data) {\n      let urlInfo = parse(url, options);\n      Object.assign(urlInfo.search, data);\n      url = format(urlInfo);\n    }\n\n    x.open(method, url, true);\n\n    if (options.withCredentials) {\n      x.withCredentials = true;\n    }\n    _each(options.customHeaders, (value, header) => {\n      x.setRequestHeader(header, value);\n    });\n    if (options.preflight) {\n      x.setRequestHeader('X-Requested-With', 'XMLHttpRequest');\n    }\n    x.setRequestHeader('Content-Type', options.contentType || 'text/plain');\n\n    if (method === 'POST' && data) {\n      x.send(data);\n    } else {\n      x.send();\n    }\n  } catch (error) {\n    logError('ajax', 'xhr construction', error);\n  }\n}\n\n/**\n * add an Image pixel to the DOM for the given sync Url\n *\n * @param syncUrl\n * @param initCallBack Called when pixel is initiated. Always called. Optional\n * @param callback Called when pixel is loaded. May never be called. Optional\n */\nexport function fireAsyncPixel(syncUrl, initCallBack, callback) {\n  let img = new Image();\n  img.src = syncUrl;\n  if (isFn(initCallBack)) {\n    initCallBack();\n  }\n  if (isFn(callback)) {\n    if (img.complete) {\n      callback();\n    } else {\n      img.addEventListener('load', callback);\n    }\n  }\n}\n\n/**\n * wait until the page finishes loading and then fire a pixel\n *\n * @param syncUrl\n * @param initCallBack Called when pixel is initiated. Optional\n * @param loadedCallback Called when pixel is loaded (may never be called). Optional\n */\nexport function deferPixelFire(syncUrl, initCallBack, loadedCallback) {\n  if (document.readyState !== 'loading') {\n    fireAsyncPixel(syncUrl, initCallBack, loadedCallback);\n  } else {\n    document.addEventListener('DOMContentLoaded', function () {\n      fireAsyncPixel(syncUrl, initCallBack, loadedCallback);\n    });\n  }\n}\n\n/**\n * returns a hash of a string using a fast algorithm\n * source: https://stackoverflow.com/a/52171480/845390\n * @param {string} str\n * @param {number} [seed] (optional)\n * @returns {string}\n */\nexport function cyrb53Hash(str, seed = 0) {\n  // IE doesn't support imul\n  // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/imul#Polyfill\n  let imul = function(opA, opB) {\n    if (isFn(Math.imul)) {\n      return Math.imul(opA, opB);\n    } else {\n      opB |= 0; // ensure that opB is an integer. opA will automatically be coerced.\n      // floating points give us 53 bits of precision to work with plus 1 sign bit\n      // automatically handled for our convienence:\n      // 1. 0x003fffff /*opA & 0x000fffff*/ * 0x7fffffff /*opB*/ = 0x1fffff7fc00001\n      //    0x1fffff7fc00001 < Number.MAX_SAFE_INTEGER /*0x1fffffffffffff*/\n      var result = (opA & 0x003fffff) * opB;\n      // 2. We can remove an integer coersion from the statement above because:\n      //    0x1fffff7fc00001 + 0xffc00000 = 0x1fffffff800001\n      //    0x1fffffff800001 < Number.MAX_SAFE_INTEGER /*0x1fffffffffffff*/\n      if (opA & 0xffc00000) result += (opA & 0xffc00000) * opB | 0;\n      return result | 0;\n    }\n  };\n\n  let h1 = 0xdeadbeef ^ seed;\n  let h2 = 0x41c6ce57 ^ seed;\n  for (let i = 0, ch; i < str.length; i++) {\n    ch = str.charCodeAt(i);\n    h1 = imul(h1 ^ ch, 2654435761);\n    h2 = imul(h2 ^ ch, 1597334677);\n  }\n  h1 = imul(h1 ^ (h1 >>> 16), 2246822507) ^ imul(h2 ^ (h2 >>> 13), 3266489909);\n  h2 = imul(h2 ^ (h2 >>> 16), 2246822507) ^ imul(h1 ^ (h1 >>> 13), 3266489909);\n  return (4294967296 * (2097151 & h2) + (h1 >>> 0)).toString();\n}\n\n/**\n * License for dlv: https://github.com/developit/dlv\n * Copyright (c) 2021 Jason Miller\n * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the \"Software\"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:\n * The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n*/\nexport function delve(obj, key, def, p, undef) {\n  key = key.split ? key.split('.') : key;\n  for (p = 0; p < key.length; p++) {\n    obj = obj ? obj[key[p]] : undef;\n  }\n  return obj === undef ? def : obj;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/utils.js","module.exports = {\"STORAGE_CONFIG\":{\"ID5\":{\"name\":\"id5id\",\"expiresDays\":90},\"LAST\":{\"name\":\"id5id_last\",\"expiresDays\":90},\"CONSENT_DATA\":{\"name\":\"id5id_cached_consent_data\",\"expiresDays\":30},\"PD\":{\"name\":\"id5id_cached_pd\",\"expiresDays\":30},\"PRIVACY\":{\"name\":\"id5id_privacy\",\"expiresDays\":30}},\"LEGACY_COOKIE_NAMES\":[\"id5.1st\",\"id5id.1st\"],\"PRIVACY\":{\"JURISDICTIONS\":{\"gdpr\":true,\"ccpa\":false,\"lgpd\":true,\"other\":false}},\"ID5_EIDS_SOURCE\":\"id5-sync.com\"}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./lib/constants.json\n// module id = 1\n// module chunks = 0","import {\n  logError,\n  logWarn,\n  logInfo,\n  isPlainObject,\n  isStr,\n  isFn,\n  isBoolean,\n  delve,\n  isArray,\n  cyrb53Hash,\n  isDefined\n} from './utils.js';\nimport CONSTANTS from './constants.json';\n\n/* eslint-disable no-unused-vars */\nimport LocalStorage from './localStorage.js';\n/* eslint-enable no-unused-vars */\n\nconst ID5_GVL_ID = '131';\nconst USPAPI_VERSION = 1;\nconst SURROGATE_CONFIG = {\n  tcfv1: {\n    objName: '__cmpCall',\n    objKeys: ['command', 'parameter'],\n    returnObjName: '__cmpReturn'\n  },\n  tcfv2: {\n    objName: '__tcfapiCall',\n    objKeys: ['command', 'version'],\n    returnObjName: '__tcfapiReturn'\n  },\n  uspv1: {\n    objName: '__uspapiCall',\n    objKeys: ['command', 'version'],\n    returnObjName: '__uspapiReturn'\n  }\n};\n\nexport const API_TYPE = Object.freeze({\n  NONE: 'none',\n  TCF_V1: 'TCFv1',\n  TCF_V2: 'TCFv2',\n  USP_V1: 'USPv1',\n  ID5_ALLOWED_VENDORS: 'ID5'\n});\n\n/**\n * The GRANT_TYPE tells how the grant to local storage was computed\n * FORCE_ALLOWED_BY_CONFIG - when configuration forces to allow usage of local storage\n * ID5_CONSENT - when either in stored or in received privacy object,\n *               ID5 has consent to use local storage.\n * PROVISIONAL - We don't know yet whether we're granted access by consent.\n *               We allow access but restrictions apply. See isDefinitivelyAllowed().\n * JURISDICTION - The decision was based on the basis of the jurisdiction which\n *                is returned by the ID5 server (or stored from previous calls).\n * CONSENT_API - The decision was based on one of the various consent APIs we interact with.\n */\nexport const GRANT_TYPE = Object.freeze({\n  FORCE_ALLOWED_BY_CONFIG: 'force_allowed_by_config',\n  ID5_CONSENT: 'id5_consent',\n  PROVISIONAL: 'provisional',\n  JURISDICTION: 'jurisdiction',\n  CONSENT_API: 'consent_api'\n});\n\nexport class LocalStorageGrant {\n  /**\n   * Tells whether or not\n   * @type {boolean}\n   */\n   allowed = false;\n\n  /**\n   * The type of grant we got for the current isLocalStorageAllowed() invocation\n   * @type {string}\n   */\n  grantType = GRANT_TYPE.NONE;\n\n  /**\n   * The consent API type which is used to determine consent to access local storage\n   * @type {string}\n   */\n  api = API_TYPE.NONE;\n\n  constructor(allowed, grantType, api) {\n    this.allowed = allowed;\n    this.grantType = grantType;\n    this.api = api;\n  }\n\n  isDefinitivelyAllowed() {\n    return this.allowed && this.grantType !== GRANT_TYPE.PROVISIONAL;\n  }\n}\n\nexport class ConsentData {\n  /**\n   * The API type which is used to determine consent to access local storage and call the ID5 back-end\n   * @type {string}\n   */\n  api = API_TYPE.NONE;\n\n  /**\n   * The GDPR consent string\n   * @type {string}\n   */\n  consentString;\n\n  /** @type {boolean} */\n  gdprApplies = false;\n\n  /**\n   * The vendor data as presented by the TCF\n   * @type {Object}\n   */\n  vendorData = {};\n\n  /**\n   * List of allowed vendors either by IAB GVL ID or by ID5 partner ID\n   * @type {Array<string>}\n   */\n  allowedVendors;\n\n  /** @type {boolean} */\n  hasCcpaString = false;\n\n  /** @type {string} */\n  ccpaString = '';\n\n  localStorageGrant() {\n    return new LocalStorageGrant(this.isGranted(), GRANT_TYPE.CONSENT_API, this.api);\n  }\n\n  isGranted() {\n    switch (this.api) {\n      case API_TYPE.NONE:\n        // By default (so no indication from the owner of the page\n        // and no consent framework detected on page) we assume that we can use local storage\n        return true;\n      case API_TYPE.TCF_V1:\n        return !this.gdprApplies || delve(this, 'vendorData.purposeConsents.1') === true;\n      case API_TYPE.TCF_V2:\n        return !this.gdprApplies || delve(this, 'vendorData.purpose.consents.1') === true;\n      case API_TYPE.ID5_ALLOWED_VENDORS:\n        return this.allowedVendors.includes(ID5_GVL_ID);\n      case API_TYPE.USP_V1:\n        // CCPA never disallows local storage\n        return true;\n    }\n  }\n\n  /**\n   * Note this is not a generic hash code but rather a hash code\n   * used to check whether or not consent has changed across invocations\n   * @returns a hash code of some properties of this object\n   */\n  hashCode() {\n    /*\n    * We hash every properties except:\n    *   - vendorConsents object since the consentString is enough to know.\n    *   - ccpaString as it doesn't contribute to the local storage decision.\n    */\n    const {vendorData, ccpaString, ...others} = this;\n    return cyrb53Hash(JSON.stringify(others));\n  }\n}\n\nexport class ConsentManagement {\n  /** @type {number} */\n  invocationId;\n\n  /** @type {ConsentData} */\n  consentData;\n\n  /**\n   * The ID5 privacy object stored in localStorage\n   * @type {Object}\n   */\n  storedPrivacyData;\n\n  /**\n   * The interface to the browser local storage\n   * @type {LocalStorage}\n   */\n  localStorage;\n\n  /**\n   * Used to avoid requesting consent too often when not required\n   * @type {boolean}\n   */\n  _consentRequested = false;\n\n  /**\n   * @param {LocalStorage} localStorage the localStorage object to use\n   */\n  constructor(invocationId, localStorage) {\n    this.invocationId = invocationId;\n    this.localStorage = localStorage;\n    this.resetConsentData();\n  }\n\n  /**\n   * Try to fetch consent from CMP. Main entry point to retrieve consent data.\n   * @param {boolean} debugBypassConsent\n   * @param {string} cmpApi - CMP Api to use\n   * @param {object} [providedConsentData] - static consent data provided to ID5 API at init() time\n   * @param {function(ConsentData)} finalCallback required; final callback\n   */\n  requestConsent(debugBypassConsent, cmpApi, providedConsentData, finalCallback) {\n    if (debugBypassConsent) {\n      this.consentData = new ConsentData();\n      logWarn(this.invocationId, 'cmpApi: ID5 is operating in forced consent mode and will not retrieve any consent signals from the CMP');\n      finalCallback(this.consentData);\n    } else if (!this._consentRequested) {\n      this.consentData = new ConsentData();\n      this._consentRequested = true;\n      switch (cmpApi) {\n        case 'static':\n          this.parseStaticConsentData(providedConsentData, finalCallback);\n          break;\n        case 'iab':\n          this.lookupIabConsent(finalCallback);\n          break;\n        default:\n          logError(this.invocationId, `cmpApi: Unknown consent API: ${cmpApi}`);\n          this.resetConsentData();\n          finalCallback(this.consentData);\n          break;\n      }\n    } else {\n      finalCallback(this.consentData);\n    }\n  }\n\n  getOrCreateConsentData() {\n    if (!this.consentData) {\n      this.consentData = new ConsentData();\n    }\n    return this.consentData;\n  }\n\n  /**\n   * This function reads the consent string from the config to obtain the consent\n   * information of the user.\n   * @param {Object} data the data passed in the static configuration\n   * @param {function(ConsentData)} finalCallback required; final callback\n   */\n  parseStaticConsentData(data, finalCallback) {\n    data = data || {};\n\n    // Try to detect the API from the static object structure\n    let mergeData = {};\n    if (isPlainObject(data.getConsentData)) {\n      mergeData = ConsentManagement.parseTcfData(data, 1);\n    } else if (isPlainObject(data.getTCData)) {\n      mergeData = ConsentManagement.parseTcfData(data.getTCData, 2);\n    } else if (isArray(data.allowedVendors)) {\n      mergeData = {\n        api: API_TYPE.ID5_ALLOWED_VENDORS,\n        allowedVendors: data.allowedVendors.map(item => String(item)),\n        gdprApplies: true\n      };\n    } else if (isPlainObject(data.getUSPData)) {\n      mergeData = ConsentManagement.parseUspData(data.getUSPData);\n    } else {\n      logWarn(this.invocationId, 'cmpApi: No static consent data detected! Using defaults.');\n    }\n    Object.assign(this.consentData, mergeData);\n    logInfo(this.invocationId, `cmpApi: Detected API '${this.consentData.api}' from static consent data`, data);\n    finalCallback(this.consentData);\n  }\n\n  /**\n   * This function handles async interacting with an IAB compliant CMP\n   * to obtain the consent information of the user.\n   * @param {function(ConsentData)} finalCallback required; final callback\n   */\n  lookupIabConsent(finalCallback) {\n    const self = this;\n    const done = [];\n\n    // Builds callbacks for the various APIs. It does debouncing and groups\n    // the result from all callbacks. It assumes all callbacks are created\n    // before any of them fires.\n    const makeCallback = (callbackPos) => {\n      done[callbackPos] = false;\n      return (result) => {\n        if (!done[callbackPos]) {\n          done[callbackPos] = true;\n          if (result) {\n            Object.assign(self.consentData, result);\n          }\n          if (done.every(d => d)) {\n            finalCallback(self.consentData);\n          }\n        }\n      };\n    };\n\n    const callbackTcf = makeCallback(0);\n    const callbackUsp = makeCallback(1);\n    this.lookupTcf(callbackTcf);\n    this.lookupUsp(callbackUsp);\n  }\n\n  lookupUsp(callback) {\n    const { uspapiFrame, uspapiFunction } = ConsentManagement.findUsp();\n    let uspFn;\n    if (!uspapiFrame) {\n      logWarn(this.invocationId, 'cmpApi: USP not found! Using defaults for CCPA.');\n      callback();\n      return;\n    }\n\n    if (isFn(uspapiFunction)) {\n      logInfo(this.invocationId, 'cmpApi: Detected USP is directly accessible, calling it now.');\n      uspFn = uspapiFunction;\n    } else {\n      logInfo(this.invocationId, 'cmpApi: Detected USP is outside the current iframe. Using message passing.');\n      uspFn = ConsentManagement.buildCmpSurrogate('uspv1', uspapiFrame);\n    }\n\n    const uspCallback = (consentResponse, success) => {\n      if (success) {\n        callback(ConsentManagement.parseUspData(consentResponse));\n      } else {\n        logError(this.invocationId, 'cmpApi: USP callback not succesful. Using defaults for CCPA.');\n        callback();\n      }\n    };\n    uspFn('getUSPData', USPAPI_VERSION, uspCallback);\n  }\n\n  /**\n   * This function builds a surrogate CMP function which behaves as the original\n   * except it uses message passing to communicate to the CMP function of choice\n   * @param {string} typeOfCall decides how to build the function based on the CMP type\n   * @param {Object} apiFrame the frame where the API is located. Discovered by detection.\n   * @returns {function} the function to call\n   */\n  static buildCmpSurrogate(typeOfCall, apiFrame) {\n    return (param0, param1, messageCallback) => {\n      const callId = Math.random() + '';\n      const config = SURROGATE_CONFIG[typeOfCall];\n      const msg = {};\n      const requestObj = {};\n      requestObj[config.objKeys[0]] = param0;\n      requestObj[config.objKeys[1]] = param1;\n      requestObj.callId = callId;\n      msg[config.objName] = requestObj;\n      const eventHandler = (event) => {\n        const result = delve(event, `data.${config.returnObjName}`);\n        if (result && result.callId === callId) {\n          window.removeEventListener('message', eventHandler);\n          messageCallback(result.returnValue, result.success);\n        }\n      };\n      window.addEventListener('message', eventHandler, false);\n      apiFrame.postMessage(msg, '*');\n    };\n  }\n\n  lookupTcf(callback) {\n    const { cmpVersion, cmpFrame, cmpFunction } = ConsentManagement.findTCF();\n    if (!cmpFrame) {\n      logWarn(this.invocationId, 'cmpApi: TCF not found! Using defaults for GDPR.');\n      callback();\n      return;\n    }\n\n    if (isFn(cmpFunction)) {\n      this.lookupDirectTcf(cmpVersion, cmpFunction, callback);\n    } else {\n      logInfo(this.invocationId, 'cmpApi: Detected TCF is outside the current iframe. Using message passing.');\n      this.lookupMessageTcf(cmpVersion, cmpFrame, callback);\n    }\n  }\n\n  lookupMessageTcf(cmpVersion, cmpFrame, callback) {\n    const cmpFunction = ConsentManagement.buildCmpSurrogate(cmpVersion === 1 ? 'tcfv1' : 'tcfv2', cmpFrame);\n    this.lookupDirectTcf(cmpVersion, cmpFunction, callback);\n  }\n\n  lookupDirectTcf(cmpVersion, cmpFunction, callback) {\n    // TCF V1 callbacks\n    const self = this;\n    const cmpResponse = {};\n    const done = {};\n    const logcb = (version, callback, data) => {\n      logInfo(self.invocationId, `cmpApi: TCFv${version} - Received a call back: ${callback}`, data);\n    };\n    const logNoSuccess = (version, callback) => {\n      logError(self.invocationId, `cmpApi: TCFv${version} - Received insuccess: ${callback}. Please check your CMP setup. Using defaults for GDPR.`);\n    };\n    const makeV1Callback = (verb) => {\n      done[verb] = false;\n      return (data, success) => {\n        done[verb] = true;\n        if (!success) {\n          logNoSuccess(1, verb);\n        } else {\n          logcb(1, verb, data);\n          cmpResponse[verb] = data;\n        }\n        if (Object.values(done).every(d => d)) {\n          callback(ConsentManagement.parseTcfData(cmpResponse, 1));\n        }\n      };\n    };\n\n    // TCF V2 callback\n    const v2CmpResponseCallback = (tcfData, success) => {\n      logcb(2, 'event', tcfData);\n      if (!success) {\n        logNoSuccess(2, 'addEventListener');\n        callback();\n        return;\n      }\n      if (tcfData &&\n          (tcfData.gdprApplies === false ||\n          tcfData.eventStatus === 'tcloaded' ||\n          tcfData.eventStatus === 'useractioncomplete')\n      ) {\n        callback(ConsentManagement.parseTcfData(tcfData, 2));\n      }\n    };\n\n    if (cmpVersion === 1) {\n      const consentDataCallback = makeV1Callback('getConsentData');\n      const vendorConsentsCallback = makeV1Callback('getVendorConsents');\n      cmpFunction('getConsentData', null, consentDataCallback);\n      cmpFunction('getVendorConsents', null, vendorConsentsCallback);\n    } else if (cmpVersion === 2) {\n      cmpFunction('addEventListener', cmpVersion, v2CmpResponseCallback);\n    }\n  }\n\n  /**\n   * This function checks the consent data provided by USP to ensure it's in an expected state.\n   * @param {object} consentObject required; object returned by CMP that contains user's consent choices\n   * @param {number} cmpVersion the version reported by the CMP framework\n   * @returns {Object} the parsed consent data\n   */\n  static parseUspData(consentObject) {\n    if (!isPlainObject(consentObject) ||\n      !isStr(consentObject.uspString)\n    ) {\n      logError(this.invocationId, 'cmpApi: No or malformed USP data. Using defaults for CCPA.');\n      return;\n    }\n\n    return {\n      api: API_TYPE.USP_V1,\n      hasCcpaString: true,\n      ccpaString: consentObject.uspString\n    };\n  }\n\n  /**\n   * This function checks the consent data provided by CMP to ensure it's in an expected state.\n   * @param {object} consentObject required; object returned by CMP that contains user's consent choices\n   * @param {number} cmpVersion the version reported by the CMP framework\n   * @returns {Object} the parsed consent data\n   */\n  static parseTcfData(consentObject, cmpVersion) {\n    let isValid, normalizeFn;\n    if (cmpVersion === 1) {\n      isValid = ConsentManagement.isValidV1ConsentObject;\n      normalizeFn = ConsentManagement.normalizeV1Data;\n    } else if (cmpVersion === 2) {\n      isValid = ConsentManagement.isValidV2ConsentObject;\n      normalizeFn = ConsentManagement.normalizeV2Data;\n    } else {\n      logError(this.invocationId, 'cmpApi: No or malformed CMP data. Using defaults for GDPR.');\n      return;\n    }\n\n    if (!isValid(consentObject)) {\n      logError(this.invocationId, 'cmpApi: Invalid CMP data. Using defaults for GDPR.', consentObject);\n      return;\n    }\n\n    return normalizeFn(consentObject);\n  }\n\n  static isValidV1ConsentObject(consentObject) {\n    const gdprApplies = delve(consentObject, 'getConsentData.gdprApplies');\n\n    if (!isBoolean(gdprApplies)) {\n      return false;\n    }\n\n    if (gdprApplies === false) {\n      return true;\n    }\n\n    return isStr(consentObject.getConsentData.consentData) &&\n      isPlainObject(consentObject.getVendorConsents) &&\n      Object.keys(consentObject.getVendorConsents).length > 1;\n  }\n\n  static isValidV2ConsentObject(consentObject) {\n    const gdprApplies = consentObject &&\n      consentObject.gdprApplies;\n    const tcString = consentObject &&\n      consentObject.tcString;\n\n    if (!isBoolean(gdprApplies)) {\n      return false;\n    }\n\n    if (gdprApplies === false) {\n      return true;\n    }\n\n    return isStr(tcString);\n  }\n\n  static normalizeV1Data(cmpConsentObject) {\n    return {\n      consentString: cmpConsentObject.getConsentData.consentData,\n      vendorData: cmpConsentObject.getVendorConsents,\n      gdprApplies: cmpConsentObject.getConsentData.gdprApplies,\n      api: API_TYPE.TCF_V1\n    };\n  }\n\n  static normalizeV2Data(cmpConsentObject) {\n    return {\n      consentString: cmpConsentObject.tcString,\n      vendorData: cmpConsentObject,\n      gdprApplies: cmpConsentObject.gdprApplies,\n      api: API_TYPE.TCF_V2\n    };\n  }\n\n  /**\n   * Simply resets the module's consentData.\n   */\n  resetConsentData() {\n    this.consentData = undefined;\n    this.storedPrivacyData = undefined;\n    this._consentRequested = false;\n  }\n\n  /**\n   * Test if consent module is present, applies, and is valid for local storage or cookies (purpose 1)\n   * @param {boolean} allowLocalStorageWithoutConsentApi\n   * @param {boolean} debugBypassConsent\n   * @returns {LocalStorageGrant} the result of checking the grant\n   */\n  localStorageGrant(allowLocalStorageWithoutConsentApi, debugBypassConsent) {\n    if (allowLocalStorageWithoutConsentApi === true || debugBypassConsent === true) {\n      logWarn(this.invocationId, 'cmpApi: Local storage access granted by configuration override, consent will not be checked');\n      return new LocalStorageGrant(true, GRANT_TYPE.FORCE_ALLOWED_BY_CONFIG, API_TYPE.NONE);\n    }\n\n    if (!this.consentData || this.consentData.api === API_TYPE.NONE) {\n      // Either no CMP on page or too early to say, so we check if we had stored\n      // privacy data from a previous request.\n      if (!isPlainObject(this.storedPrivacyData)) {\n        const privacyData = this.localStorage.getItemWithExpiration(CONSTANTS.STORAGE_CONFIG.PRIVACY);\n        this.storedPrivacyData = privacyData && JSON.parse(privacyData);\n        logInfo(this.invocationId, 'cmpApi: Loaded stored privacy data from local storage', this.storedPrivacyData);\n      }\n\n      if (this.storedPrivacyData && this.storedPrivacyData.id5_consent === true) {\n        return new LocalStorageGrant(true, GRANT_TYPE.ID5_CONSENT, API_TYPE.NONE);\n      }\n\n      if (!this.storedPrivacyData || !isDefined(this.storedPrivacyData.jurisdiction)) {\n        // No stored privacy data (or jurisdiction) and no consent data. We grant provisional use.\n        return new LocalStorageGrant(true, GRANT_TYPE.PROVISIONAL, API_TYPE.NONE);\n      }\n      // We had no id5_consent but depending on the jurisdiction, we may still grant local storage.\n      const jurisdiction = this.storedPrivacyData.jurisdiction;\n      const jurisdictionRequiresConsent = (jurisdiction in CONSTANTS.PRIVACY.JURISDICTIONS)\n        ? CONSTANTS.PRIVACY.JURISDICTIONS[jurisdiction] : false;\n      return new LocalStorageGrant(jurisdictionRequiresConsent === false, GRANT_TYPE.JURISDICTION, API_TYPE.NONE);\n    }\n\n    return this.consentData.localStorageGrant();\n  }\n\n  setStoredPrivacy(privacy) {\n    try {\n      if (isPlainObject(privacy)) {\n        this.storedPrivacyData = privacy;\n        this.localStorage.setItemWithExpiration(CONSTANTS.STORAGE_CONFIG.PRIVACY,\n          JSON.stringify(privacy));\n      } else {\n        logError(this.invocationId, 'cmpApi: Cannot store privacy data if it is not an object', privacy);\n      }\n    } catch (e) {\n      logError(this.invocationId, 'cmpApi: Error while storing privacy data', e);\n    }\n  }\n\n  /**\n   * @typedef {Object} CMPDetails\n   * @property {number} cmpVersion - Version of CMP Found, 0 if not found\n   * @property {Object} cmpFrame - The frame where the CPM function is declared\n   * @property {function} cmpFunction - the CMP function to invoke\n   *\n   * This function tries to find the CMP in page.\n   * @return {CMPDetails}\n   */\n  static findTCF() {\n    let cmpVersion = 0;\n    let f = window;\n    let cmpFrame;\n    let cmpFunction;\n    while (!cmpFrame) {\n      try {\n        if (typeof f.__tcfapi === 'function' || typeof f.__cmp === 'function') {\n          if (typeof f.__tcfapi === 'function') {\n            cmpVersion = 2;\n            cmpFunction = f.__tcfapi;\n          } else {\n            cmpVersion = 1;\n            cmpFunction = f.__cmp;\n          }\n          cmpFrame = f;\n          break;\n        }\n      } catch (e) { }\n\n      // need separate try/catch blocks due to the exception errors\n      // thrown when trying to check for a frame that doesn't exist\n      // in 3rd party env\n      try {\n        if (f.frames['__tcfapiLocator']) {\n          cmpVersion = 2;\n          cmpFrame = f;\n          break;\n        }\n      } catch (e) { }\n\n      try {\n        if (f.frames['__cmpLocator']) {\n          cmpVersion = 1;\n          cmpFrame = f;\n          break;\n        }\n      } catch (e) { }\n\n      if (f === window.top) break;\n      f = f.parent;\n    }\n    return {\n      cmpVersion,\n      cmpFrame,\n      cmpFunction\n    };\n  }\n\n  /**\n   * @typedef {Object} UspDetails\n   * @property {Object} uspapiFrame - The frame where the CPM function is declared\n   * @property {function} uspapiFunction - the CMP function to invoke\n   *\n   * This function tries to find the CMP in page.\n   * @return {UspDetails}\n   */\n  static findUsp() {\n    let f = window;\n    let uspapiFrame;\n    let uspapiFunction;\n\n    while (!uspapiFrame) {\n      try {\n        if (typeof f.__uspapi === 'function') {\n          uspapiFunction = f.__uspapi;\n          uspapiFrame = f;\n          break;\n        }\n      } catch (e) {}\n\n      try {\n        if (f.frames['__uspapiLocator']) {\n          uspapiFrame = f;\n          break;\n        }\n      } catch (e) {}\n      if (f === window.top) break;\n      f = f.parent;\n    }\n    return {\n      uspapiFrame,\n      uspapiFunction\n    };\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/consentManagement.js","/*\n * Module for managing storage of information in browser Local Storage and/or cookies\n */\n\nimport { logError, logWarn, getCookie, setCookie, cyrb53Hash } from './utils.js';\nimport CONSTANTS from './constants.json';\n/* eslint-disable no-unused-vars */\nimport { LocalStorageGrant } from './consentManagement.js';\n/* eslint-enable no-unused-vars */\n\nexport default class ClientStore {\n  /** @type {number} */\n  invocationId;\n  /** @type {function} */\n  localStorageGrantChecker;\n  /** @type {LocalStorage} */\n  localStorage;\n\n  /**\n   * @param {number} invocationId\n   * @param {function} localStorageGrantChecker\n   * @param {LocalStorage} localStorage the localStorage abstraction object to use\n   */\n  constructor(invocationId, localStorageGrantChecker, localStorage) {\n    this.invocationId = invocationId;\n    this.localStorageGrantChecker = localStorageGrantChecker;\n    this.localStorage = localStorage;\n  }\n\n  /**\n   * Get stored data from local storage, if any, after checking if local storage is allowed\n   * @param {StoreItem} cacheConfig\n   * @returns {string|null|undefined} the stored value, null if no value or expired were stored, undefined if no consent or no access to localStorage\n   */\n  get(cacheConfig) {\n    try {\n      const localStorageGrant = this.localStorageGrant();\n      if (localStorageGrant.isDefinitivelyAllowed()) {\n        return this.localStorage.getItemWithExpiration(cacheConfig);\n      } else {\n        logWarn(this.invocationId, 'clientStore.get() has been called without definitive grant', localStorageGrant);\n      }\n    } catch (e) {\n      logError(this.invocationId, e);\n    }\n  }\n\n  /**\n   * clear stored data from local storage, if any\n   * @param {StoreItem} cacheConfig\n   */\n  clear(cacheConfig) {\n    try {\n      this.localStorage.removeItemWithExpiration(cacheConfig);\n    } catch (e) {\n      logError(this.invocationId, e);\n    }\n  }\n\n  /**\n   * Puts the current data into local storage provided local storage access is definitively granted\n   * @param {StoreItem} cacheConfig\n   * @param {string} data\n   */\n  put(cacheConfig, data) {\n    try {\n      const localStorageGrant = this.localStorageGrant();\n      if (localStorageGrant.isDefinitivelyAllowed()) {\n        this.localStorage.setItemWithExpiration(cacheConfig, data);\n      } else {\n        logWarn(this.invocationId, 'clientStore.put() has been called without definitive grant', localStorageGrant);\n      }\n    } catch (e) {\n      logError(this.invocationId, e);\n    }\n  }\n\n  /**\n   * @returns {LocalStorageGrant} see {ConsentManagement.localStorageGrant()}\n   */\n  localStorageGrant() {\n    return this.localStorageGrantChecker();\n  }\n\n  /**\n   * @returns {boolean} true if localStorage is available\n   */\n  isLocalStorageAvailable() {\n    return this.localStorage.isAvailable();\n  }\n\n  getResponseFromLegacyCookie() {\n    let legacyStoredValue;\n    CONSTANTS.LEGACY_COOKIE_NAMES.forEach(function (cookie) {\n      if (getCookie(cookie)) {\n        legacyStoredValue = getCookie(cookie);\n      }\n    });\n    if (legacyStoredValue) {\n      return JSON.parse(legacyStoredValue);\n    } else {\n      return null;\n    }\n  }\n\n  getResponse() {\n    let storedValue = this.get(CONSTANTS.STORAGE_CONFIG.ID5);\n    if (storedValue) {\n      return JSON.parse(decodeURIComponent(storedValue));\n    } else {\n      return storedValue;\n    }\n  }\n\n  clearResponse() {\n    this.clear(CONSTANTS.STORAGE_CONFIG.ID5);\n  }\n\n  putResponse(response) {\n    this.put(CONSTANTS.STORAGE_CONFIG.ID5, encodeURIComponent(response));\n  }\n\n  getHashedConsentData() {\n    return this.get(CONSTANTS.STORAGE_CONFIG.CONSENT_DATA);\n  }\n\n  clearHashedConsentData() {\n    this.clear(CONSTANTS.STORAGE_CONFIG.CONSENT_DATA);\n  }\n\n  /**\n   * Stores a hash of the consent data for alter comparison\n   * @param {ConsentData} consentData\n   */\n  putHashedConsentData(consentData) {\n    this.put(CONSTANTS.STORAGE_CONFIG.CONSENT_DATA, consentData.hashCode());\n  }\n\n  /**\n   * Get current hash PD for this partner\n   * @param {number} partnerId\n   */\n  getHashedPd(partnerId) {\n    return this.get(ClientStore.pdCacheConfig(partnerId));\n  }\n\n  /**\n   * Check current hash PD for this partner against the one in cache\n   * @param {number} partnerId\n   * @param {string} pd\n   */\n  storedPdMatchesPd(partnerId, pd) {\n    return ClientStore.storedDataMatchesCurrentData(this.getHashedPd(partnerId), ClientStore.makeStoredHash(pd));\n  }\n\n  /**\n   * Clear the hash PD for this partner\n   * @param {number} partnerId\n   */\n  clearHashedPd(partnerId) {\n    this.clear(ClientStore.pdCacheConfig(partnerId));\n  }\n\n  /**\n   * Hash and store the PD for this partner\n   * @param {number} partnerId\n   * @param {string} [pd]\n   */\n  putHashedPd(partnerId, pd) {\n    this.put(ClientStore.pdCacheConfig(partnerId), ClientStore.makeStoredHash(pd));\n  }\n\n  /**\n   * Generate local storage config for PD of a given partner\n   * @param {number} partnerId\n   * @return {StoreItem}\n   */\n  static pdCacheConfig(partnerId) {\n    return {\n      name: `${CONSTANTS.STORAGE_CONFIG.PD.name}_${partnerId}`,\n      expiresDays: CONSTANTS.STORAGE_CONFIG.PD.expiresDays\n    };\n  }\n\n  /**\n   * creates a hash of a user identifier for storage\n   * @param {string} userId\n   * @returns {string}\n   */\n  static makeStoredHash(userId) {\n    return cyrb53Hash(typeof userId === 'string' ? userId : '');\n  }\n\n  getDateTime() {\n    return (new Date(this.get(CONSTANTS.STORAGE_CONFIG.LAST))).getTime();\n  }\n\n  clearDateTime() {\n    this.clear(CONSTANTS.STORAGE_CONFIG.LAST);\n  }\n\n  setDateTime(timestamp) {\n    this.put(CONSTANTS.STORAGE_CONFIG.LAST, timestamp);\n  }\n\n  static nbCacheConfig(partnerId) {\n    return {\n      name: `${CONSTANTS.STORAGE_CONFIG.ID5.name}_${partnerId}_nb`,\n      expiresDays: CONSTANTS.STORAGE_CONFIG.ID5.expiresDays\n    };\n  }\n\n  getNb(partnerId) {\n    const cachedNb = this.get(ClientStore.nbCacheConfig(partnerId));\n    return (cachedNb) ? parseInt(cachedNb) : 0;\n  }\n\n  clearNb(partnerId) {\n    this.clear(ClientStore.nbCacheConfig(partnerId));\n  }\n\n  setNb(partnerId, nb) {\n    this.put(ClientStore.nbCacheConfig(partnerId), nb);\n  }\n\n  incNb(partnerId, nb) {\n    nb++;\n    this.setNb(partnerId, nb);\n    return nb;\n  }\n\n  clearAll(partnerId) {\n    this.clearResponse();\n    this.clearDateTime();\n    this.clearNb(partnerId);\n    this.clearHashedPd(partnerId);\n    this.clearHashedConsentData();\n  }\n\n  removeLegacyCookies(partnerId) {\n    const expired = (new Date(Date.now() - 1000)).toUTCString();\n    CONSTANTS.LEGACY_COOKIE_NAMES.forEach(function (cookie) {\n      setCookie(`${cookie}`, '', expired);\n      setCookie(`${cookie}_nb`, '', expired);\n      setCookie(`${cookie}_${partnerId}_nb`, '', expired);\n      setCookie(`${cookie}_last`, '', expired);\n      setCookie(`${cookie}.cached_pd`, '', expired);\n      setCookie(`${cookie}.cached_consent_data`, '', expired);\n    });\n  }\n\n  /**\n   * test if the data stored locally matches the current data.\n   * if there is nothing in storage, return true and we'll do an actual comparison next time.\n   * this way, we don't force a refresh for every user when this code rolls out\n   * @param storedData\n   * @param currentData\n   * @returns {boolean}\n   */\n  static storedDataMatchesCurrentData(storedData, currentData) {\n    return (\n      typeof storedData === 'undefined' ||\n      storedData === null ||\n      storedData === currentData\n    );\n  }\n\n  /**\n   * Checks whether current consent data matches stored consent data\n   * @param {ConsentData} consentData current consent data\n   * @returns true if it matches\n   */\n  storedConsentDataMatchesConsentData(consentData) {\n    return ClientStore.storedDataMatchesCurrentData(this.getHashedConsentData(), consentData.hashCode());\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/clientStore.js","/**\n * This class deals with the mechanics of accessing the local storage\n * on a certain window object\n */\n\nconst EXP_SUFFIX = '_exp';\nexport default class LocalStorage {\n  /** @type {boolean} */\n  available = false;\n  /** @type {Object} */\n  win;\n  /** @type {boolean} */\n  writingEnabled;\n\n  /**\n   * Builds a new abstraction of the localStorage associated with\n   * the passed window object\n   * @param {Object} win the window object to use\n   */\n  constructor(win, writingEnabled = true) {\n    this.win = win;\n    this.writingEnabled = writingEnabled;\n\n    // Test for availability\n    const test = '__id5test';\n    try {\n      if (this.writingEnabled) {\n        this.win.localStorage.setItem(test, test);\n      }\n      this.win.localStorage.removeItem(test);\n      this.available = true;\n    } catch (e) {\n      // do nothing\n    }\n  }\n\n  /**\n   * @returns {boolean} true if the localStorage is available\n   */\n  isAvailable() {\n    return this.available;\n  }\n\n  /**\n   * Gets a stored string from local storage\n   *\n   * @param {string} key\n   * @returns {string|null|undefined} the stored value, null if no value or expired were stored, undefined if no localStorage\n   */\n  getItem(key) {\n    if (this.available) {\n      return this.win.localStorage.getItem(key);\n    }\n  }\n\n  /**\n   * Puts a string in local storage\n   *\n   * @param {string} key the key of the item\n   * @param {string} value the vaule to store\n   * @returns {undefined}\n   */\n  setItem(key, value) {\n    if (this.available && this.writingEnabled) {\n      this.win.localStorage.setItem(key, value);\n    }\n  }\n\n  /**\n   * Removes a string from local storage\n   * @param {string} key the key of the item\n   */\n  removeItem(key) {\n    if (this.available) {\n      this.win.localStorage.removeItem(key);\n    }\n  }\n\n  /**\n   * Gets a stored item from local storage dealing with expiration policy.\n   * @param {Object} config The item configuration\n   * @param {string} config.name The item name\n   * @returns {string|null} the stored value, null if no value, expired or no localStorage\n   */\n  getItemWithExpiration({ name }) {\n    const storedValueExp = this.getItem(name + EXP_SUFFIX);\n    if (storedValueExp && !isExpired(storedValueExp)) {\n      return this.getItem(name);\n    } else {\n      this.removeItemWithExpiration({ name });\n      return null;\n    }\n  }\n\n  /**\n   * Stores an item in local storage dealing with expiration policy.\n   * @param {Object} config The item configuration\n   * @param {string} config.name The item name\n   * @param {number} config.expiresDays The expiration in days\n   * @returns {undefined}\n   */\n  setItemWithExpiration({name, expiresDays}, value) {\n    const expirationInMs = Date.now() + (expiresDays * (60 * 60 * 24 * 1000));\n    const expiresStr = (new Date(expirationInMs)).toUTCString();\n    this.setItem(name + EXP_SUFFIX, expiresStr);\n    this.setItem(name, value);\n  }\n\n  /**\n   * Removes an item from local storage dealing with expiration policy.\n   */\n  removeItemWithExpiration({ name }) {\n    this.removeItem(name);\n    this.removeItem(name + EXP_SUFFIX);\n  }\n}\n\n/**\n * Tells whether a stored expiration date has passed\n * @param {string} dateValue the .toUTCString() representation of the expiration date\n */\nfunction isExpired(dateValue) {\n  return (new Date(dateValue)).getTime() - Date.now() <= 0;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/localStorage.js","/*\n * Module for getting and setting ID5 API configuration.\n */\nimport { logError, isA, isPlainObject, isNumber, isArray, isStr, all } from './utils.js';\n\n/**\n * @typedef {Object} Id5Options\n * @property {number} [partnerId] - ID5 Publisher ID, mandatory\n * @property {boolean|false} [debugBypassConsent] - Bypass consent API et local storage consent for testing purpose only\n * @property {boolean|false} [allowLocalStorageWithoutConsentApi] - Tell ID5 that consent has been given to read local storage\n * @property {number} [refreshInSeconds] - Refresh period of first-party cookie (defaulting to 7200s)\n * @property {string} [partnerUserId] - User ID for the platform deploying the API, to be stored by ID5 for further cookie matching if provided\n * @property {string} [cmpApi] - API to use CMP. As of today, either 'iab' or 'static'\n * @property {object} [consentData] - Consent data if cmpApi is 'static'\n * @property {function} [callbackOnAvailable] - Function to call back when User ID is available. if callbackTimeoutInMs is not provided, will be fired only if a User ID is available.\n * @property {function} [callbackOnUpdates] - Function to call back on further updates of User ID by changes in the page (consent, pd, refresh). Cannot be provided if `callbackOnAvailable` is not provided\n * @property {number} [callbackTimeoutInMs] - Delay in ms after which the callbackOnAvailable is guaranteed to be fired. A User ID may not yet be available at this time.\n * @property {string} [pd] - Partner Data that can be passed to help with cross-domain reconciliation of the ID5 ID, more details here: https://support.id5.io/portal/en/kb/articles/passing-partner-data-to-id5\n * @property {AbTestConfig} [abTesting] - An object defining if and how A/B testing should be enabled\n * @property {string} [provider] - Defines who is deploying the API on behalf of the partner. A hard-coded value that will be provided by ID5 when applicable\n * @property {number} [maxCascades] - Defines the maximum number of cookie syncs that can occur when usersyncing for the user is required. A value of -1 will disable cookie syncing altogether. Defaults to 8\n * @property {boolean} [applyCreativeRestrictions] - When true some restrictions are applied, for example avoid writing to localStorage and avoid cookie syncing.\n * @property {Array<Segment>} [segments] - A list of segments to push to partners.\n\n * @typedef {Object} Segment\n * @property {string} [destination] - GVL ID or ID5-XX Partner ID. Mandatory\n * @property {Array<string>} [ids] - The segment IDs to push. Must contain at least one segment ID.\n*/\n\n/**\n * @typedef {Object} AbTestConfig\n * @property {boolean|false} [enabled] - Enable control group\n * @property {number} [controlGroupPct] - Ratio of users in control group [0,1]\n */\n\nexport default class Config {\n  /** @type {number} */\n  invocationId;\n\n  /** @type {Id5Options} */\n  options;\n\n  /** @type {Id5Options} */\n  providedOptions;\n\n  /** @type {number} */\n  invalidSegments;\n\n  static configTypes = {\n    debugBypassConsent: 'Boolean',\n    allowLocalStorageWithoutConsentApi: 'Boolean',\n    cmpApi: 'String',\n    consentData: 'Object',\n    refreshInSeconds: 'Number',\n    partnerId: 'Number',\n    partnerUserId: 'String',\n    callbackOnAvailable: 'Function',\n    callbackOnUpdates: 'Function',\n    callbackTimeoutInMs: 'Number',\n    pd: 'String',\n    abTesting: 'Object',\n    provider: 'String',\n    maxCascades: 'Number',\n    applyCreativeRestrictions: 'Boolean'\n  };\n\n  /**\n   * Create configuration instance from an object containing key-value pairs\n   * @param {number} invocationId\n   * @param {Id5Options} options\n   */\n  constructor(invocationId, options) {\n    this.invocationId = invocationId;\n    this.options = {\n      debugBypassConsent: false,\n      allowLocalStorageWithoutConsentApi: false,\n      cmpApi: 'iab',\n      consentData: {\n        getConsentData: {\n          consentData: undefined,\n          gdprApplies: undefined\n        },\n        getVendorConsents: {}\n      },\n      refreshInSeconds: 7200,\n      partnerId: undefined,\n      partnerUserId: undefined,\n      callbackOnAvailable: undefined,\n      callbackOnUpdates: undefined,\n      callbackTimeoutInMs: undefined,\n      pd: undefined,\n      abTesting: {\n        enabled: false,\n        controlGroupPct: 0\n      },\n      provider: undefined,\n      maxCascades: 8,\n      applyCreativeRestrictions: false,\n      segments: undefined\n    };\n    this.providedOptions = {};\n\n    if (!options.partnerId || typeof options.partnerId !== 'number') {\n      throw new Error('partnerId is required and must be a number');\n    }\n\n    this.invalidSegments = 0;\n    this.updOptions(options);\n  }\n\n  /**\n   * Return current configuration\n   * @returns {Id5Options} options\n   */\n  getOptions() {\n    return this.options;\n  }\n\n  /**\n   * Return configuration set by user\n   * @returns {Id5Options} options\n   */\n  getProvidedOptions() {\n    return this.providedOptions;\n  }\n\n  /**\n   * Return how many invalid segments we got in the options\n   * @returns {number} invalidSegments\n   */\n  getInvalidSegments() {\n    return this.invalidSegments;\n  }\n\n  /**\n   * Override the configuration with an object containing key-value pairs\n   * @param {Id5Options} options\n   */\n  updOptions(options) {\n    const self = this;\n    if (!isPlainObject(options)) {\n      logError(this.invocationId, 'Config options must be an object');\n      return;\n    }\n\n    if (isNumber(this.options.partnerId) && // Might be undefined\n        isNumber(options.partnerId) &&\n        options.partnerId !== this.options.partnerId\n    ) {\n      throw new Error('Cannot update config with a different partnerId');\n    }\n\n    const acceptOption = (topic, value) => {\n      this.options[topic] = value;\n      this.providedOptions[topic] = value;\n    };\n\n    Object.keys(options).forEach(topic => {\n      if (topic === 'segments') {\n        const segments = options[topic];\n        const value = [];\n        if (!isArray(segments)) {\n          logTypeError(self.invocationId, topic, 'Array', segments);\n          return;\n        }\n        segments.forEach((segment, index) => {\n          const locator = `segments[${index}]`;\n          if (!isArray(segment['ids']) || !all(segment['ids'], isStr)) {\n            logTypeError(self.invocationId, `${locator}.ids`, 'Array of String', segment['ids']);\n            self.invalidSegments += 1;\n            return;\n          }\n          if (segment['ids'].length < 1) {\n            logError(self.invocationId, `Config option ${locator}.ids should contain at least one segment ID`);\n            self.invalidSegments += 1;\n            return;\n          }\n          if (!isStr(segment['destination'])) {\n            logTypeError(self.invocationId, `${locator}.destination`, 'String', segment['destination']);\n            self.invalidSegments += 1;\n            return;\n          }\n          value.push(segment);\n        });\n        acceptOption(topic, value);\n      } else {\n        const expectedType = Config.configTypes[topic];\n        const value = options[topic];\n        if (isA(value, expectedType)) {\n          acceptOption(topic, value);\n        } else {\n          logTypeError(self.invocationId, topic, expectedType, value);\n        }\n      }\n    });\n  }\n}\n\nfunction logTypeError(invocationId, topic, expectedType, value) {\n  logError(invocationId, `Config option ${topic} must be of type ${expectedType} but was ${toString.call(value)}. Ignoring...`);\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/config.js","import ID5 from '../lib/id5-api';\nimport { logError, isPlainObject, ajax } from '../lib/utils';\n\nconst gt = window.googletag = window.googletag || {};\ngt.encryptedSignalProviders = gt.encryptedSignalProviders || [];\ngt.encryptedSignalProviders.push({\n  id: 'id5-sync.com',\n  collectorFunction: () => {\n    const INCREMENT_URL = 'https://id5-sync.com/api/esp/increment?counter=';\n    return new Promise((resolve, reject) => {\n      if (!isPlainObject(window.ID5EspConfig)) {\n        const afterAjax = () => reject(new Error('No ID5 config'));\n        logError('esp', 'Expected window.ID5EspConfig to be an Object with the necessary configuration! Cannot invoke ID5 fetch.');\n        ajax(INCREMENT_URL + 'no-config', {\n          success: afterAjax,\n          error: afterAjax\n        });\n        return;\n      }\n      window.ID5EspConfig.provider = window.ID5EspConfig.provider || 'g-esp';\n      try {\n        ID5.init(window.ID5EspConfig).onAvailable((id5Status) => {\n          resolve(id5Status.getUserId());\n        });\n      } catch (error) {\n        const afterAjax = () => reject(error);\n        logError('esp', 'Exception while initializing ID5 within googletag ESP! Cannot invoke ID5 fetch.');\n        ajax(INCREMENT_URL + 'exception', {\n          success: afterAjax,\n          error: afterAjax\n        });\n      }\n    });\n  }\n});\n\n\n\n// WEBPACK FOOTER //\n// ./src/esp.js","/** @module id5-api */\n\nimport {\n  setGlobalDebug,\n  isGlobalDebug,\n  isGlobalTrace,\n  logInfo,\n  logError,\n  isBoolean,\n  ajax,\n  isStr,\n  isDefined,\n  deferPixelFire } from './utils.js';\nimport { getRefererInfo } from './refererDetection.js';\nimport ClientStore from './clientStore.js';\nimport { ConsentManagement } from './consentManagement.js';\nimport Id5Status from './id5Status.js';\nimport { version as currentVersion } from '../generated/version.js';\nimport LocalStorage from './localStorage.js';\nimport Config from './config.js';\n\n/**\n * Singleton which represents the entry point of the API.\n * In the ID5's id5-api.js bundle this is installed under window.ID5.\n */\nclass Id5Api {\n  /** @type {boolean} */\n  loaded = false;\n\n  /** @type {boolean} */\n  set debug(isDebug) {\n    setGlobalDebug(isDebug);\n  }\n\n  get debug() {\n    return isGlobalDebug();\n  }\n\n  /** @type {boolean} */\n  _isUsingCdn = false;\n\n  /** @type {object} */\n  _referer = false;\n\n  /** @type {string} */\n  _version = currentVersion;\n\n  /** @type {object} */\n  versions = {};\n\n  /** @type {number} */\n  invocationId = 0;\n\n  constructor() {\n    this.loaded = true;\n    this._isUsingCdn = !!(\n      document &&\n      document.currentScript &&\n      document.currentScript.src &&\n      document.currentScript.src.indexOf('https://cdn.id5-sync.com') === 0\n    );\n    this._referer = getRefererInfo();\n    this.versions[currentVersion] = true;\n  }\n\n  /**\n   * This function will initialize ID5, wait for consent then try to fetch or refresh ID5 user id if required\n   * @param {Id5Options} passedOptions\n   * @return {Id5Status} Status of the ID5 API for this caller, for further interactions\n   */\n  init(passedOptions) {\n    const invocationId = this.invocationId;\n    this.invocationId += 1;\n    try {\n      logInfo(invocationId, `ID5 API version ${this._version}. Invoking init()`, passedOptions);\n\n      const config = new Config(invocationId, passedOptions);\n      const options = config.getOptions();\n\n      // By using window.top we say we want to use storage only if we're in a first-party context\n      const localStorage = new LocalStorage(window.top, !options.applyCreativeRestrictions);\n\n      const consentManagement = new ConsentManagement(invocationId, localStorage);\n      const localStorageGrantChecker = () => consentManagement.localStorageGrant(\n        options.allowLocalStorageWithoutConsentApi, options.debugBypassConsent);\n      const clientStore = new ClientStore(invocationId, localStorageGrantChecker, localStorage);\n      const partnerStatus = new Id5Status(invocationId, config, clientStore, consentManagement);\n      this.getId(partnerStatus, false);\n      logInfo(invocationId, `ID5 initialized for partner ${options.partnerId} with referer ${this._referer.referer} and options`, passedOptions);\n      return partnerStatus;\n    } catch (e) {\n      logError(invocationId, 'Exception caught during init()', e);\n    }\n  };\n\n  /**\n   * @param {Id5Status} id5Status - Initializes id5Status returned by `init()`\n   * @param {boolean} forceFetch\n   * @param {Id5Options} [options] - Options to update\n   * @return {Id5Status} provided id5Status for chaining\n   */\n  refreshId(id5Status, forceFetch = false, options = {}) {\n    if (!isBoolean(forceFetch)) {\n      throw new Error('Invalid signature for refreshId(): second parameter must be a boolean');\n    }\n\n    try {\n      logInfo(id5Status.invocationId, 'Invoking refreshId()', arguments);\n      id5Status.startRefresh(forceFetch);\n      id5Status.updateOptions(options);\n      id5Status.consentManagement.resetConsentData();\n      this.getId(id5Status, forceFetch);\n    } catch (e) {\n      logError(id5Status.invocationId, 'Exception caught from refreshId()', e);\n    }\n    return id5Status;\n  };\n\n  /**\n   * This function get the user ID for the given config\n   * @param {Id5Status} id5Status\n   * @param {boolean} forceFetch - Force a call to server\n   */\n  getId(id5Status, forceFetch = false) {\n    const options = id5Status.getOptions();\n    let storedResponse;\n    let storedDateTime;\n    let nb = 0;\n    let refreshInSecondsHasElapsed = false;\n    let pdHasChanged = false;\n    let cachedResponseUsed = false;\n\n    const localStorageGrant = id5Status.localStorageGrant();\n    if (localStorageGrant.isDefinitivelyAllowed()) {\n      logInfo(id5Status.invocationId, 'Using local storage for cached ID', localStorageGrant);\n      storedResponse = id5Status.clientStore.getResponse();\n      storedDateTime = id5Status.clientStore.getDateTime();\n\n      refreshInSecondsHasElapsed = storedDateTime <= 0 || ((Date.now() - storedDateTime) > (options.refreshInSeconds * 1000));\n      nb = id5Status.clientStore.getNb(options.partnerId);\n      pdHasChanged = !id5Status.clientStore.storedPdMatchesPd(options.partnerId, options.pd);\n    }\n\n    if (!storedResponse) {\n      logInfo(id5Status.invocationId, 'No cached ID found');\n      storedResponse = id5Status.clientStore.getResponseFromLegacyCookie();\n      refreshInSecondsHasElapsed = true; // Force a refresh if we have legacy cookie\n    }\n\n    if (storedResponse && storedResponse.universal_uid && !pdHasChanged) {\n      // we have a valid stored response and pd is not different, so\n      // use the stored response to make the ID available right away\n      logInfo(id5Status.invocationId, 'ID5 User ID available from cache:', {\n        storedResponse,\n        storedDateTime,\n        refreshNeeded: refreshInSecondsHasElapsed\n      });\n\n      id5Status.setUserId(storedResponse, true);\n      nb = id5Status.clientStore.incNb(options.partnerId, nb);\n      cachedResponseUsed = true;\n    } else if (storedResponse && storedResponse.universal_uid && pdHasChanged) {\n      logInfo(id5Status.invocationId, 'PD value has changed, so ignoring User ID from cache');\n    } else if (storedResponse && !storedResponse.universal_uid) {\n      logError(id5Status.invocationId, 'Invalid stored response: ', storedResponse);\n    } else {\n      logInfo(id5Status.invocationId, 'No ID5 User ID available from cache');\n    }\n\n    id5Status.consentManagement.requestConsent(options.debugBypassConsent, options.cmpApi, options.consentData, (consentData) => {\n      const localStorageGrant = id5Status.localStorageGrant();\n      logInfo(id5Status.invocationId, 'Local storage grant', localStorageGrant);\n      if (!localStorageGrant.allowed) {\n        logInfo(id5Status.invocationId, 'No legal basis to use ID5', consentData);\n        return;\n      }\n      storedResponse = id5Status.clientStore.getResponse() || id5Status.clientStore.getResponseFromLegacyCookie();\n\n      // store hashed consent data and pd for future page loads\n      const consentHasChanged = !id5Status.clientStore.storedConsentDataMatchesConsentData(consentData);\n      id5Status.clientStore.putHashedConsentData(consentData);\n      id5Status.clientStore.putHashedPd(options.partnerId, options.pd);\n\n      // make a call to fetch a new ID5 ID if:\n      // - there is no valid universal_uid or no signature in cache\n      // - the last refresh was longer than refreshInSeconds ago\n      // - consent has changed since the last ID was fetched\n      // - pd has changed since the last ID was fetched\n      // - fetch is being forced (e.g. by refreshId())\n      const missingStoredData = !storedResponse || !storedResponse.universal_uid || !storedResponse.signature;\n      if (\n        missingStoredData ||\n        refreshInSecondsHasElapsed ||\n        consentHasChanged ||\n        pdHasChanged ||\n        forceFetch\n      ) {\n        logInfo(id5Status.invocationId, `Decided to fetch a fresh ID5 ID`, {\n          missingStoredData,\n          refreshInSecondsHasElapsed,\n          consentHasChanged,\n          pdHasChanged,\n          forceFetch\n        });\n\n        const url = `https://id5-sync.com/g/v2/${options.partnerId}.json`;\n        const gdprApplies = consentData.gdprApplies ? 1 : 0;\n        const data = {\n          'partner': options.partnerId,\n          'v': this._version,\n          'o': 'api',\n          'gdpr': gdprApplies,\n          'rf': this._referer.referer,\n          'u': this._referer.stack[0] || window.location.href,\n          'top': this._referer.reachedTop ? 1 : 0,\n          'localStorage': id5Status.clientStore.isLocalStorageAvailable() ? 1 : 0,\n          'nbPage': nb,\n          'id5cdn': this._isUsingCdn,\n          'ua': window.navigator.userAgent\n        };\n\n        // pass in optional data, but only if populated\n        const gdprConsentString = consentData.gdprApplies ? consentData.consentString : undefined;\n        if (isDefined(gdprConsentString)) {\n          data.gdpr_consent = gdprConsentString;\n        }\n\n        if (isDefined(consentData.allowedVendors)) {\n          data.allowed_vendors = consentData.allowedVendors;\n        }\n\n        const signature = (storedResponse && storedResponse.signature) ? storedResponse.signature : undefined;\n        if (isDefined(signature)) {\n          data.s = signature;\n        }\n\n        if (consentData.hasCcpaString) {\n          data.us_privacy = consentData.ccpaString;\n        }\n\n        Object.entries({\n          pd: 'pd',\n          partnerUserId: 'puid',\n          provider: 'provider',\n          segments: 'segments'\n        }).forEach(entry => {\n          const [optKey, dataKey] = entry;\n          if (isDefined(options[optKey])) {\n            data[dataKey] = options[optKey];\n          }\n        });\n\n        // pass in A/B Testing configuration, if applicable\n        if (options.abTesting.enabled === true) {\n          data.ab_testing = {\n            enabled: true,\n            control_group_pct: id5Status.getOptions().abTesting.controlGroupPct\n          };\n        }\n\n        // Monitoring server side for excluded invalid segments\n        if (id5Status.getInvalidSegments() > 0) {\n          data._invalid_segments = id5Status.getInvalidSegments();\n        }\n\n        if (isGlobalTrace()) {\n          data._trace = true;\n        }\n\n        logInfo(id5Status.invocationId, `Fetching ID5 ID (forceFetch:${forceFetch}) from:`, url, data);\n        ajax(url, {\n          success: response => {\n            if (!response || !isStr(response) || response.length < 1) {\n              logError(id5Status.invocationId, `Empty response from ID5 servers: \"${response}\"`);\n              return;\n            }\n            let responseObj;\n            try {\n              responseObj = JSON.parse(response);\n            } catch (error) {\n              logError(id5Status.invocationId, 'Cannot parse the JSON server response', response);\n              return;\n            }\n            if (!isStr(responseObj.universal_uid)) {\n              logError(id5Status.invocationId, 'Server response failed to validate', responseObj);\n              return;\n            }\n            logInfo(id5Status.invocationId, 'Valid json response from ID5 received', responseObj);\n            try {\n              id5Status.setUserId(responseObj, false);\n\n              // privacy has to be stored first so we can use it when storing other values\n              id5Status.consentManagement.setStoredPrivacy(responseObj.privacy);\n\n              // @TODO: !isDefined(responseObj.privacy) is only needed until fetch endpoint is updated and always returns a privacy object\n              // once it does, I don't see a reason to keep that part of the if clause\n              const localStorageGrant = id5Status.localStorageGrant();\n              if (localStorageGrant.isDefinitivelyAllowed() || !isDefined(responseObj.privacy)) {\n                logInfo(id5Status.invocationId, 'Storing ID in cache');\n                id5Status.clientStore.putResponse(response);\n                id5Status.clientStore.setDateTime(new Date().toUTCString());\n                id5Status.clientStore.setNb(options.partnerId, (cachedResponseUsed ? 0 : 1));\n              } else {\n                logInfo(id5Status.invocationId, 'Cannot use local storage to cache ID', localStorageGrant);\n                id5Status.clientStore.clearAll(options.partnerId);\n              }\n              // TEMPORARY until all clients have upgraded past v1.0.0\n              // remove cookies that were previously set\n              id5Status.clientStore.removeLegacyCookies(options.partnerId);\n\n              if (responseObj.cascade_needed === true && localStorageGrant.isDefinitivelyAllowed() && options.maxCascades >= 0 && !options.applyCreativeRestrictions) {\n                const isSync = options.partnerUserId && options.partnerUserId.length > 0;\n                const syncUrl = `https://id5-sync.com/${isSync ? 's' : 'i'}/${options.partnerId}/${options.maxCascades}.gif?id5id=${id5Status._userId}&o=api&${isSync ? 'puid=' + options.partnerUserId + '&' : ''}gdpr_consent=${gdprConsentString}&gdpr=${gdprApplies}`;\n                logInfo(id5Status.invocationId, 'Opportunities to cascade available', syncUrl);\n                deferPixelFire(syncUrl);\n              }\n            } catch (error) {\n              logError(id5Status.invocationId, 'Error during processing of valid ID5 server response', responseObj, error);\n            }\n          },\n          error: error => {\n            logError(id5Status.invocationId, 'Error during AJAX request to ID5 server', error);\n          }\n        }, JSON.stringify(data), {method: 'POST', withCredentials: true});\n      }\n    });\n  }\n}\n\nconst ID5 = new Id5Api();\nexport default ID5;\n\n\n\n// WEBPACK FOOTER //\n// ./lib/id5-api.js","/**\n * The referer detection module attempts to gather referer information from the current page that id5-api.js resides in.\n * The information that it tries to collect includes:\n * The detected top url in the nav bar,\n * Whether it was able to reach the top most window (if for example it was embedded in several iframes),\n * The number of iframes it was embedded in if applicable,\n * A list of the domains of each embedded window if applicable.\n * Canonical URL which refers to an HTML link element, with the attribute of rel=\"canonical\", found in the <head> element of your webpage\n */\n\nexport function detectReferer(win) {\n  /**\n   * Returns number of frames to reach top from current frame\n   * @returns {Array} levels\n   */\n  function getLevels() {\n    let levels = walkUpWindows();\n    let ancestors = getAncestorOrigins();\n\n    if (ancestors) {\n      for (let i = 0, l = ancestors.length; i < l; i++) {\n        levels[i].ancestor = ancestors[i];\n      }\n    }\n    return levels;\n  }\n\n  /**\n   * This function would return a read-only array of hostnames for all the parent frames.\n   * win.location.ancestorOrigins is only supported in webkit browsers. For non-webkit browsers it will return undefined.\n   * @returns {(undefined|Array)} Ancestor origins or undefined\n   */\n  function getAncestorOrigins() {\n    try {\n      if (!win.location.ancestorOrigins) {\n        return;\n      }\n      return win.location.ancestorOrigins;\n    } catch (e) {\n      // Ignore error\n    }\n  }\n\n  /**\n   * This function would try to get referer and urls for all parent frames in case of win.location.ancestorOrigins undefined.\n   * @param {Array} levels\n   * @returns {Object} urls for all parent frames and top most detected referer url\n   */\n  function getPubUrlStack(levels) {\n    let stack = [];\n    let defUrl = null;\n    let frameLocation = null;\n    let prevFrame = null;\n    let prevRef = null;\n    let ancestor = null;\n    let detectedRefererUrl = null;\n\n    let i;\n    for (i = levels.length - 1; i >= 0; i--) {\n      try {\n        frameLocation = levels[i].location;\n      } catch (e) {\n        // Ignore error\n      }\n\n      if (frameLocation) {\n        stack.push(frameLocation);\n        if (!detectedRefererUrl) {\n          detectedRefererUrl = frameLocation;\n        }\n      } else if (i !== 0) {\n        prevFrame = levels[i - 1];\n        try {\n          prevRef = prevFrame.referrer;\n          ancestor = prevFrame.ancestor;\n        } catch (e) {\n          // Ignore error\n        }\n\n        if (prevRef) {\n          stack.push(prevRef);\n          if (!detectedRefererUrl) {\n            detectedRefererUrl = prevRef;\n          }\n        } else if (ancestor) {\n          stack.push(ancestor);\n          if (!detectedRefererUrl) {\n            detectedRefererUrl = ancestor;\n          }\n        } else {\n          stack.push(defUrl);\n        }\n      } else {\n        stack.push(defUrl);\n      }\n    }\n    return {\n      stack,\n      detectedRefererUrl\n    };\n  }\n\n  /**\n   * This function returns canonical URL which refers to an HTML link element, with the attribute of rel=\"canonical\", found in the <head> element of your webpage\n   * @param {Object} doc document\n   */\n  function getCanonicalUrl(doc) {\n    try {\n      let element = doc.querySelector(\"link[rel='canonical']\");\n      if (element !== null) {\n        return element.href;\n      }\n    } catch (e) {\n    }\n    return null;\n  }\n\n  /**\n   * Walk up to the top of the window to detect origin, number of iframes, ancestor origins and canonical url\n   */\n  function walkUpWindows() {\n    let acc = [];\n    let currentWindow;\n    do {\n      try {\n        currentWindow = currentWindow ? currentWindow.parent : win;\n        try {\n          let isTop = (currentWindow === win.top);\n          let refData = {\n            referrer: currentWindow.document.referrer || null,\n            location: currentWindow.location.href || null,\n            isTop\n          };\n          if (isTop) {\n            refData = Object.assign(refData, {\n              canonicalUrl: getCanonicalUrl(currentWindow.document)\n            });\n          }\n          acc.push(refData);\n        } catch (e) {\n          acc.push({\n            referrer: null,\n            location: null,\n            isTop: (currentWindow === win.top)\n          });\n        }\n      } catch (e) {\n        acc.push({\n          referrer: null,\n          location: null,\n          isTop: false\n        });\n        return acc;\n      }\n    } while (currentWindow !== win.top);\n    return acc;\n  }\n\n  /**\n   * Referer info\n   * @typedef {Object} refererInfo\n   * @property {string} referer - detected top url\n   * @property {boolean} reachedTop - whether it was possible to walk upto top window or not\n   * @property {number} numIframes - number of iframes\n   * @property {string} stack - comma separated urls of all origins\n   * @property {string} canonicalUrl - canonical URL refers to an HTML link element, with the attribute of rel=\"canonical\", found in the <head> element of your webpage\n   */\n\n  /**\n   * Get referer info\n   * @returns {refererInfo}\n   */\n  function refererInfo() {\n    try {\n      let levels = getLevels();\n      let numIframes = levels.length - 1;\n      let reachedTop = (levels[numIframes].location !== null ||\n        (numIframes > 0 && levels[numIframes - 1].referrer !== null));\n      let stackInfo = getPubUrlStack(levels);\n      let canonicalUrl;\n      if (levels[levels.length - 1].canonicalUrl) {\n        canonicalUrl = levels[levels.length - 1].canonicalUrl;\n      }\n\n      return {\n        referer: stackInfo.detectedRefererUrl,\n        reachedTop,\n        numIframes,\n        stack: stackInfo.stack,\n        canonicalUrl\n      };\n    } catch (e) {\n      // Ignore error\n    }\n  }\n\n  return refererInfo;\n}\n\nexport const getRefererInfo = detectReferer(window);\n\n\n\n// WEBPACK FOOTER //\n// ./lib/refererDetection.js","/*\n * Class containing the status of the API for a partner\n */\nimport CONSTANTS from './constants.json';\n\nimport { isFn, logInfo, logError, isPlainObject } from './utils.js';\n\n/* eslint-disable no-unused-vars */\nimport Config from './config.js';\nimport ClientStore from './clientStore.js';\nimport { ConsentManagement } from './consentManagement.js';\n/* eslint-enable no-unused-vars */\n\nexport default class Id5Status {\n  /** timerId of the onAvailable watchdog */\n  _availableCallbackTimerId;\n  /** @type {boolean} */\n  _availableCallbackFired = false;\n  /** @type {function} */\n  _availableCallback;\n  /** @type {function} */\n  _updateCallback;\n  /** timerId of the onRefresh watchdog */\n  _refreshCallbackTimerId;\n  /** @type {boolean} */\n  _refreshCallbackFired = false;\n  /** @type {function} */\n  _refreshCallback;\n  /** @type {boolean} */\n  _isExposed;\n  /** @type {boolean} */\n  _fromCache;\n  /** @type {boolean} */\n  _isRefreshing = false;\n  /** @type {boolean} */\n  _isRefreshingWithFetch = false;\n  /** @type {string} */\n  _userId;\n  /** @type {number} */\n  _linkType;\n  /** @type {boolean} */\n  _userIdAvailable = false;\n  /** @type {number} */\n  invocationId;\n  /** @type {Config} */\n  config;\n  /** @type {ClientStore} */\n  clientStore;\n  /** @type {ConsentManagement} */\n  consentManagement;\n\n  /**\n   * @param {number} invocationId\n   * @param {Config} config\n   * @param {ClientStore} clientStore\n   * @param {ConsentManagement} consentManagement\n   */\n  constructor(invocationId, config, clientStore, consentManagement) {\n    this.invocationId = invocationId;\n    this.config = config;\n    this.clientStore = clientStore;\n    this.consentManagement = consentManagement;\n  }\n\n  /** @returns {Id5Options} options - Current options for this partner */\n  getOptions() {\n    return this.config.getOptions();\n  }\n\n  /**\n   * Return how many invalid segments we got in the options\n   * @returns {number} invalidSegments\n   */\n  getInvalidSegments() {\n    return this.config.getInvalidSegments();\n  }\n\n  /** @param {Id5Options} options */\n  updateOptions(options) {\n    return this.config.updOptions(options);\n  }\n\n  /**\n   * Notify status that a refresh is in progress\n   * @param {boolean} forceFetch – server response required\n   */\n  startRefresh(forceFetch) {\n    this._isRefreshing = true;\n    this._isRefreshingWithFetch = forceFetch;\n  }\n\n  /**\n   * Set the user Id for this Id5Status\n   * @param {Object} response\n\n   * @param {boolean} fromCache\n   */\n  setUserId(response, fromCache) {\n    const _this = this;\n    const userId = response.universal_uid;\n    const linkType = response.link_type || 0;\n\n    this._isExposed = true;\n    if (isPlainObject(response.ab_testing)) {\n      switch (response.ab_testing.result) {\n        case 'normal':\n          // nothing to do\n          break;\n        default: // falls through\n        case 'error':\n          logError(this.invocationId, 'Id5Status: There was an error with A/B Testing. Make sure controlGroupRatio is a number >= 0 and <= 1');\n          break;\n        case 'control':\n          this._isExposed = false;\n          this.info('User is in control group!');\n          break;\n      }\n    }\n\n    const hasChanged = this._userId !== userId || this._linkType !== linkType;\n    this._userIdAvailable = true;\n    this._userId = userId;\n    this._linkType = linkType;\n    this._fromCache = fromCache;\n    this.info(`User id updated, hasChanged: ${hasChanged}, fromCache: ${fromCache}`);\n\n    // Fire onAvailable if not yet fired\n    if (isFn(this._availableCallback) && this._availableCallbackFired === false) {\n      // Cancel pending watchdog\n      if (this._availableCallbackTimerId) {\n        this.info('Cancelling pending onAvailableCallback watchdog');\n        clearTimeout(this._availableCallbackTimerId);\n        this._availableCallbackTimerId = undefined;\n      }\n      this._availableCallbackTimerId = setTimeout(() => Id5Status.doFireOnAvailableCallBack(_this), 0);\n    }\n\n    // Fire onRefresh if not yet fired and not from cache\n    if (this._isRefreshing && isFn(this._refreshCallback) && this._refreshCallbackFired === false) {\n      if (fromCache === false || this._isRefreshingWithFetch === false) {\n        // Cancel pending watchdog\n        if (this._refreshCallbackTimerId) {\n          this.info('Cancelling pending onRefreshCallback watchdog');\n          clearTimeout(this._refreshCallbackTimerId);\n          this._refreshCallbackTimerId = undefined;\n        }\n        this._refreshCallbackTimerId = setTimeout(() => Id5Status.doFireOnRefreshCallBack(_this), 0);\n      }\n    }\n\n    // Always fire onUpdate if any change\n    if (hasChanged && isFn(this._updateCallback)) {\n      setTimeout(() => Id5Status.doFireOnUpdateCallBack(_this), 0);\n    }\n  }\n\n  /**\n   * Return the current userId if available and not in control group\n   * @return {string} userId\n   */\n  getUserId() {\n    return this._isExposed === false ? '0' : this._userId;\n  }\n\n  /**\n   * Return the current linkType if available and not in control group\n   * @return {number} linkType\n   */\n  getLinkType() {\n    return this._isExposed === false ? 0 : this._linkType;\n  }\n\n  /**\n   * Return true if the userId provided is from cache\n   * @return {boolean}\n   */\n  isFromCache() {\n    return this._fromCache;\n  }\n\n  /**\n   * Return true if we should expose this user Id within AB Test\n   * @return {boolean}\n   */\n  exposeUserId() {\n    return this._isExposed;\n  }\n\n  /**\n   * Return the current userId in an object that can be added to the\n   * eids array of an OpenRTB bid request\n   * @return {object}\n   */\n  getUserIdAsEid() {\n    return {\n      source: CONSTANTS.ID5_EIDS_SOURCE,\n      uids: [{\n        atype: 1,\n        id: this.getUserId(),\n        ext: {\n          linkType: this.getLinkType(),\n          abTestingControlGroup: !this.exposeUserId()\n        }\n      }]\n    };\n  }\n\n  /**\n   * Fire the provided callback when (and exactly once) a user id is available\n   * if a timeout is provided, fire the callback at timeout even if user id is not yet available\n   * @param {function(Id5Status)} fn - callback function, receiving the current Id5Status as first param\n   * @param {number} [timeout] - watchdog timeout in ms\n   * @return {Id5Status} the current Id5Status for chaining\n   */\n  onAvailable(fn, timeout) {\n    if (!isFn(fn)) {\n      throw new Error('onAvailable expect a function');\n    }\n    if (isFn(this._availableCallback)) {\n      this.info('onAvailable was already called, ignoring');\n    } else {\n      this._availableCallback = fn;\n      const currentThis = this; // Preserve this within callback\n\n      if (this._userIdAvailable) {\n        this.info('User id already available firing callback immediately');\n        this._availableCallbackTimerId = setTimeout(() => Id5Status.doFireOnAvailableCallBack(currentThis), 0);\n      } else if (timeout > 0) {\n        this._availableCallbackTimerId = setTimeout(() => Id5Status.doFireOnAvailableCallBack(currentThis), timeout);\n      }\n    }\n    return this;\n  }\n\n  /**\n   * Fire the provided callback each time a user id is available or updated.\n   * Will be fired after onAvailable or onRefresh if both are provided\n   * @param {function(Id5Status)} fn - callback function, receiving the current Id5Status as first param\n   * @return {Id5Status} the current Id5Status for chaining\n   */\n  onUpdate(fn) {\n    if (!isFn(fn)) {\n      throw new Error('onUpdate expect a function');\n    }\n    this._updateCallback = fn;\n    const currentThis = this; // Preserve this within callback\n    if (this._userIdAvailable) {\n      setTimeout(() => Id5Status.doFireOnUpdateCallBack(currentThis), 0);\n    }\n    return this;\n  }\n\n  /**\n   * Fire the provided callback when (and exactly once) a user id is returned by refreshId()\n   * if a timeout is provided, fire the callback at timeout even refersh is not done\n   * @param {function(Id5Status)} fn - callback function, receiving the current Id5Status as first param\n   * @param {number} [timeout] - watchdog timeout in ms\n   * @return {Id5Status} the current Id5Status for chaining\n   */\n  onRefresh(fn, timeout) {\n    if (!isFn(fn)) {\n      throw new Error('onRefresh expect a function');\n    }\n    // We have a pending onRefresh, cancel it.\n    if (this._refreshCallbackTimerId) {\n      clearTimeout(this._refreshCallbackTimerId);\n      this._refreshCallbackTimerId = undefined;\n    }\n    this._refreshCallback = fn;\n    const currentThis = this; // Preserve this within callback\n    // If we are already after a non-forced refreshId and we already have a user id, then callback immediately\n    if (this._isRefreshing === true && this._isRefreshingWithFetch === false && this._userIdAvailable) {\n      this._refreshCallbackTimerId = setTimeout(() => Id5Status.doFireOnRefreshCallBack(currentThis), 0);\n    } else if (timeout > 0) {\n      this._refreshCallbackTimerId = setTimeout(() => Id5Status.doFireOnRefreshCallBack(currentThis), timeout);\n    }\n    return this;\n  }\n\n  /**\n   * @return {boolean|undefined} see {ClientStore.isLocalStorageAllowed}\n   */\n  localStorageGrant() {\n    return this.clientStore.localStorageGrant();\n  }\n\n  info(message) {\n    logInfo(this.invocationId, 'Id5Status: ' + message);\n  }\n\n  /**\n   * This function fire the onAvailable callback of the passed Id5Status\n   * @param {Id5Status} currentId5Status\n   */\n  static doFireOnAvailableCallBack(currentId5Status) {\n    logInfo(currentId5Status.invocationId, 'Id5Status.doFireOnAvailableCallBack');\n    currentId5Status._availableCallbackFired = true;\n    currentId5Status._availableCallbackTimerId = undefined;\n    currentId5Status._availableCallback(currentId5Status);\n  }\n\n  /**\n   * This function fire the onUpdate callback of the passed Id5Status\n   * @param {Id5Status} currentId5Status\n   */\n  static doFireOnUpdateCallBack(currentId5Status) {\n    logInfo(currentId5Status.invocationId, 'Id5Status.doFireOnUpdateCallBack');\n    currentId5Status._updateCallback(currentId5Status);\n  }\n\n  /**\n   * This function fire the onRefresh callback of the passed Id5Status\n   * @param {Id5Status} currentId5Status\n   */\n  static doFireOnRefreshCallBack(currentId5Status) {\n    logInfo(currentId5Status.invocationId, 'Id5Status.doFireOnRefreshCallBack');\n    currentId5Status._refreshCallbackFired = true;\n    currentId5Status._refreshCallbackTimerId = undefined;\n    currentId5Status._isRefreshing = false;\n    currentId5Status._isRefreshingWithFetch = false;\n    currentId5Status._refreshCallback(currentId5Status);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/id5Status.js","// generated by genversion\nexport const version = '1.0.14'\n\n\n\n// WEBPACK FOOTER //\n// ./generated/version.js"],"sourceRoot":""}